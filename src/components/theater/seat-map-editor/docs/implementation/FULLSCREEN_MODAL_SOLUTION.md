# 🎯 座位图编辑器全屏显示解决方案

---

## 🐛 **问题描述**

### **现象**
座位图编辑器显示区域过小，画布只有很小的一块区域，完全无法正常使用。

![问题截图](figma:asset/74a767ea373b0d742d557bf6d4221de3b727e079.png)

---

## 🔍 **问题分析**

### **根本原因**

`SeatMapEditor` 被嵌入在表单容器中，受到多层布局限制：

```
FormPageLayout (max-width: 1200px, padding: 24px)
  └─ VenueForm (表单容器)
       └─ Form.Item (表单项)
            └─ SeatMapEditor (设置 height: 100vh) ❌
                 实际显示高度 ≈ 400px，宽度 ≈ 500px
```

**问题点：**
1. ❌ `height: '100vh'` 期望占据全屏高度，但被表单容器截断
2. ❌ 左右有 FormPageLayout 的 padding，宽度受限
3. ❌ 上方有其他表单字段（场馆名称、地址等），进一步压缩空间
4. ❌ 编辑器内部有左工具栏（60px）+ 右属性面板（300px），实际画布更小

**实际可用画布尺寸：**
- 宽度：约 `1200px - 48px(padding) - 60px(左工具栏) - 300px(右属性面板) = 792px`
- 高度：约 `400px - 48px(顶部工具栏) - 48px(底部状态栏) = 304px`

**设计目标画布尺寸：**
- 宽度：1200px（画布本身）
- 高度：800px（画布本身）

**结论：** 编辑器需要接近全屏的空间才能正常使用。

---

## ✅ **解决方案对比**

### **方案 1：全屏 Modal（✅ 推荐）**

**设计：**
- 在表单中显示"编辑座位图"按钮（120px 高度）
- 点击按钮打开全屏 Modal（100vw × 100vh）
- Modal 内部渲染 `SeatMapEditor`
- 编辑完成后点击"完成"保存并关闭

**优点：**
- ✅ 提供最大编辑空间（接近全屏）
- ✅ 不破坏现有表单布局
- ✅ 符合专业软件的使用习惯（Figma、Photoshop、CAD）
- ✅ 数据流简单清晰
- ✅ 可以显示统计信息（已设置 X 个座位）

**缺点：**
- ⚠️ 需要额外点击"编辑"按钮

**实现复杂度：** 低

---

### **方案 2：独立页面（备选）**

**设计：**
- 点击按钮通过路由跳转到独立的座位图编辑页面
- 编辑完成后返回表单页面

**优点：**
- ✅ 完全独立，灵活
- ✅ 可以有独立的 URL

**缺点：**
- ❌ 数据传递复杂（需要通过路由参数或全局状态）
- ❌ 页面跳转体验不如 Modal
- ❌ 实现成本高

**实现复杂度：** 高

---

### **方案 3：可调整大小容器（不推荐）**

**设计：**
- 在表单中提供一个最小高度的容器（如 600px）
- 允许用户拖拽调整大小

**优点：**
- ✅ 简单

**缺点：**
- ❌ 仍然受限于表单宽度（约 1100px）
- ❌ 用户体验差（需要手动调整）
- ❌ 无法解决根本问题

**实现复杂度：** 中

---

## 🚀 **最终采用：方案 1（全屏 Modal）**

---

## 📦 **实现细节**

### **1. 新增组件：`SeatMapEditorModal`**

**文件：** `/components/theater/seat-map-editor/SeatMapEditorModal.tsx`

**功能：**
- 渲染"编辑座位图"按钮（120px 高度，dashed 样式）
- 显示统计信息（已设置 X 个座位 | 可售 X 个）
- 点击按钮打开全屏 Modal
- Modal 内部渲染 `SeatMapEditor`
- 提供"完成"和"取消"按钮

**核心代码：**

```typescript
<Modal
  title="座位图编辑器"
  open={visible}
  onCancel={handleCancel}
  onOk={handleOk}
  width="100vw"
  style={{
    top: 0,
    paddingBottom: 0,
    maxWidth: '100vw',
  }}
  bodyStyle={{
    height: 'calc(100vh - 110px)', // 减去标题栏和按钮栏
    padding: 0,
    overflow: 'hidden',
  }}
  okText="完成"
  cancelText="取消"
  destroyOnClose
>
  <SeatMapEditor
    initialData={initialData}
    onChange={handleEditorChange}
  />
</Modal>
```

---

### **2. 修改 `VenueForm.tsx`**

**变更：**

```diff
- import { SeatMapEditor } from './seat-map-editor';
+ import { SeatMapEditorModal } from './seat-map-editor/SeatMapEditorModal';

  {/* 精确座位模式 */}
  {capacityType === 'precise_seat' && (
-   <SeatMapEditor
-     initialData={seatMapData}
-     onChange={handleSeatMapChange}
-   />
+   <SeatMapEditorModal
+     initialData={seatMapData}
+     onChange={handleSeatMapChange}
+   />
  )}
```

---

### **3. 导出新组件**

**文件：** `/components/theater/seat-map-editor/index.tsx`

```typescript
export { SeatMapEditorModal } from './SeatMapEditorModal';
```

---

## 🎨 **效果对比**

### **修复前（❌）**

```
┌─────────────────────────────────────────────────┐
│ 场馆表单                                        │
├─────────────────────────────────────────────────┤
│ 场馆名称: [输入框]                              │
│ 场馆地址: [输入框]                              │
│ 容量类型: ○ 自由站席 ○ 按座区 ● 精确座位        │
│                                                 │
│ ┌────┬───────────┬────┐                        │
│ │工具│  画布(很小)│属性│  ← 只有约 500×400px  │
│ └────┴───────────┴────┘                        │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

### **修复后（✅）**

#### **表单页面**

```
┌─────────────────────────────────────────────────┐
│ 场馆表单                                        │
├─────────────────────────────────────────────────┤
│ 场馆名称: [输入框]                              │
│ 场馆地址: [输入框]                              │
│ 容量类型: ○ 自由站席 ○ 按座区 ● 精确座位        │
│                                                 │
│ ┌───────────────────────────────────────────┐  │
│ │  📝 编辑座位图                             │  │
│ │  已设置 1200 个座位 | 可售 1150 个         │  │
│ └───────────────────────────────────────────┘  │
│           ↑ 点击打开全屏编辑器                   │
└─────────────────────────────────────────────────┘
```

#### **全屏编辑器**

```
┌─────────────────────────────────────────────────┐
│ 座位图编辑器                     [取消] [完成]  │
├────┬────────────────────────────────────┬────┤
│    │      [对齐工具栏]                  │    │
│ 🔧 ├────────────────────────────────────┤ 📋 │
│ 工 │                                    │ 属 │
│ 具 │     Canvas 画布（接近全屏）         │ 性 │
│ 面 │     约 1400×700px 可用空间          │ 面 │
│ 板 │                                    │ 板 │
│    │                                    │    │
├────┴────────────────────────────────────┴────┤
│ 🏢 [1F] [2F] | 📍坐标 | 🔍缩放 | 📊统计      │
└─────────────────────────────────────────────────┘
```

---

## 📊 **可用空间对比**

| 方案 | 画布宽度 | 画布高度 | 可用面积 | 备注 |
|------|---------|---------|---------|------|
| 修复前（表单嵌入） | ~500px | ~300px | 150,000 px² | ❌ 无法使用 |
| 修复后（全屏 Modal） | ~1400px | ~700px | 980,000 px² | ✅ 提升 6.5 倍 |

---

## ✅ **验证清单**

### **功能验证**

- [ ] 点击"编辑座位图"按钮，打开全屏 Modal
- [ ] Modal 内编辑器显示正常（左工具栏、顶部工具栏、右属性面板、底部状态栏）
- [ ] 可以添加座区、生成排座、编辑座位
- [ ] 点击"完成"按钮，数据保存到表单
- [ ] 点击"取消"按钮，数据不保存
- [ ] 再次打开 Modal，显示上次保存的数据
- [ ] 按钮上显示统计信息（已设置 X 个座位）

### **兼容性验证**

- [ ] 旧版数据（SeatMapData）正常加载
- [ ] 新版数据（TheaterData）正常加载
- [ ] 空数据时显示默认 1F 楼层
- [ ] 表单提交时包含座位图数据

---

## 🎯 **用户体验优化**

### **按钮设计**

- ✅ 高度 120px，视觉突出
- ✅ dashed 样式，符合"添加/编辑"语义
- ✅ 显示统计信息，让用户知道当前状态
- ✅ 图标 + 文字，清晰明了

### **Modal 设计**

- ✅ 全屏显示（100vw × 100vh）
- ✅ 顶部保留标题栏和操作按钮
- ✅ 内容区域无 padding，最大化空间
- ✅ `destroyOnClose` - 关闭后销毁，避免内存泄漏
- ✅ "完成"和"取消"按钮，操作明确

---

## 📝 **后续优化建议**

### **P1（高优先级）**

1. **添加快捷键**
   - `Esc` - 关闭 Modal（默认已支持）
   - `Cmd+S` / `Ctrl+S` - 保存并关闭

2. **未保存提示**
   - 编辑后未点击"完成"直接关闭，提示"是否保存更改？"

3. **加载状态**
   - 打开 Modal 时显示 Loading
   - 数据量大时优化渲染性能

### **P2（低优先级）**

1. **预览模式**
   - 按钮区域显示座位图缩略图
   - 点击缩略图放大查看

2. **全屏切换**
   - 提供"全屏"按钮（F11）
   - 退出全屏恢复 Modal 模式

---

## 📦 **文件清单**

### **新增文件**

```
/components/theater/seat-map-editor/
└── SeatMapEditorModal.tsx    ✅ 全屏 Modal 包装器
```

### **修改文件**

```
/components/theater/
├── VenueForm.tsx              ✅ 使用 SeatMapEditorModal 替换 SeatMapEditor
└── seat-map-editor/
    └── index.tsx              ✅ 导出 SeatMapEditorModal
```

---

## ✅ **总结**

**问题：** 座位图编辑器显示区域过小（约 500×300px），无法正常使用

**解决：** 采用全屏 Modal 方案，提供接近全屏的编辑空间（约 1400×700px）

**效果：** 可用面积提升 **6.5 倍**，完全满足座位图编辑需求

**优势：**
- ✅ 不破坏现有表单布局
- ✅ 符合专业软件的使用习惯
- ✅ 实现简单，代码量少
- ✅ 数据流清晰，易于维护

---

**实施时间：** 2025-12-14  
**实施状态：** ✅ 已完成  
**测试状态：** ⏳ 待用户验证
