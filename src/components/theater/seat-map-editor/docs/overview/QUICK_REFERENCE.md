# ⚡ 快速参考卡片 - 开发前必读

**📖 完整文档：** 见 `DESIGN_PRINCIPLES.md`

---

## 🎯 三大核心原则（必记）

```
1️⃣ 观众视角：统一使用"观众面向舞台"的视角
2️⃣ 座区是标签：不是容器，基于座位创建，不能为空
3️⃣ 通道是空白：不需要绘制，座位间隙自然形成
```

---

## 💡 开发前三问（每次必问）

### 问题 1：这是什么？

```
座位 = 坐标点（物理位置）
座区 = 标签（业务属性）
楼层 = 空间层级（物理结构）

❌ 不要把"标签"当成"容器"
✅ 标签依附于实体，不能单独存在
```

### 问题 2：怎么用？

```
用户故事：
  作为剧场管理员
  我想将前3排座位标记为"VIP区"
  以便设置更高的票价

交互流程：
  1. 选择座位
  2. 右键 → 创建座区
  3. 填写名称、颜色
  4. 确定 → 完成

❌ 不要设计"先建空配置，再关联数据"
✅ 基于已有数据，添加属性
```

### 问题 3：会出错吗？

```
边界检查：
  ✅ 是否允许创建"空座区"？→ 不允许
  ✅ 删除座区后座位还在吗？→ 在（只失去标签）
  ✅ 同一楼层座区重名？→ 不允许
  ✅ 删除楼层后座位呢？→ 一起删除（提示用户）

❌ 不要允许创建"无意义的数据"
✅ 所有实体都应该有完整的业务含义
```

---

## ⚠️ 三大思维陷阱（务必避免）

### 陷阱 1：传统 SaaS 思维

```
❌ 错误模式：
   先创建分类 → 再添加数据
   先创建座区 → 再分配座位

✅ 正确模式：
   先创建数据 → 再添加分类
   先绘制座位 → 再创建座区（标签）
```

### 陷阱 2：只看技术不看业务

```
❌ 看到 Zone 类型 → 立即实现 CRUD
   createZone() ← 允许创建空座区
   updateZone()
   deleteZone()

✅ 先想用户场景 → 再设计 API
   用户何时需要创建座区？
   → 当已有一组座位，想设置价格时
   → 所以创建座区必须基于已选中的座位
```

### 陷阱 3：阶段开发路径依赖

```
❌ 阶段 1 实现错误逻辑 → 阶段 2-3 打补丁 → 阶段 4 推倒重来

✅ 每个阶段完成后回顾 PRD：
   - 这符合产品理念吗？
   - 发现偏差立即重构
   - 不要"先完成再说"
```

---

## ✅ 开发检查清单（每次必查）

### 设计阶段（5 项）

```
□ 回顾 PRD：产品理念是什么？
□ 真实对比：剧场管理员如何操作？
□ 用户故事：用户在什么场景下使用？
□ 交互流程：需要几个步骤完成？
□ 边界情况：会创建"无意义数据"吗？
```

### 实现阶段（5 项）

```
□ 本质理解："容器"还是"标签"？
□ 依赖关系：依赖哪些其他实体？
□ 生命周期：何时创建、更新、删除？
□ 数据一致性：删除时如何处理关联数据？
□ 错误处理：处理了所有异常情况吗？
```

### 测试阶段（5 项）

```
□ 正常流程：按设计流程操作是否正常？
□ 异常流程：非预期操作是否有提示？
□ 边界测试：空数据、大量数据是否正常？
□ 回归测试：新功能是否影响旧功能？
□ 真实场景：在真实业务下是否符合预期？
```

---

## 🔥 典型案例（前车之鉴）

### 案例：座区创建流程

**问题：** 实现了"先创建空座区，再分配座位"

**原因：**
- 套用传统 SaaS 的"配置-数据"模式
- 没有回顾 PRD 中"座区是标签"的理念
- 阶段开发时路径依赖

**修复：**
```typescript
// ❌ 错误（废弃）
const handleCreateZone = (zone) => {
  setZones([...zones, newZone]); // 创建空座区
};

// ✅ 正确（新增）
const handleCreateZoneFromSeats = () => {
  if (selectedSeatIds.length === 0) {
    message.warning('请先选择座位');
    return;
  }
  setZoneConfigModalVisible(true);
};
```

**教训：**
- 在设计阶段就要问"三问"
- 对比真实世界：管理员不会先创建空座区
- 每个阶段完成后回顾 PRD

---

## 🎓 记忆口诀

```
开发之前先三问：
  这是什么？怎么用？会出错吗？

设计理念记三点：
  观众视角、座区标签、通道空白

思维陷阱避三坑：
  SaaS惯性、技术优先、路径依赖

检查清单查三轮：
  设计、实现、测试
```

---

## 📌 最重要的一句话

> **"座区是标签，不是容器"**  
> 在每次开发前问自己：  
> **"这符合真实世界的逻辑吗？"**

---

**📖 详细说明：** 见 `DESIGN_PRINCIPLES.md`  
**🔄 案例复盘：** 见 `PHASE6_4_REFACTOR_SUMMARY.md`  
**🐛 Bug 修复：** 见 `PHASE6_4_BUGFIX.md`
