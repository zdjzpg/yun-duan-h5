const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-CQ4RscqV.js","assets/demo-Df_X4WLu.js","assets/demo-BEwKZ839.css","assets/vendor-B6snAd4S.css"])))=>i.map(i=>d[i]);
import{d as de,e as w,m as O,o as I,l as q,n as x,g as e,w as t,F as oe,p as Se,f as V,B as za,h as v,t as B,C as St,z as Oe,u as Xe,r as E,k as _e,j as Re,y as Y,a as N,E as Ie,P as Ct,G as Da,Z as Ma,H as Fa,U as Ea,R as xt,I as La,J as Na,K as Oa,L as Pa,Q as Wt,c as Qe,i as W,M as Ua,N as Aa,O as Jt,D as Vt,T as Je,V as Va,W as ct,X as nt,Y as Qt,S as ea,_ as Ya,$ as Ba,a0 as Ke,a1 as Xa,a2 as Za,a3 as kt,a4 as dt,a5 as Ga,a6 as qa,a7 as je,a8 as ja,a9 as Ha,aa as Ka,ab as Wa,ac as rt,ad as Yt,ae as Bt,af as It,ag as ut,ah as Ja,ai as Qa,aj as en,ak as tn,al as an,am as Xt,an as nn,ao as ln,ap as on,aq as sn,ar as rn,as as un,at as dn,au as ta,av as cn,aw as pn,q as Tt,b as He}from"./vendor-CQ4RscqV.js";import{g as lt,p as pt,d as aa,a as $t,_ as Ve,b as na}from"./demo-Df_X4WLu.js";async function ft(l){return lt("/theater/venues",{params:l})}async function fn(l){return $t("/theater/venues",l)}async function mt(l){return lt(`/theater/venues/${l}`)}async function mn(l){const{id:h,...u}=l;return pt(`/theater/venues/${h}`,u)}async function vn(l,h){const u={id:l,status:h};return pt(`/theater/venues/${l}/status`,u)}async function yn(l){return aa(`/theater/venues/${l}`)}const gn={class:"list-page-layout"},_n={key:0,class:"list-page-layout__header"},bn={key:0,class:"list-page-layout__actions"},hn={key:1,class:"list-page-layout__filters"},xn={class:"list-page-layout__content"},kn=de({__name:"ListPageLayout",props:{actions:{default:()=>[]}},setup(l){const h=l;return(u,p)=>{const s=w("a-button"),d=w("a-space");return I(),O("div",gn,[h.actions.length||u.$slots.filters?(I(),O("div",_n,[h.actions.length?(I(),O("div",bn,[e(d,{size:12},{default:t(()=>[(I(!0),O(oe,null,Se(h.actions,(i,c)=>(I(),V(s,{key:c,type:i.type,danger:i.danger,disabled:i.disabled,onClick:k=>i.onClick&&i.onClick()},za({default:t(()=>[v(" "+B(i.label),1)]),_:2},[i.icon?{name:"icon",fn:t(()=>[(I(),V(St(i.icon)))]),key:"0"}:void 0]),1032,["type","danger","disabled","onClick"]))),128))]),_:1})])):q("",!0),u.$slots.filters?(I(),O("div",hn,[Oe(u.$slots,"filters",{},void 0,!0)])):q("",!0)])):q("",!0),x("div",xn,[Oe(u.$slots,"default",{},void 0,!0)])])}}}),la=Ve(kn,[["__scopeId","data-v-d040bc5a"]]),wn={key:0},Sn={key:1},Cn={key:2},In={key:0},Tn=["onClick"],$n=["onClick"],mr=de({__name:"VenueList",setup(l){const h=Xe(),u=E(""),p=E(void 0),s=E(!1),d=E([]),i=E(0),c=E(1),k=E(10),g=[{title:"åœºé¦†åç§°",dataIndex:"name",key:"name",width:200},{title:"åº§ä½ç±»å‹",dataIndex:"capacityType",key:"capacityType",width:150},{title:"æ€»å¯ç”¨å®¹é‡",dataIndex:"totalCapacity",key:"totalCapacity",width:120,align:"right"},{title:"çŠ¶æ€",dataIndex:"status",key:"status",width:100},{title:"é”å®šçŠ¶æ€",dataIndex:"isLocked",key:"isLocked",width:120},{title:"æœ€è¿‘æ›´æ–°æ—¶é—´",dataIndex:"updatedAt",key:"updatedAt",width:180},{title:"æ“ä½œ",key:"actions",width:150,fixed:"right",align:"right"}],m=async()=>{try{s.value=!0;const _={page:c.value,pageSize:k.value,keyword:u.value||void 0,status:p.value},b=await ft(_);d.value=b.list,i.value=b.total}catch(_){console.error(_)}finally{s.value=!1}};_e([u,p],()=>{c.value=1,m()}),Re(()=>{m()});const r=async(_,b)=>{const f=b==="active"?"å¯ç”¨":"åœç”¨";try{await vn(_,b),N.success(`${f}æˆåŠŸ`),m()}catch(a){console.error(a)}},o=async _=>{try{await yn(_),N.success("åˆ é™¤æˆåŠŸ"),m()}catch(b){console.error(b)}},y=()=>{if(!d.value.length){N.warning("æš‚æ— æ•°æ®å¯å¯¼å‡º");return}const _={free_seating:"è‡ªç”±ç«™å¸­",zone_capacity:"æŒ‰åº§åŒºæ•°é‡",precise_seat:"ç²¾ç¡®åº§ä½"},b={active:"å¯ç”¨",inactive:"åœç”¨"},f=d.value.map(F=>({name:F.name,capacityType:_[F.capacityType],totalCapacity:F.totalCapacity,status:b[F.status],address:F.address||"",createdAt:new Date(F.createdAt).toLocaleString("zh-CN"),updatedAt:new Date(F.updatedAt).toLocaleString("zh-CN")})),n=[["åœºé¦†åç§°","åº§ä½ç±»å‹","æ€»å®¹é‡","çŠ¶æ€","åœ°å€","åˆ›å»ºæ—¶é—´","æ›´æ–°æ—¶é—´"].join(","),...f.map(F=>[F.name,F.capacityType,F.totalCapacity,F.status,F.address,F.createdAt,F.updatedAt].map(D=>`"${String(D).replace(/"/g,'""')}"`).join(","))].join(`
`),S=new Blob([n],{type:"text/csv;charset=utf-8;"}),z=URL.createObjectURL(S),$=document.createElement("a");$.href=z,$.download=`åœºé¦†åˆ—è¡¨_${new Date().toLocaleDateString("zh-CN").replace(/\//g,"-")}.csv`,$.click(),URL.revokeObjectURL(z)};return(_,b)=>{const f=w("a-input"),a=w("a-select-option"),n=w("a-select"),S=w("a-badge"),z=w("a-tag"),$=w("a-popconfirm"),F=w("a-space"),D=w("a-table");return I(),V(la,{actions:[{label:"æ–°å»ºåœºé¦†",type:"primary",onClick:()=>Y(h).push("/dashboard/theater/venues/new")},{label:"å¯¼å‡º",type:"default",onClick:y}]},{filters:t(()=>[e(f,{value:u.value,"onUpdate:value":b[0]||(b[0]=P=>u.value=P),placeholder:"æœç´¢åœºé¦†åç§°",style:{width:"216px"},"allow-clear":""},null,8,["value"]),e(n,{value:p.value,"onUpdate:value":b[1]||(b[1]=P=>p.value=P),placeholder:"å…¨éƒ¨çŠ¶æ€","allow-clear":"",style:{width:"216px"}},{default:t(()=>[e(a,{value:"active"},{default:t(()=>[...b[2]||(b[2]=[v("å¯ç”¨",-1)])]),_:1}),e(a,{value:"inactive"},{default:t(()=>[...b[3]||(b[3]=[v("åœç”¨",-1)])]),_:1})]),_:1},8,["value"])]),default:t(()=>[e(D,{columns:g,"data-source":d.value,loading:s.value,"row-key":"id",pagination:{current:c.value,pageSize:k.value,total:i.value,showSizeChanger:!1,showTotal:P=>`å…± ${P} æ¡`,onChange:P=>{c.value.value=P,m()}}},{bodyCell:t(({column:P,text:A,record:Z})=>[P.key==="capacityType"?(I(),O(oe,{key:0},[A==="free_seating"?(I(),O("span",wn,"è‡ªç”±ç«™å¸­")):A==="zone_capacity"?(I(),O("span",Sn,"æŒ‰åº§åŒºæ•°é‡")):(I(),O("span",Cn,"ç²¾ç¡®åº§ä½"))],64)):P.key==="totalCapacity"?(I(),O(oe,{key:1},[v(B(Number(A).toLocaleString())+" äºº ",1)],64)):P.key==="status"?(I(),O(oe,{key:2},[A==="active"?(I(),V(S,{key:0,status:"success",text:"å¯ç”¨"})):(I(),V(S,{key:1,status:"default",text:"åœç”¨"}))],64)):P.key==="isLocked"?(I(),O(oe,{key:3},[Z.capacityType!=="precise_seat"?(I(),O("span",In,"-")):(I(),V(z,{key:1,color:Z.isLocked?"red":"green"},{default:t(()=>[v(B(Z.isLocked?"å·²é”å®š":"æœªé”å®š"),1)]),_:2},1032,["color"]))],64)):P.key==="updatedAt"?(I(),O(oe,{key:4},[v(B(new Date(A).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),1)],64)):P.key==="actions"?(I(),V(F,{key:5,size:"small"},{default:t(()=>[x("a",{onClick:ne=>Y(h).push(`/dashboard/theater/venues/${Z.id}`)},"ç¼–è¾‘",8,Tn),x("a",{onClick:ne=>r(Z.id,Z.status==="active"?"inactive":"active")},B(Z.status==="active"?"åœç”¨":"å¯ç”¨"),9,$n),e($,{title:"ç¡®è®¤åˆ é™¤è¯¥åœºé¦†å—ï¼Ÿ","ok-text":"ç¡®è®¤","cancel-text":"å–æ¶ˆ",onConfirm:()=>o(Z.id)},{default:t(()=>[...b[4]||(b[4]=[x("a",null,"åˆ é™¤",-1)])]),_:1},8,["onConfirm"])]),_:2},1024)):q("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1},8,["actions"])}}}),Rn={class:"form-page-layout"},zn={class:"form-page-layout__card"},Dn={class:"form-page-layout__footer"},Mn={class:"form-page-layout__footer-inner"},Fn=de({__name:"FormPageLayout",setup(l){return(h,u)=>(I(),O("div",Rn,[x("div",zn,[Oe(h.$slots,"default",{},void 0,!0)]),x("div",Dn,[x("div",Mn,[Oe(h.$slots,"footer",{},void 0,!0)])])]))}}),vt=Ve(Fn,[["__scopeId","data-v-9f6c3a11"]]);function En(l){const h=[];if(l.stage||h.push({type:"missing_stage",message:"åº§ä½å›¾å¿…é¡»åŒ…å«èˆå°ï¼Œè¯·å…ˆæ·»åŠ èˆå°"}),(!l.seats||l.seats.length===0)&&h.push({type:"no_seats",message:"åº§ä½å›¾è‡³å°‘éœ€è¦ä¸€ä¸ªåº§ä½"}),l.seats&&l.seats.length>0){const u=new Map;for(const p of l.seats){const s=p.floorId;u.has(s)||u.set(s,[]),u.get(s).push({rowLabel:p.rowLabel,seatLabel:p.seatLabel,id:p.id})}for(const[p,s]of u.entries()){const d=new Map;for(const i of s){const c=`${i.rowLabel}-${i.seatLabel}`;d.has(c)||d.set(c,[]),d.get(c).push(i.id)}for(const[i,c]of d.entries())if(c.length>1){const[k,g]=i.split("-"),r=l.floors.find(o=>o.id===p)?.name||p;h.push({type:"duplicate_seat",message:`${r} å­˜åœ¨é‡å¤åº§ä½ï¼šç¬¬${k}æ’ç¬¬${g}åº§`,meta:{floorId:p,floorName:r,rowLabel:k,seatLabel:g,duplicateIds:c}})}}}return{success:h.length===0,errors:h}}const Ln={class:"seat-map-editor-panel-scrollbar"},Nn={style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",height:"100%"}},On={class:"seat-map-editor-panel-scrollbar"},Pn={class:"seat-map-editor-footer"},Un=de({__name:"SeatMapEditorLayout",props:{isInModal:{type:Boolean,default:!1},isFullscreen:{type:Boolean,default:!1}},setup(l){const h=l;return(u,p)=>{const s=w("a-layout-header"),d=w("a-layout-sider"),i=w("a-layout-content"),c=w("a-layout");return I(),V(c,{style:Ie({height:h.isInModal?"100%":"100vh",background:"#f5f5f5",display:"flex",flexDirection:"column"})},{default:t(()=>[e(s,{style:Ie({background:"#ffffff",padding:"0 24px",borderBottom:"1px solid #f0f0f0",height:"64px",lineHeight:"64px",position:h.isInModal?"static":"sticky",top:h.isInModal?void 0:0,zIndex:100,flexShrink:0})},{default:t(()=>[Oe(u.$slots,"header")]),_:3},8,["style"]),e(c,{style:{background:"#f5f5f5",flex:1,overflow:"hidden",display:"flex"}},{default:t(()=>[h.isFullscreen?q("",!0):(I(),V(d,{key:0,width:240,style:Ie({background:"#ffffff",borderRight:"1px solid #f0f0f0",height:"100%",overflow:"hidden",position:h.isInModal?"static":"sticky",top:h.isInModal?void 0:64,left:0,flexShrink:0})},{default:t(()=>[x("div",Ln,[Oe(u.$slots,"left")])]),_:3},8,["style"])),e(i,{style:Ie({padding:h.isInModal?0:24,flex:1,display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",height:"100%"})},{default:t(()=>[x("div",Nn,[Oe(u.$slots,"canvas")])]),_:3},8,["style"]),h.isFullscreen?q("",!0):(I(),V(d,{key:1,width:320,style:Ie({background:"#ffffff",borderLeft:"1px solid #f0f0f0",height:"100%",overflow:"hidden",position:h.isInModal?"static":"sticky",top:h.isInModal?void 0:64,right:0,flexShrink:0})},{default:t(()=>[x("div",On,[Oe(u.$slots,"right")])]),_:3},8,["style"]))]),_:3}),x("div",Pn,[Oe(u.$slots,"footer")])]),_:3},8,["style"])}}}),An={style:{display:"flex","align-items":"center",gap:"16px",height:"100%"}},Vn={style:{flex:"1",display:"flex","justify-content":"flex-start"}},Yn={style:{flex:"0 0 auto",display:"flex","justify-content":"center"}},Bn={style:{flex:"1",display:"flex","justify-content":"flex-end"}},Xn=de({__name:"TopToolbar",props:{theaterName:{default:"åº§ä½å›¾ç¼–è¾‘å™¨"},canUndo:{type:Boolean,default:!1},canRedo:{type:Boolean,default:!1},isFullscreen:{type:Boolean,default:!1},showSeatLabels:{type:Boolean},zoomLevel:{}},emits:["import","export","undo","redo","showShortcuts","toggleFullscreen","batchGenerate","addStage","toggleSeatLabels","zoomIn","zoomOut","zoomChange"],setup(l,{emit:h}){const u=l,p=h,s=[{label:"50%",value:50},{label:"75%",value:75},{label:"100%",value:100},{label:"125%",value:125},{label:"150%",value:150},{label:"200%",value:200}];return(d,i)=>{const c=w("a-typography-text"),k=w("a-button"),g=w("a-tooltip"),m=w("a-divider"),r=w("a-switch"),o=w("a-select"),y=w("a-space");return I(),O("div",An,[x("div",Vn,[e(c,{strong:"",style:{"font-size":"16px"}},{default:t(()=>[v(" ğŸ›ï¸ "+B(u.theaterName),1)]),_:1})]),x("div",Yn,[e(y,{size:"small"},{default:t(()=>[e(g,{title:"å¿«é€Ÿç”Ÿæˆç½‘æ ¼åº§ä½"},{default:t(()=>[e(k,{type:"primary",onClick:i[0]||(i[0]=_=>p("batchGenerate"))},{icon:t(()=>[e(Y(Ct))]),default:t(()=>[i[12]||(i[12]=v(" ç”Ÿæˆåº§ä½ ",-1))]),_:1})]),_:1}),e(g,{title:"åœ¨ç”»å¸ƒä¸­æ·»åŠ èˆå°"},{default:t(()=>[e(k,{style:{background:"#722ED1",border:"none",color:"#ffffff"},onClick:i[1]||(i[1]=_=>p("addStage"))},{icon:t(()=>[e(Y(Da))]),default:t(()=>[i[13]||(i[13]=v(" æ·»åŠ èˆå° ",-1))]),_:1})]),_:1}),e(m,{type:"vertical",style:{margin:0,height:"24px"}}),e(g,{title:u.showSeatLabels?"éšè—åº§ä½ç¼–å·":"æ˜¾ç¤ºåº§ä½ç¼–å·"},{default:t(()=>[e(r,{checked:u.showSeatLabels,onChange:i[2]||(i[2]=_=>p("toggleSeatLabels",_))},null,8,["checked"])]),_:1},8,["title"]),e(m,{type:"vertical",style:{margin:0,height:"24px"}}),e(g,{title:"ç¼©å°"},{default:t(()=>[e(k,{size:"small",disabled:u.zoomLevel<=50,onClick:i[3]||(i[3]=_=>p("zoomOut"))},{icon:t(()=>[e(Y(Ma))]),_:1},8,["disabled"])]),_:1}),e(o,{value:u.zoomLevel,size:"small",style:{width:"80px"},options:s,onChange:i[4]||(i[4]=_=>p("zoomChange",_))},null,8,["value"]),e(g,{title:"æ”¾å¤§"},{default:t(()=>[e(k,{size:"small",disabled:u.zoomLevel>=200,onClick:i[5]||(i[5]=_=>p("zoomIn"))},{icon:t(()=>[e(Y(Fa))]),_:1},8,["disabled"])]),_:1})]),_:1})]),x("div",Bn,[e(y,{size:"small"},{default:t(()=>[e(g,{title:"æ’¤é”€ (Ctrl+Z)"},{default:t(()=>[e(k,{disabled:!u.canUndo,onClick:i[6]||(i[6]=_=>p("undo"))},{icon:t(()=>[e(Y(Ea))]),default:t(()=>[i[14]||(i[14]=v(" æ’¤é”€ ",-1))]),_:1},8,["disabled"])]),_:1}),e(g,{title:"é‡åš (Ctrl+Shift+Z)"},{default:t(()=>[e(k,{disabled:!u.canRedo,onClick:i[7]||(i[7]=_=>p("redo"))},{icon:t(()=>[e(Y(xt))]),default:t(()=>[i[15]||(i[15]=v(" é‡åš ",-1))]),_:1},8,["disabled"])]),_:1}),e(k,{onClick:i[8]||(i[8]=_=>p("import"))},{icon:t(()=>[e(Y(La))]),default:t(()=>[i[16]||(i[16]=v(" å¯¼å…¥ ",-1))]),_:1}),e(k,{onClick:i[9]||(i[9]=_=>p("export"))},{icon:t(()=>[e(Y(Na))]),default:t(()=>[i[17]||(i[17]=v(" å¯¼å‡º ",-1))]),_:1}),e(g,{title:u.isFullscreen?"é€€å‡ºå…¨å± (Ctrl+\\\\ æˆ– Esc)":"å…¨å±æ¨¡å¼ (Ctrl+\\\\)"},{default:t(()=>[e(k,{type:u.isFullscreen?"primary":"default",onClick:i[10]||(i[10]=_=>p("toggleFullscreen"))},{icon:t(()=>[(I(),V(St(u.isFullscreen?Y(Oa):Y(Pa))))]),default:t(()=>[v(" "+B(u.isFullscreen?"é€€å‡ºå…¨å±":"å…¨å±"),1)]),_:1},8,["type"])]),_:1},8,["title"]),e(g,{title:"å¿«æ·é”®è¯´æ˜ (?)"},{default:t(()=>[e(k,{onClick:i[11]||(i[11]=_=>p("showShortcuts"))},{icon:t(()=>[e(Y(Wt))]),default:t(()=>[i[18]||(i[18]=v(" å¿«æ·é”® ",-1))]),_:1})]),_:1})]),_:1})])])}}}),Zn={key:1,style:{"margin-top":"24px",padding:"16px",background:"#f0f5ff","border-radius":"4px",border:"1px solid #adc6ff"}},Gn=de({__name:"BatchGenerateModal",props:{visible:{type:Boolean,default:!1},startPosition:{}},emits:["ok","cancel"],setup(l,{emit:h}){const u=l,p=h,s=o=>({x:o?.x??0,y:o?.y??0,startRow:1,startSeat:1,rowCount:10,seatsPerRow:20,rowSpacing:10,seatSpacing:10,status:"available",disabledReason:void 0}),d=E(),i=E(!1),c=Qe(s(u.startPosition)),k=W(()=>{const o=Number(c.rowCount)||0,y=Number(c.seatsPerRow)||0;return o*y}),g=[{label:"è®¾å¤‡å ç”¨",value:"equipment"},{label:"ç»´æŠ¤ä¸­",value:"maintenance"},{label:"å…¶ä»–",value:"other"}];_e(()=>u.visible,o=>{const y=d.value;if(o){const _=s(u.startPosition);Object.assign(c,_),i.value=c.status==="disabled",y?.clearValidate&&y.clearValidate()}else y&&y.resetFields()}),_e(()=>c.status,o=>{i.value=o==="disabled",o!=="disabled"&&(c.disabledReason=void 0)},{immediate:!0});const m=async()=>{const o=d.value;if(o)try{await o.validateFields();const y=[];if(c.rowSpacing%10!==0&&y.push({name:"rowSpacing",errors:["é—´è·å¿…é¡»æ˜¯ 10 çš„å€æ•°"]}),c.seatSpacing%10!==0&&y.push({name:"seatSpacing",errors:["é—´è·å¿…é¡»æ˜¯ 10 çš„å€æ•°"]}),y.length>0){o.setFields(y);return}const{x:_,y:b,...f}=c;p("ok",f,{x:_,y:b});const a=s(u.startPosition);Object.assign(c,a),i.value=!1,o.resetFields()}catch(y){console.error("æ‰¹é‡ç”Ÿæˆåº§ä½è¡¨å•æ ¡éªŒå¤±è´¥:",y)}},r=()=>{const o=d.value;o&&o.resetFields();const y=s(u.startPosition);Object.assign(c,y),i.value=!1,p("cancel")};return(o,y)=>{const _=w("a-typography-title"),b=w("a-typography-text"),f=w("a-input-number"),a=w("a-form-item"),n=w("a-space"),S=w("a-radio"),z=w("a-radio-group"),$=w("a-form"),F=w("a-modal");return I(),V(F,{title:"æ‰¹é‡ç”Ÿæˆåº§ä½",open:u.visible,width:600,centered:"","ok-text":"ç”Ÿæˆåº§ä½","cancel-text":"å–æ¶ˆ",onOk:m,onCancel:r},{default:t(()=>[e($,{ref_key:"formRef",ref:d,layout:"vertical",model:c},{default:t(()=>[e(_,{level:5},{default:t(()=>[...y[10]||(y[10]=[v("ğŸ“ èµ·å§‹ä½ç½®",-1)])]),_:1}),e(b,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"12px"}},{default:t(()=>[...y[11]||(y[11]=[v(" åæ ‡æŒ‡çš„æ˜¯åº§ä½åŒºåŸŸçš„",-1),x("strong",null,"ä¸­å¿ƒç‚¹ä½ç½®",-1),v("ï¼ˆ0,0 åœ¨ç”»å¸ƒä¸­å¿ƒï¼‰ ",-1)])]),_:1}),e(n,{size:"large",style:{width:"100%"}},{default:t(()=>[e(a,{label:"X åæ ‡",name:"x",rules:[{required:!0,message:"è¯·è¾“å…¥ X åæ ‡"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(f,{value:c.x,"onUpdate:value":y[0]||(y[0]=D=>c.x=D),min:-5e3,max:5e3,placeholder:"æ¨ªå‘ä½ç½®",style:{width:"120px"}},null,8,["value"])]),_:1}),e(a,{label:"Y åæ ‡",name:"y",rules:[{required:!0,message:"è¯·è¾“å…¥ Y åæ ‡"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(f,{value:c.y,"onUpdate:value":y[1]||(y[1]=D=>c.y=D),min:-5e3,max:5e3,placeholder:"çºµå‘ä½ç½®",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),e(_,{level:5},{default:t(()=>[...y[12]||(y[12]=[v("ğŸ”¢ ç¼–å·è®¾ç½®",-1)])]),_:1}),e(n,{size:"large",style:{width:"100%"}},{default:t(()=>[e(a,{label:"èµ·å§‹æ’å·",name:"startRow",rules:[{required:!0,message:"è¯·è¾“å…¥èµ·å§‹æ’å·"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(f,{value:c.startRow,"onUpdate:value":y[2]||(y[2]=D=>c.startRow=D),min:1,placeholder:"ä¾‹å¦‚ï¼š1",style:{width:"120px"}},null,8,["value"])]),_:1}),e(a,{label:"èµ·å§‹åº§å·",name:"startSeat",rules:[{required:!0,message:"è¯·è¾“å…¥èµ·å§‹åº§å·"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(f,{value:c.startSeat,"onUpdate:value":y[3]||(y[3]=D=>c.startSeat=D),min:1,placeholder:"ä¾‹å¦‚ï¼š1",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),e(_,{level:5},{default:t(()=>[...y[13]||(y[13]=[v("ğŸ“ å¸ƒå±€è®¾ç½®",-1)])]),_:1}),e(b,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"12px"}},{default:t(()=>[...y[14]||(y[14]=[v(" ä½¿ç”¨åŠ¨æ€ç½‘æ ¼ç³»ç»Ÿï¼šç½‘æ ¼å¤§å° = åº§ä½å¤§å° + é—´è·ï¼Œåº§ä½åµŒå…¥æ ¼å­å†…éƒ¨ï¼Œå››å‘¨ç•™ç™½ä½œä¸ºé—´è· ",-1)])]),_:1}),e(n,{size:"large",style:{width:"100%"}},{default:t(()=>[e(a,{label:"æ’æ•°",name:"rowCount",rules:[{required:!0,message:"è¯·è¾“å…¥æ’æ•°"},{type:"number",min:1,max:100,message:"æ’æ•°èŒƒå›´: 1-100"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(f,{value:c.rowCount,"onUpdate:value":y[4]||(y[4]=D=>c.rowCount=D),min:1,max:100,placeholder:"æ€»å…±å¤šå°‘æ’",style:{width:"120px"}},null,8,["value"])]),_:1}),e(a,{label:"æ¯æ’åº§ä½æ•°",name:"seatsPerRow",rules:[{required:!0,message:"è¯·è¾“å…¥æ¯æ’åº§ä½æ•°"},{type:"number",min:1,max:100,message:"åº§ä½æ•°èŒƒå›´: 1-100"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(f,{value:c.seatsPerRow,"onUpdate:value":y[5]||(y[5]=D=>c.seatsPerRow=D),min:1,max:100,placeholder:"æ¯æ’å¤šå°‘åº§",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),e(n,{size:"large",style:{width:"100%"}},{default:t(()=>[e(a,{label:"æ’é—´è·ï¼ˆåƒç´ ï¼‰",name:"rowSpacing",rules:[{required:!0,message:"è¯·è¾“å…¥æ’é—´è·"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(f,{value:c.rowSpacing,"onUpdate:value":y[6]||(y[6]=D=>c.rowSpacing=D),min:0,max:100,step:10,placeholder:"æ’ä¸æ’ä¹‹é—´çš„è·ç¦»",style:{width:"120px"}},null,8,["value"])]),_:1}),e(a,{label:"åº§é—´è·ï¼ˆåƒç´ ï¼‰",name:"seatSpacing",rules:[{required:!0,message:"è¯·è¾“å…¥åº§é—´è·"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(f,{value:c.seatSpacing,"onUpdate:value":y[7]||(y[7]=D=>c.seatSpacing=D),min:0,max:100,step:10,placeholder:"åº§ä½ä¹‹é—´çš„è·ç¦»",style:{width:"120px"}},null,8,["value"])]),_:1})]),_:1}),e(_,{level:5},{default:t(()=>[...y[15]||(y[15]=[v("âš™ çŠ¶æ€è®¾ç½®",-1)])]),_:1}),e(b,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"12px"}},{default:t(()=>[...y[16]||(y[16]=[v(" è®¾ç½®ç”Ÿæˆåº§ä½çš„åˆå§‹çŠ¶æ€ ",-1)])]),_:1}),e(a,{label:"åº§ä½çŠ¶æ€",name:"status",rules:[{required:!0,message:"è¯·é€‰æ‹©åº§ä½çŠ¶æ€"}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(z,{value:c.status,"onUpdate:value":y[8]||(y[8]=D=>c.status=D)},{default:t(()=>[e(S,{value:"available"},{default:t(()=>[...y[17]||(y[17]=[v(" å¯ç”¨ ",-1)])]),_:1}),e(S,{value:"disabled"},{default:t(()=>[...y[18]||(y[18]=[v(" ç¦ç”¨ ",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),i.value?(I(),V(a,{key:0,label:"ç¦ç”¨åŸå› ",name:"disabledReason",rules:[{required:!0,message:"è¯·é€‰æ‹©ç¦ç”¨åŸå› "}],style:{"margin-bottom":"16px"}},{default:t(()=>[e(z,{value:c.disabledReason,"onUpdate:value":y[9]||(y[9]=D=>c.disabledReason=D)},{default:t(()=>[(I(),O(oe,null,Se(g,D=>e(S,{key:D.value,value:D.value},{default:t(()=>[v(B(D.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1})):q("",!0),k.value>0?(I(),O("div",Zn,[e(b,{strong:"",style:{color:"#1890ff"}},{default:t(()=>[v(" ğŸ“Š é¢„è®¡ç”Ÿæˆ "+B(k.value)+" ä¸ªåº§ä½ ",1)]),_:1})])):q("",!0)]),_:1},8,["model"])]),_:1},8,["open"])}}}),at=["#26a6eb","#47c464","#f74848","#ff9e3d","#FFC53D","#FFE53D","#A2D923","#36CFCF","#3B79E3","#4C3FC4","#9D56E3","#EB54A7"],Zt={available:"#52C41A",disabled:"#FF4D4F"},qn=8,jn={key:0},Hn={style:{"margin-bottom":"20px"}},Kn={style:{background:"#fafafa",padding:"12px","border-radius":"6px"}},Wn={style:{"font-size":"16px","font-weight":"600",color:"#262626","margin-bottom":"8px"}},Jn={style:{"font-size":"14px",color:"#595959","line-height":"1.6"}},Qn={key:0},el={key:1,style:{margin:"0 6px",color:"#d9d9d9"}},tl={key:2},al={key:0,style:{"font-size":"12px",color:"#8c8c8c","margin-top":"6px","line-height":"1.6"}},nl={key:0},ll={key:1,style:{margin:"0 6px",color:"#d9d9d9"}},ol={key:2},sl={key:3,style:{margin:"0 6px",color:"#d9d9d9"}},il={key:4},rl={key:1,style:{"font-size":"12px",color:"#8c8c8c","margin-top":"6px"}},ul={style:{"margin-bottom":"20px"}},dl={style:{"margin-bottom":"20px"}},cl={style:{padding:"16px 0"}},pl=de({__name:"SeatEditPanel",props:{selectedSeats:{},zones:{}},emits:["update-status","delete-seats","create-zone","assign-to-zone"],setup(l,{emit:h}){const u=l,p=h,s=E(!1),d=E("equipment"),i=[{label:"å¯ç”¨",value:"available",color:Zt.available,icon:Ua,description:"æ­£å¸¸å¯ç”¨åº§ä½"},{label:"ç¦ç”¨",value:"disabled",color:Zt.disabled,icon:Aa,description:"è®¾å¤‡å ç”¨ã€ç»´æŠ¤ä¸­ã€å…¶ä»–åŸå› "}],c=[{label:"è®¾å¤‡å ç”¨",value:"equipment"},{label:"ç»´æŠ¤ä¸­",value:"maintenance"},{label:"å…¶ä»–",value:"other"}],k=W(()=>u.selectedSeats.length>0),g=W(()=>{if(!u.selectedSeats.length)return;if(u.selectedSeats.length===1)return u.selectedSeats[0].status;const f=u.selectedSeats[0].status;return u.selectedSeats.every(n=>n.status===f)?f:void 0}),m=W(()=>{if(u.selectedSeats.length!==1)return;const f=u.selectedSeats[0];return f.status==="disabled"?f.disabledReason:void 0}),r=W(()=>{const f={available:0,disabled:0};return u.selectedSeats.forEach(a=>{a.status in f&&(f[a.status]+=1)}),f}),o=W(()=>{const f={equipment:0,maintenance:0,other:0};return u.selectedSeats.forEach(a=>{if(a.status==="disabled"&&a.disabledReason&&a.disabledReason in f){const n=a.disabledReason;f[n]+=1}}),f}),y=f=>{f==="disabled"?s.value=!0:p("update-status",f)},_=()=>{p("update-status","disabled",d.value),s.value=!1},b=f=>{p("assign-to-zone",f)};return(f,a)=>{const n=w("a-typography-title"),S=w("a-empty"),z=w("a-space"),$=w("a-radio"),F=w("a-radio-group"),D=w("a-button"),P=w("a-menu-item"),A=w("a-menu"),Z=w("a-dropdown"),ne=w("a-tooltip"),T=w("a-divider"),L=w("a-typography-text"),H=w("a-modal");return I(),O("div",null,[k.value?(I(),O(oe,{key:1},[x("div",Hn,[e(n,{level:5,style:{"margin-bottom":"8px"}},{default:t(()=>[...a[7]||(a[7]=[v(" é€‰ä¸­åº§ä½ ",-1)])]),_:1}),x("div",Kn,[x("div",Wn,B(l.selectedSeats.length)+" ä¸ªåº§ä½ ",1),a[8]||(a[8]=x("div",{style:{height:"1px",background:"#e8e8e8",margin:"8px 0"}},null,-1)),x("div",Jn,[r.value.available>0?(I(),O("span",Qn,B(r.value.available)+" å¯ç”¨ ",1)):q("",!0),r.value.available>0&&r.value.disabled>0?(I(),O("span",el," Â· ")):q("",!0),r.value.disabled>0?(I(),O("span",tl,B(r.value.disabled)+" ç¦ç”¨ ",1)):q("",!0)]),l.selectedSeats.length>1&&r.value.disabled>0?(I(),O("div",al,[o.value.equipment>0?(I(),O("span",nl," è®¾å¤‡å ç”¨ "+B(o.value.equipment),1)):q("",!0),o.value.equipment>0&&(o.value.maintenance>0||o.value.other>0)?(I(),O("span",ll," Â· ")):q("",!0),o.value.maintenance>0?(I(),O("span",ol," ç»´æŠ¤ä¸­ "+B(o.value.maintenance),1)):q("",!0),o.value.maintenance>0&&o.value.other>0?(I(),O("span",sl," Â· ")):q("",!0),o.value.other>0?(I(),O("span",il," å…¶ä»– "+B(o.value.other),1)):q("",!0)])):q("",!0),m.value?(I(),O("div",rl,B(c.find(J=>J.value===m.value)?.label),1)):q("",!0)])]),x("div",ul,[e(n,{level:5,style:{"margin-bottom":"12px"}},{default:t(()=>[...a[9]||(a[9]=[v(" åº§ä½çŠ¶æ€ ",-1)])]),_:1}),e(z,null,{default:t(()=>[e(F,{value:g.value,onChange:a[0]||(a[0]=J=>y(J.target.value))},{default:t(()=>[(I(),O(oe,null,Se(i,J=>e($,{key:J.value,value:J.value},{default:t(()=>[e(z,null,{default:t(()=>[(I(),V(St(J.icon),{style:Ie({color:J.color})},null,8,["style"])),x("span",null,B(J.label),1)]),_:2},1024)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1})]),x("div",dl,[e(n,{level:5,style:{"margin-bottom":"8px"}},{default:t(()=>[...a[10]||(a[10]=[v(" åº§åŒºæ“ä½œ ",-1)])]),_:1}),e(z,{direction:"vertical",size:8,style:{width:"100%"}},{default:t(()=>[e(D,{type:"primary",block:"",onClick:a[1]||(a[1]=J=>p("create-zone"))},{icon:t(()=>[e(Y(Jt))]),default:t(()=>[v(" åˆ›å»ºæ–°åº§åŒº ("+B(l.selectedSeats.length)+") ",1)]),_:1}),l.zones?(I(),O(oe,{key:0},[l.zones.length?(I(),V(Z,{key:0},{overlay:t(()=>[e(A,null,{default:t(()=>[(I(!0),O(oe,null,Se(l.zones,J=>(I(),V(P,{key:J.id,onClick:ue=>b(J.id)},{default:t(()=>[v(B(J.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:t(()=>[e(D,{block:""},{default:t(()=>[v(" åˆ†é…åˆ°åº§åŒº ("+B(l.selectedSeats.length)+") ",1),e(Y(Vt))]),_:1})]),_:1})):(I(),V(ne,{key:1,title:"å½“å‰æ¥¼å±‚æš‚æ— åº§åŒºï¼Œè¯·å…ˆåˆ›å»ºåº§åŒº"},{default:t(()=>[e(D,{block:"",disabled:""},{default:t(()=>[v(" åˆ†é…åˆ°åº§åŒº ("+B(l.selectedSeats.length)+") ",1),e(Y(Vt))]),_:1})]),_:1}))],64)):q("",!0)]),_:1})]),e(T),e(D,{danger:"",block:"",onClick:a[2]||(a[2]=J=>p("delete-seats"))},{icon:t(()=>[e(Y(Je))]),default:t(()=>[a[11]||(a[11]=v(" åˆ é™¤é€‰ä¸­åº§ä½ ",-1))]),_:1})],64)):(I(),O("div",jn,[e(n,{level:5,style:{"margin-bottom":"12px"}},{default:t(()=>[...a[5]||(a[5]=[v(" åº§ä½å±æ€§ ",-1)])]),_:1}),e(S,{description:"é€‰ä¸­åº§ä½ä»¥ç¼–è¾‘å±æ€§",style:{padding:"32px 0"}}),a[6]||(a[6]=x("div",{style:{"margin-top":"16px",padding:"12px 16px",background:"#f5f5f5","border-radius":"8px","font-size":"13px",color:"#595959","line-height":"1.6"}}," é€šè¿‡ç”»å¸ƒé€‰ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªåº§ä½ï¼Œç„¶ååœ¨è¿™é‡Œä¿®æ”¹çŠ¶æ€æˆ–åˆ†é…åº§åŒºã€‚ ",-1))])),e(H,{title:"è¯·é€‰æ‹©ç¦ç”¨åŸå› ",open:s.value,onOk:_,onCancel:a[4]||(a[4]=()=>s.value=!1),centered:"","ok-text":"ç¡®å®š","cancel-text":"å–æ¶ˆ",width:"400"},{default:t(()=>[x("div",cl,[e(L,{type:"secondary",style:{display:"block","margin-bottom":"16px"}},{default:t(()=>[...a[12]||(a[12]=[v(" è¯·é€‰æ‹©åº§ä½ç¦ç”¨çš„åŸå› ï¼š ",-1)])]),_:1}),e(F,{value:d.value,"onUpdate:value":a[3]||(a[3]=J=>d.value=J),style:{width:"100%"}},{default:t(()=>[e(z,{direction:"vertical",size:"small",style:{width:"100%"}},{default:t(()=>[(I(),O(oe,null,Se(c,J=>e($,{key:J.value,value:J.value},{default:t(()=>[v(B(J.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])])]),_:1},8,["open"])])}}}),fl={key:0},ml={key:1},vl={style:{"margin-bottom":"12px"}},yl=["onClick"],gl={style:{"margin-top":"24px"}},_l={style:{flex:"1"}},bl={style:{flex:"1"}},hl=de({__name:"StageEditPanel",props:{selectedStage:{},stage:{}},emits:["updateStage","deleteStage","addStage"],setup(l,{emit:h}){const u=l,p=h,s=[{label:"æ¢¯å½¢",value:"trapezoid"},{label:"çŸ©å½¢",value:"rect"},{label:"å¼§å½¢",value:"arc"}],d=["#dedede","#7ad9ff","#b5f5ec","#efdbff","#ffd6e7","#b0e5b7","#d6e4ff","#fff1b8"],i=k=>{u.selectedStage&&p("updateStage",u.selectedStage.id,k)},c=()=>{u.selectedStage&&p("deleteStage",u.selectedStage.id)};return(k,g)=>{const m=w("a-empty"),r=w("a-input"),o=w("a-form-item"),y=w("a-form"),_=w("a-typography-text"),b=w("a-space"),f=w("a-select"),a=w("a-typography-title"),n=w("a-input-number"),S=w("a-button");return I(),O("div",null,[l.selectedStage?(I(),O(oe,{key:1},[e(b,{direction:"vertical",size:"middle",style:{width:"100%"}},{default:t(()=>[e(y,{layout:"vertical"},{default:t(()=>[e(o,{label:"èˆå°åç§°"},{default:t(()=>[e(r,{value:l.selectedStage.name,placeholder:"èˆå°åç§°",onChange:g[0]||(g[0]=z=>i({name:z.target.value}))},null,8,["value"])]),_:1})]),_:1}),x("div",null,[e(_,{strong:"",style:{"margin-bottom":"8px",display:"block"}},{default:t(()=>[...g[5]||(g[5]=[v(" å¤–è§‚è®¾ç½® ",-1)])]),_:1}),x("div",vl,[e(_,{type:"secondary",style:{"font-size":"11px",display:"block","margin-bottom":"4px"}},{default:t(()=>[...g[6]||(g[6]=[v(" èˆå°é¢œè‰² ",-1)])]),_:1}),e(b,{size:"small",wrap:""},{default:t(()=>[(I(),O(oe,null,Se(d,z=>x("div",{key:z,style:Ie({width:"24px",height:"24px",borderRadius:"4px",backgroundColor:z,cursor:"pointer",border:l.selectedStage.color===z?"2px solid #1890ff":"1px solid #d9d9d9",transition:"all 0.2s"}),onClick:$=>i({color:z})},null,12,yl)),64))]),_:1})]),x("div",null,[e(_,{type:"secondary",style:{"font-size":"11px",display:"block","margin-bottom":"4px"}},{default:t(()=>[...g[7]||(g[7]=[v(" èˆå°å½¢çŠ¶ ",-1)])]),_:1}),e(f,{value:l.selectedStage.shape,style:{width:"100%"},options:s,onChange:g[1]||(g[1]=z=>i({shape:z}))},null,8,["value"])])])]),_:1}),x("div",gl,[e(a,{level:5,style:{"margin-bottom":"12px"}},{default:t(()=>[...g[8]||(g[8]=[v(" å°ºå¯¸è®¾ç½® ",-1)])]),_:1}),e(b,{direction:"vertical",size:12,style:{width:"100%"}},{default:t(()=>[x("div",null,[e(b,{size:12,style:{width:"100%"}},{default:t(()=>[x("div",_l,[e(_,{type:"secondary",style:{"font-size":"11px",display:"block","margin-bottom":"4px"}},{default:t(()=>[...g[9]||(g[9]=[v(" èˆå°å®½åº¦ ",-1)])]),_:1}),e(n,{value:Math.round(l.selectedStage.width),min:100,max:800,step:10,style:{width:"100%"},placeholder:"å®½åº¦","addon-after":"px",onChange:g[2]||(g[2]=z=>{const $=z?Math.round(z/10)*10:480;i({width:$})})},null,8,["value"])]),x("div",bl,[e(_,{type:"secondary",style:{"font-size":"11px",display:"block","margin-bottom":"4px"}},{default:t(()=>[...g[10]||(g[10]=[v(" èˆå°é«˜åº¦ ",-1)])]),_:1}),e(n,{value:Math.round(l.selectedStage.height),min:40,max:200,step:10,style:{width:"100%"},placeholder:"é«˜åº¦","addon-after":"px",onChange:g[3]||(g[3]=z=>{const $=z?Math.round(z/10)*10:40;i({height:$})})},null,8,["value"])])]),_:1}),g[11]||(g[11]=x("div",{style:{"margin-top":"8px",padding:"8px",background:"#fafafa","border-radius":"4px","font-size":"11px",color:"#8c8c8c","word-break":"break-word"}}," å°ºå¯¸ä¼šè‡ªåŠ¨è°ƒæ•´ä¸º 10 çš„å€æ•°ï¼Œä¸ç½‘æ ¼å¯¹é½ã€‚èˆå°å›ºå®šåœ¨ç”»å¸ƒä¸Šæ–¹å±…ä¸­ã€‚ ",-1))])]),_:1})]),e(S,{danger:"",block:"",style:{"margin-top":"24px"},onClick:c},{icon:t(()=>[e(Y(Je))]),default:t(()=>[g[12]||(g[12]=v(" åˆ é™¤èˆå° ",-1))]),_:1})],64)):(I(),O(oe,{key:0},[l.stage?(I(),O("div",ml,[e(m,{description:"ç‚¹å‡»ç”»å¸ƒä¸­çš„èˆå°å¼€å§‹ç¼–è¾‘",style:{padding:"24px 0"}})])):(I(),O("div",fl,[e(m,{description:"æš‚æ— èˆå°",style:{padding:"24px 0"}}),g[4]||(g[4]=x("div",{style:{"margin-top":"16px",padding:"12px 16px",background:"#f5f5f5","border-radius":"8px","font-size":"13px",color:"#595959","line-height":"1.6","text-align":"center"}},[v(" ğŸ’¡ åœ¨ç”»å¸ƒé¡¶éƒ¨æ“ä½œæ ç‚¹å‡» "),x("strong",{style:{color:"#1890ff"}},"æ·»åŠ èˆå°"),v(" æŒ‰é’® ")],-1))]))],64))])}}}),xl=["title","onClick"],kl={style:{"margin-top":"16px",padding:"12px",background:"#f0f5ff",border:"1px solid #adc6ff","border-radius":"4px"}},oa=de({__name:"ZoneConfigModal",props:{visible:{type:Boolean},zone:{},venueId:{},floorId:{},existingZones:{}},emits:["ok","cancel"],setup(l,{emit:h}){const u=l,p=h,s=E(),d=E(at[0]),i=E({name:"",shortName:"",color:at[0],order:1});_e(()=>u.visible,g=>{if(!g)return;let m;if(u.zone)m={name:u.zone.name||"",shortName:u.zone.shortName||"",color:u.zone.color||at[0],order:u.zone.order||1};else{const o=u.existingZones.length>0?Math.max(...u.existingZones.map(y=>y.order))+1:1;m={name:"",shortName:"",color:at[0],order:o}}i.value=m,d.value=m.color,s.value?.clearValidate?.()});const c=async()=>{const g=s.value;if(g)try{await g.validate();const m=i.value;if(u.existingZones.some(o=>o.name===m.name&&o.id!==u.zone?.id)){g.setFields?.([{name:"name",errors:["è¯¥æ¥¼å±‚å·²å­˜åœ¨åŒååº§åŒº"]}]);return}p("ok",{name:m.name,shortName:m.shortName||void 0,color:d.value,order:m.order})}catch(m){console.error("è¡¨å•æ ¡éªŒå¤±è´¥:",m)}},k=()=>{p("cancel")};return(g,m)=>{const r=w("a-input"),o=w("a-form-item"),y=w("a-space"),_=w("a-input-number"),b=w("a-form"),f=w("a-typography-text"),a=w("a-modal");return I(),V(a,{title:l.zone?"ç¼–è¾‘åº§åŒºé…ç½®":"æ–°å»ºåº§åŒºé…ç½®",open:l.visible,width:"500",centered:"",onOk:c,onCancel:k},{default:t(()=>[e(b,{ref_key:"formRef",ref:s,layout:"vertical",model:i.value,style:{"margin-top":"16px"}},{default:t(()=>[e(o,{label:"åº§åŒºåç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥åº§åŒºåç§°"},{max:20,message:"åº§åŒºåç§°ä¸èƒ½è¶…è¿‡ 20 ä¸ªå­—"}],tooltip:"ä¾‹å¦‚ï¼šVIPåŒºã€AåŒºã€BåŒºã€æ± åº§ã€æ¥¼åº§"},{default:t(()=>[e(r,{value:i.value.name,"onUpdate:value":m[0]||(m[0]=n=>i.value.name=n),placeholder:"è¯·è¾“å…¥åº§åŒºåç§°",maxlength:20,"show-count":""},null,8,["value"])]),_:1}),e(o,{label:"ç®€ç§°ï¼ˆå¯é€‰ï¼‰",name:"shortName",rules:[{max:5,message:"ç®€ç§°ä¸èƒ½è¶…è¿‡ 5 ä¸ªå­—"}],tooltip:"ç”¨äºåœ¨åº§ä½æ ‡ç­¾ä¸Šæ˜¾ç¤ºï¼Œä¾‹å¦‚ï¼šVã€Aã€B"},{default:t(()=>[e(r,{value:i.value.shortName,"onUpdate:value":m[1]||(m[1]=n=>i.value.shortName=n),placeholder:"å¦‚ï¼šVã€Aã€B",maxlength:5},null,8,["value"])]),_:1}),e(o,{label:"åº§åŒºé¢œè‰²",name:"color",tooltip:"åº§ä½å°†åœ¨åº§åŒºè§†å›¾ä¸­æ˜¾ç¤ºä¸ºæ­¤é¢œè‰²"},{default:t(()=>[e(y,{direction:"vertical",style:{width:"100%"}},{default:t(()=>[e(y,{wrap:""},{default:t(()=>[(I(!0),O(oe,null,Se(Y(at),n=>(I(),O("div",{key:n,style:Ie({width:"32px",height:"32px",backgroundColor:n,border:d.value===n?"3px solid #1890ff":"1px solid #d9d9d9",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s"}),title:n,onClick:()=>{d.value=n,i.value.color=n}},null,12,xl))),128))]),_:1})]),_:1})]),_:1}),e(o,{label:"æ˜¾ç¤ºé¡ºåº",name:"order",rules:[{required:!0,message:"è¯·è¾“å…¥æ˜¾ç¤ºé¡ºåº"},{type:"number",min:1,message:"æ˜¾ç¤ºé¡ºåºå¿…é¡»å¤§äº 0"}],tooltip:"æ•°å­—è¶Šå°è¶Šé å‰ï¼Œç”¨äºåˆ—è¡¨æ’åº"},{default:t(()=>[e(_,{value:i.value.order,"onUpdate:value":m[2]||(m[2]=n=>i.value.order=n),placeholder:"1",style:{width:"100%"},min:1,precision:0},null,8,["value"])]),_:1})]),_:1},8,["model"]),x("div",kl,[e(f,{type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[...m[3]||(m[3]=[v(" æç¤ºï¼šåº§åŒºæ˜¯é…ç½®æ•°æ®ï¼Œä¸åŒ…å«å‡ ä½•ä½ç½®ã€‚åº§åŒºçš„è¾¹ç•Œç”±åŒ…å«çš„åº§ä½åŠ¨æ€å†³å®šã€‚åˆ›å»ºåº§åŒºåï¼Œå¯ä»¥åœ¨å³ä¾§é¢æ¿ä¸­æ‰¹é‡åˆ†é…åº§ä½åˆ°è¯¥åº§åŒºã€‚ ",-1)])]),_:1})])]),_:1},8,["title","open"])}}}),wl={style:{display:"flex","flex-direction":"column"}},Sl={key:0,style:{width:"100%","margin-bottom":"12px"}},Cl={style:{"overflow-y":"auto","max-height":"400px"}},Il={style:{display:"flex","align-items":"center",gap:"8px"}},Tl={style:{flex:"1"}},$l={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"6px"}},Rl={style:{display:"flex","justify-content":"flex-end"}},zl=de({__name:"ZoneListPanel",props:{venueId:{},currentFloorId:{},zones:{},seats:{},selectedSeatIds:{}},emits:["updateZone","deleteZone","assignSeatsToZone"],setup(l,{emit:h}){const u=l,p=h,s=E(!1),d=E(void 0),i=E(""),c=E("all"),k=W(()=>u.zones.filter(a=>a.floorId===u.currentFloorId)),g=W(()=>[...k.value].sort((a,n)=>a.order-n.order)),m=a=>u.seats.filter(n=>n.zoneId===a&&n.floorId===u.currentFloorId).length,r=W(()=>k.value.length>=qn),o=W(()=>{const a=i.value.trim().toLowerCase();return g.value.filter(n=>{const S=m(n.id),z=!a||n.name.toLowerCase().includes(a)||(n.shortName||"").toLowerCase().includes(a);let $=!0;switch(c.value){case"empty":$=S===0;break;case"small":$=S>0&&S<=50;break;case"medium":$=S>50&&S<=200;break;case"large":$=S>200;break;case"all":default:$=!0}return z&&$})}),y=a=>{d.value=a,s.value=!0},_=a=>{const n=d.value;n&&p("updateZone",n.id,a),s.value=!1,d.value=void 0},b=()=>{s.value=!1,d.value=void 0},f=a=>{const n=m(a);n>0?nt.confirm({title:"åˆ é™¤åº§åŒº",content:`åº§åŒºå†…æœ‰ ${n} ä¸ªåº§ä½ï¼Œåˆ é™¤åè¿™äº›åº§ä½å°†å¤±å»åº§åŒºå…³è”ï¼Œç¡®å®šè¦åˆ é™¤å—ï¼Ÿ`,okText:"åˆ é™¤",okType:"danger",cancelText:"å–æ¶ˆ",centered:!0,onOk:()=>p("deleteZone",a)}):p("deleteZone",a)};return(a,n)=>{const S=w("a-input"),z=w("a-select-option"),$=w("a-select"),F=w("a-space"),D=w("a-empty"),P=w("a-typography-text"),A=w("a-badge"),Z=w("a-button"),ne=w("a-tooltip"),T=w("a-card");return I(),O("div",wl,[r.value?(I(),O("div",Sl,[e(F,{direction:"vertical",size:"small",style:{width:"100%"}},{default:t(()=>[e(S,{value:i.value,"onUpdate:value":n[0]||(n[0]=L=>i.value=L),placeholder:"æœç´¢åº§åŒºåç§°...","allow-clear":"",size:"small"},null,8,["value"]),e($,{value:c.value,"onUpdate:value":n[1]||(n[1]=L=>c.value=L),size:"small",style:{width:"100%"}},{default:t(()=>[e(z,{value:"all"},{default:t(()=>[...n[2]||(n[2]=[v(" å…¨éƒ¨åº§åŒº ",-1)])]),_:1}),e(z,{value:"empty"},{default:t(()=>[...n[3]||(n[3]=[v(" ç©ºåº§åŒºï¼ˆ0 åº§ï¼‰ ",-1)])]),_:1}),e(z,{value:"small"},{default:t(()=>[...n[4]||(n[4]=[v(" 1-50 åº§ ",-1)])]),_:1}),e(z,{value:"medium"},{default:t(()=>[...n[5]||(n[5]=[v(" 51-200 åº§ ",-1)])]),_:1}),e(z,{value:"large"},{default:t(()=>[...n[6]||(n[6]=[v(" 200 åº§ä»¥ä¸Š ",-1)])]),_:1})]),_:1},8,["value"])]),_:1})])):q("",!0),x("div",Cl,[g.value.length===0?(I(),O(oe,{key:0},[e(D,{description:"æš‚æ— åº§åŒº",style:{padding:"24px 0"}}),n[7]||(n[7]=x("div",{style:{"margin-top":"16px",padding:"12px 16px",background:"#f5f5f5","border-radius":"8px","font-size":"13px",color:"#595959","line-height":"1.6","text-align":"center"}}," ğŸ’¡ é€‰ä¸­åº§ä½åï¼Œåœ¨å³ä¾§é¢æ¿æˆ–å³é”®èœå•ä¸­åˆ›å»ºåº§åŒºã€‚ ",-1))],64)):o.value.length===0?(I(),V(D,{key:1,description:"æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åº§åŒº",style:{padding:"24px 0"}},{default:t(()=>[e(P,{type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[i.value?(I(),O(oe,{key:0},[v(" å…³é”®å­—â€œ"+B(i.value)+"â€æ— åŒ¹é…ç»“æœ ",1)],64)):c.value!=="all"?(I(),O(oe,{key:1},[v(" å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ— åº§åŒº ")],64)):q("",!0)]),_:1})]),_:1})):(I(),V(F,{key:2,direction:"vertical",size:"small",style:{width:"100%"}},{default:t(()=>[(I(!0),O(oe,null,Se(o.value,L=>(I(),V(T,{key:L.id,size:"small",bordered:!0,style:Ie({borderLeft:`4px solid ${L.color||"#ff4d4f"}`}),"body-style":{padding:"8px 12px"}},{default:t(()=>[x("div",Il,[x("div",Tl,[x("div",$l,[e(F,{size:6},{default:t(()=>[x("div",{style:Ie({width:"12px",height:"12px",backgroundColor:L.color||"#ff4d4f",borderRadius:"2px",border:"1px solid rgba(0,0,0,0.1)"})},null,4),e(P,{strong:"",style:{"font-size":"13px"}},{default:t(()=>[v(B(L.name),1)]),_:2},1024)]),_:2},1024),e(A,{count:m(L.id),"show-zero":!0,"number-style":{backgroundColor:m(L.id)>0?"#52c41a":"#d9d9d9",fontSize:"11px"}},null,8,["count","number-style"])]),x("div",Rl,[e(F,{size:"small"},{default:t(()=>[l.selectedSeatIds&&l.selectedSeatIds.length?(I(),V(ne,{key:0,title:`å°†é€‰ä¸­çš„ ${l.selectedSeatIds.length} ä¸ªåº§ä½åˆ†é…åˆ° ${L.name}`},{default:t(()=>[e(Z,{type:"text",size:"small",disabled:!l.selectedSeatIds||!l.selectedSeatIds.length,onClick:H=>p("assignSeatsToZone",L.id),style:{"font-size":"12px"}},{icon:t(()=>[e(Y(Va))]),_:1},8,["disabled","onClick"])]),_:2},1032,["title"])):q("",!0),e(ne,{title:"ç¼–è¾‘åº§åŒº"},{default:t(()=>[e(Z,{type:"text",size:"small",style:{"font-size":"12px"},onClick:H=>y(L)},{icon:t(()=>[e(Y(ct))]),_:1},8,["onClick"])]),_:2},1024),e(ne,{title:"åˆ é™¤åº§åŒº"},{default:t(()=>[e(Z,{type:"text",size:"small",danger:"",style:{"font-size":"12px"},onClick:H=>f(L.id)},{icon:t(()=>[e(Y(Je))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)])])])]),_:2},1032,["style"]))),128))]),_:1}))]),e(oa,{visible:s.value,zone:d.value,"venue-id":l.venueId,"floor-id":l.currentFloorId,"existing-zones":k.value,onOk:_,onCancel:b},null,8,["visible","zone","venue-id","floor-id","existing-zones"])])}}}),Dl={class:"seat-map-editor-panel-content",style:{display:"flex","flex-direction":"column",height:"100%","padding-right":"16px","box-sizing":"border-box","overflow-x":"hidden","word-break":"break-word"}},Ml={style:{"margin-bottom":"8px"}},Fl={style:{flex:"1",overflow:"auto"}},El={key:1},Ll={key:2},Nl={style:{"margin-top":"16px",background:"#f5f5f5",padding:"12px 16px","border-radius":"8px","font-size":"13px","line-height":"1.8"}},Ol={style:{color:"#595959",display:"flex","flex-direction":"column",gap:"6px"}},Pl={style:{display:"flex","align-items":"flex-start"}},Ul={style:{display:"flex","align-items":"flex-start"}},Al={key:1,style:{padding:"24px 0"}},Vl=de({__name:"RightPanel",props:{selectedElement:{},floor:{},selectedSeats:{},selectedStage:{},zones:{},stage:{},seats:{},venueId:{},currentFloorId:{}},emits:["updateSeatStatus","deleteSeats","createZone","assignToZone","updateStage","deleteStage","addStage","updateZone","deleteZone"],setup(l,{emit:h}){const u=l,p=h,s=E("seat");_e(()=>u.selectedElement,g=>{if(!g){s.value="seat";return}g.type==="seat"||g.type==="seats"?s.value="seat":g.type==="stage"?s.value="stage":s.value="zone"});const d=W(()=>(u.seats||[]).length>0),i=W(()=>!!(u.selectedElement&&(u.selectedElement.type==="seat"||u.selectedElement.type==="seats"))),c=W(()=>typeof navigator<"u"&&navigator.platform.toUpperCase().includes("MAC")),k=W(()=>c.value?"Command":"Ctrl");return(g,m)=>{const r=w("a-segmented"),o=w("a-empty");return I(),O("div",Dl,[x("div",Ml,[e(r,{value:s.value,"onUpdate:value":m[0]||(m[0]=y=>s.value=y),options:[{label:"ğŸ’º åº§ä½",value:"seat"},{label:"ğŸ­ èˆå°",value:"stage"},{label:"ğŸ·ï¸ åº§åŒº",value:"zone"}],block:""},null,8,["value"])]),x("div",Fl,[s.value==="seat"?(I(),O(oe,{key:0},[i.value?(I(),V(pl,{key:0,"selected-seats":l.selectedSeats,zones:l.zones||[],onUpdateStatus:m[1]||(m[1]=(y,_)=>p("updateSeatStatus",y,_)),onDeleteSeats:m[2]||(m[2]=()=>p("deleteSeats")),onCreateZone:m[3]||(m[3]=()=>p("createZone")),onAssignToZone:m[4]||(m[4]=y=>p("assignToZone",y))},null,8,["selected-seats","zones"])):d.value?(I(),O("div",Ll,[e(o,{image:void 0,description:"ç‚¹å‡»ç”»å¸ƒä¸Šçš„åº§ä½å¼€å§‹ç¼–è¾‘",style:{padding:"24px 0"}}),x("div",Nl,[m[19]||(m[19]=x("div",{style:{color:"#262626","margin-bottom":"8px","font-weight":"500"}}," ğŸ’¡ é€‰æ‹©åº§ä½çš„å››ç§æ–¹æ³•ï¼š ",-1)),x("div",Ol,[m[17]||(m[17]=x("div",{style:{display:"flex","align-items":"flex-start"}},[x("span",{style:{"margin-right":"8px",color:"#1890ff","font-weight":"500"}}," 1. "),x("span",null,[x("strong",null,"ç‚¹å‡»"),v("å•ä¸ªåº§ä½é€‰ä¸­")])],-1)),x("div",Pl,[m[14]||(m[14]=x("span",{style:{"margin-right":"8px",color:"#1890ff","font-weight":"500"}}," 2. ",-1)),x("span",null,[m[12]||(m[12]=v(" æŒ‰ä½ ",-1)),x("strong",null,B(k.value),1),m[13]||(m[13]=v(" ç‚¹å‡»å¤šä¸ªåº§ä½ ",-1))])]),m[18]||(m[18]=x("div",{style:{display:"flex","align-items":"flex-start"}},[x("span",{style:{"margin-right":"8px",color:"#1890ff","font-weight":"500"}}," 3. "),x("span",null,[x("strong",null,"æ‹–æ‹½æ¡†é€‰"),v("æ‰¹é‡é€‰æ‹©")])],-1)),x("div",Ul,[m[16]||(m[16]=x("span",{style:{"margin-right":"8px",color:"#1890ff","font-weight":"500"}}," 4. ",-1)),x("span",null,[x("strong",null,B(k.value)+" + A",1),m[15]||(m[15]=v(" å…¨é€‰ ",-1))])])])])])):(I(),O("div",El,[e(o,{image:void 0,description:"æš‚æ— åº§ä½",style:{padding:"24px 0"}}),m[11]||(m[11]=x("div",{style:{"margin-top":"16px",padding:"12px 16px",background:"#f5f5f5","border-radius":"8px","font-size":"13px",color:"#595959","line-height":"1.6","text-align":"center"}},[v(" ğŸ’¡ åœ¨ç”»å¸ƒé¡¶éƒ¨æ“ä½œæ ç‚¹å‡» "),x("strong",{style:{color:"#1890ff"}},"ã€Œç”Ÿæˆåº§ä½ã€"),v(" æŒ‰é’®ï¼Œå¼€å§‹åˆ›å»ºæœ¬åœºé¦†çš„åº§ä½ã€‚ ")],-1))]))],64)):s.value==="stage"?(I(),V(hl,{key:1,"selected-stage":l.selectedStage,stage:l.stage,onUpdateStage:m[5]||(m[5]=(y,_)=>p("updateStage",y,_)),onDeleteStage:m[6]||(m[6]=y=>p("deleteStage",y)),onAddStage:m[7]||(m[7]=()=>p("addStage"))},null,8,["selected-stage","stage"])):(I(),O(oe,{key:2},[l.venueId&&l.currentFloorId&&l.zones&&l.seats?(I(),V(zl,{key:0,"venue-id":l.venueId,"current-floor-id":l.currentFloorId,zones:l.zones,seats:l.seats,"selected-seat-ids":l.selectedSeats.map(y=>y.id),onUpdateZone:m[8]||(m[8]=(y,_)=>p("updateZone",y,_)),onDeleteZone:m[9]||(m[9]=y=>p("deleteZone",y)),onAssignSeatsToZone:m[10]||(m[10]=y=>p("assignToZone",y))},null,8,["venue-id","current-floor-id","zones","seats","selected-seat-ids"])):(I(),O("div",Al,[e(o,{description:"æš‚æ— åº§åŒº"}),m[20]||(m[20]=x("div",{style:{padding:"12px 16px",background:"rgb(245, 245, 245)","border-radius":"8px","font-size":"13px",color:"rgb(89, 89, 89)","line-height":"1.6","text-align":"center"}}," ğŸ’¡ é€‰æ‹©åº§ä½åï¼Œåœ¨å³ä¾§é¢æ¿æˆ–å³é”®èœå•ä¸­åˆ›å»ºåº§åŒº ",-1))]))],64))])])}}});function Yl(l){const h=l.replace("#",""),u=parseInt(h.substring(0,2),16)/255,p=parseInt(h.substring(2,4),16)/255,s=parseInt(h.substring(4,6),16)/255,d=u<=.03928?u/12.92:Math.pow((u+.055)/1.055,2.4),i=p<=.03928?p/12.92:Math.pow((p+.055)/1.055,2.4),c=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4);return .2126*d+.7152*i+.0722*c}function wt(l,h="#262626",u="#ffffff"){return Yl(l)>.5?h:u}function Bl(l){const h=l.replace("#",""),u=parseInt(h.substring(0,2),16)/255,p=parseInt(h.substring(2,4),16)/255,s=parseInt(h.substring(4,6),16)/255,d=Math.max(u,p,s),i=Math.min(u,p,s),c=d-i,k=(d+i)/2;let g=0;c!==0&&(g=k>.5?c/(2-d-i):c/(d+i));let m=0;return c!==0&&(d===u?m=((p-s)/c+(p<s?6:0))/6:d===p?m=((s-u)/c+2)/6:m=((u-p)/c+4)/6),{h:Math.round(m*360),s:Math.round(g*100),l:Math.round(k*100)}}function Xl(l){const h=l.h/360,u=l.s/100,p=l.l/100;let s,d,i;if(u===0)s=d=i=p;else{const k=(r,o,y)=>(y<0&&(y+=1),y>1&&(y-=1),y<.16666666666666666?r+(o-r)*6*y:y<.5?o:y<.6666666666666666?r+(o-r)*(.6666666666666666-y)*6:r),g=p<.5?p*(1+u):p+u-p*u,m=2*p-g;s=k(m,g,h+1/3),d=k(m,g,h),i=k(m,g,h-1/3)}const c=k=>{const g=Math.round(k*255).toString(16);return g.length===1?`0${g}`:g};return`#${c(s)}${c(d)}${c(i)}`}function Gt(l,h=10){const u=Bl(l);return u.l=Math.max(0,u.l-h),Xl(u)}const Ae={SIZE:30,BORDER_WIDTH:1.5,FONT_SIZE:10,MARGIN:1},Zl={FONT_SIZE:14},Ue={DISPLAY_SIZE:10,COLOR:"#EDEDED",MAJOR_INTERVAL:5,MAJOR_COLOR:"#e8e8e8"},sa="#1890ff",Gl=2;function We(l,h,u){return{x:(l-u.offsetX)/u.scale,y:(h-u.offsetY)/u.scale}}function ql(l,h,u,p=Ae.SIZE){if(l<u.x||l>u.x+p||h<u.y||h>u.y+p)return!1;const s=u.x+p/2,d=u.y+p/2,i=(p-2*Ae.MARGIN)/2,c=l-s,k=h-d;return c*c+k*k<=i*i}function bt(l,h,u){for(let p=u.length-1;p>=0;p--){const s=u[p];if(s&&ql(l,h,s))return s}return null}function jl(l,h,u,p){const s=u.width,d=Math.round(u.height/10)*10,i=u.x-s/2,c=u.x+s/2,k=u.y-d/2,g=u.y+d/2;return l>=i&&l<=c&&h>=k&&h<=g}function ht(l,h,u,p=1200){for(let s=u.length-1;s>=0;s--){const d=u[s];if(d&&jl(l,h,d))return d}return null}function Ne(l,h=Ue.DISPLAY_SIZE){return Math.round(l/h)*h}function Hl(l,h,u,p){const s=We(0,0,h),d=We(u,p,h),i=Ue.DISPLAY_SIZE,c=Math.floor(s.x/i)*i,k=Math.floor(s.y/i)*i,g=Math.ceil(d.x/i)*i,m=Math.ceil(d.y/i)*i;l.strokeStyle=Ue.COLOR,l.lineWidth=1/h.scale;for(let r=c;r<=g;r+=i){const o=r/i%Ue.MAJOR_INTERVAL===0;l.strokeStyle=o?Ue.MAJOR_COLOR:Ue.COLOR,l.beginPath(),l.moveTo(r,k),l.lineTo(r,m),l.stroke()}for(let r=k;r<=m;r+=i){const o=r/i%Ue.MAJOR_INTERVAL===0;l.strokeStyle=o?Ue.MAJOR_COLOR:Ue.COLOR,l.beginPath(),l.moveTo(c,r),l.lineTo(g,r),l.stroke()}}function Kl(l,h){const u=l.replace("#",""),p=parseInt(u.substring(0,2),16),s=parseInt(u.substring(2,4),16),d=parseInt(u.substring(4,6),16);return`rgba(${p}, ${s}, ${d}, ${h})`}function Wl(l){return l.status==="disabled"?"#F5F5F5":l.priceTierColor?l.priceTierColor:l.zoneColor?Kl(l.zoneColor,.9):"#FFFFFF"}function Jl(l){return l.status==="disabled"?"#D9D9D9":l.priceTierColor?Gt(l.priceTierColor,15):l.zoneColor?Gt(l.zoneColor,10):"#D9D9D9"}function Ql(l){return l.status==="disabled"?"#BFBFBF":l.priceTierColor?wt(l.priceTierColor):l.zoneColor?wt(l.zoneColor):"#595959"}function eo(l,h,u=!1,p=!0){const s=Ae.SIZE,d=Ae.MARGIN,i=h.x+s/2,c=h.y+s/2,k=(s-2*d)/2,g=Wl(h),m=Jl(h);if(l.fillStyle=g,l.beginPath(),l.arc(i,c,k,0,Math.PI*2),l.fill(),l.strokeStyle=m,l.lineWidth=Ae.BORDER_WIDTH,l.beginPath(),l.arc(i,c,k,0,Math.PI*2),l.stroke(),u&&(l.strokeStyle=sa,l.lineWidth=Gl,l.beginPath(),l.arc(i,c,k+1,0,Math.PI*2),l.stroke()),h.locked){l.fillStyle="rgba(0, 0, 0, 0.15)",l.beginPath(),l.arc(i,c,k,0,Math.PI*2),l.fill();const r=8;l.strokeStyle="#ffffff",l.fillStyle="#666666",l.lineWidth=1.2,l.fillRect(i-r/2,c,r,r-2),l.beginPath(),l.arc(i,c-1,r/3,Math.PI,0,!0),l.stroke()}if(p&&!h.locked){l.fillStyle=Ql(h),l.font=`${Ae.FONT_SIZE}px sans-serif`,l.textAlign="center",l.textBaseline="middle";const r=`${h.rowLabel}-${h.seatLabel}`;l.fillText(r,i,c)}}function qt(l,h,u,p,s){const k={x:h,y:u},g={x:h+p,y:u},m={x:h+p-40,y:u+s},r={x:h+40,y:u+s};l.beginPath(),l.moveTo(k.x+2,k.y),l.lineTo(g.x-2,g.y),l.arcTo(g.x,g.y,m.x,m.y,2),l.arcTo(m.x,m.y,r.x,r.y,80),l.arcTo(r.x,r.y,k.x,k.y,80),l.arcTo(k.x,k.y,g.x,g.y,2),l.closePath()}function to(l,h,u=1200,p=700,s=!1){const d=h.width,i=h.x-d/2,c=h.y-h.height/2,k=h.height;if(l.fillStyle=h.color||"#dedede",h.shape==="rect")l.beginPath(),l.roundRect?.(i,c,d,k,4),l.closePath(),l.fill();else if(h.shape==="trapezoid")l.save(),l.lineJoin="round",qt(l,i,c,d,k),l.fill(),l.restore();else if(h.shape==="arc"){l.beginPath();const m=4,r=k*.5;l.moveTo(i+m,c),l.lineTo(i+d-m,c),l.arcTo(i+d,c,i+d,c+m,m),l.lineTo(i+d,c+k-r),l.arcTo(i+d,c+k,i+d/2,c+k,r),l.arcTo(i,c+k,i,c+k-r,r),l.lineTo(i,c+m),l.arcTo(i,c,i+m,c,m),l.closePath(),l.fill()}const g=h.color||"#dedede";if(l.fillStyle=wt(g),l.font=`bold ${Zl.FONT_SIZE}px sans-serif`,l.textAlign="center",l.textBaseline="middle",l.fillText(h.name,h.x,h.y),s){if(l.save(),l.strokeStyle=sa,l.lineWidth=4,h.shape==="rect")l.beginPath(),l.roundRect?.(i,c,d,k,4),l.stroke();else if(h.shape==="trapezoid")l.lineJoin="round",l.lineCap="round",l.miterLimit=10,qt(l,i,c,d,k),l.stroke();else if(h.shape==="arc"){const r=k*.5;l.beginPath(),l.moveTo(i+4,c),l.lineTo(i+d-4,c),l.arcTo(i+d,c,i+d,c+4,4),l.lineTo(i+d,c+k-r),l.arcTo(i+d,c+k,i+d/2,c+k,r),l.arcTo(i,c+k,i,c+k-r,r),l.lineTo(i,c+4),l.arcTo(i,c,i+4,c,4),l.closePath(),l.stroke()}l.restore()}}function ao(l){if(l.length===0)return null;let h=1/0,u=1/0,p=-1/0,s=-1/0;return l.forEach(d=>{h=Math.min(h,d.x),u=Math.min(u,d.y),p=Math.max(p,d.x+Ae.SIZE),s=Math.max(s,d.y+Ae.SIZE)}),{minX:h,minY:u,maxX:p,maxY:s,width:p-h,height:s-u}}function no(l,h,u){if(h.length===0)return;const p=ao(h);p&&(l.save(),l.strokeStyle="rgba(24, 144, 255, 0.6)",l.lineWidth=1.5/u,l.setLineDash([4/u,4/u]),l.strokeRect(p.minX,p.minY,p.width,p.height),l.restore())}function lo(l,h,u){const p=new Map;h.forEach(s=>{s.groupId&&(p.has(s.groupId)||p.set(s.groupId,[]),p.get(s.groupId).push(s))}),p.forEach(s=>{s.length>1&&no(l,s,u)})}const jt=3;function oo({canvasRef:l,seats:h,stages:u,viewport:p,canvasWidth:s=1200,selectedSeatIds:d,enableSnap:i=!0,onSeatSelect:c,onSeatMove:k,onSeatsMove:g,onStageSelect:m,onStageMove:r,onViewportChange:o,onSeatsDelete:y,onSeatsCopy:_,onSeatsPaste:b,onContextMenu:f}){const a=Qe({isDragging:!1,dragType:null,dragTargetId:null,startX:0,startY:0,currentX:0,currentY:0}),n=E(null),S=E(null),z=E(null),$=E(new Set),F=L=>{const H=Math.min(L.startX,L.endX),J=Math.max(L.startX,L.endX),ue=Math.min(L.startY,L.endY),pe=Math.max(L.startY,L.endY);return h.value.filter(G=>{const se=G.x+10,ae=G.y+10;return se>=H&&se<=J&&ae>=ue&&ae<=pe}).map(G=>G.id)},D=L=>{if(!l.value)return;const H=l.value.getBoundingClientRect(),J=L.clientX-H.left,ue=L.clientY-H.top,pe=p.value,G=We(J,ue,pe);if(L.button===2&&f){const ee=$.value.has(" "),re=bt(G.x,G.y,h.value),ce=ht(G.x,G.y,u.value,s);!re&&!ce&&!ee||f(G.x,G.y)}const se=$.value.has(" "),ae=bt(G.x,G.y,h.value),he=ht(G.x,G.y,u.value,s),ge=!ae&&!he&&!se;if(!(L.button===2&&ge)){if(ae&&!se){const ee=ae.locked===!0;if(a.isDragging=!0,a.dragType=ee?null:"seat",a.dragTargetId=ae.id,a.startX=G.x,a.startY=G.y,a.currentX=G.x,a.currentY=G.y,c){const re=d.value;if(L.ctrlKey||L.metaKey)if(re.includes(ae.id))c(re.filter(ce=>ce!==ae.id));else{const ce=h.value.find(be=>be.id===ae.id);if(ce?.groupId){const be=h.value.filter(Te=>Te.groupId===ce.groupId).map(Te=>Te.id),xe=[...new Set([...re,...be])];c(xe)}else c([...re,ae.id])}else if(!re.includes(ae.id)){const ce=h.value.find(be=>be.id===ae.id);if(ce?.groupId){const be=h.value.filter(xe=>xe.groupId===ce.groupId).map(xe=>xe.id);c(be)}else c([ae.id])}}return}if(he&&!se){a.isDragging=!0,a.dragType="stage",a.dragTargetId=he.id,a.startX=G.x,a.startY=G.y,a.currentX=G.x,a.currentY=G.y,m&&m(he.id);return}se?(a.isDragging=!0,a.dragType="viewport",a.dragTargetId=null,a.startX=J,a.startY=ue,a.currentX=J,a.currentY=ue):(a.isDragging=!0,a.dragType="selection",a.dragTargetId=null,a.startX=G.x,a.startY=G.y,a.currentX=G.x,a.currentY=G.y,n.value={startX:G.x,startY:G.y,endX:G.x,endY:G.y})}},P=L=>{if(!l.value)return;const H=l.value.getBoundingClientRect(),J=L.clientX-H.left,ue=L.clientY-H.top,pe=p.value,G=We(J,ue,pe);if(a.isDragging)if(a.dragType==="selection")n.value={startX:a.startX,startY:a.startY,endX:G.x,endY:G.y};else if(a.dragType==="viewport"){const se=J-a.currentX,ae=ue-a.currentY;o&&o({...pe,offsetX:pe.offsetX+se,offsetY:pe.offsetY+ae}),a.currentX=J,a.currentY=ue}else(a.dragType==="seat"||a.dragType==="stage")&&(a.currentX=G.x,a.currentY=G.y);else{const se=bt(G.x,G.y,h.value);S.value=se?.id||null;const ae=ht(G.x,G.y,u.value,s);z.value=ae?.id||null}},A=L=>{if(!l.value||!a.isDragging)return;const H=l.value.getBoundingClientRect(),J=L.clientX-H.left,ue=L.clientY-H.top,pe=p.value,G=We(J,ue,pe);if(a.dragType==="selection"&&n.value){const se=F(n.value),ae=new Set;se.forEach(ge=>{const ee=h.value.find(re=>re.id===ge);ee?.groupId?h.value.filter(ce=>ce.groupId===ee.groupId).map(ce=>ce.id).forEach(ce=>ae.add(ce)):ae.add(ge)});const he=Array.from(ae);if(c)if(L.ctrlKey||L.metaKey){const ge=d.value,ee=[...new Set([...ge,...he])];c(ee)}else c(he);n.value=null}if(a.dragType==="seat"&&a.dragTargetId){const se=G.x-a.startX,ae=G.y-a.startY;if(Math.sqrt(se*se+ae*ae)<jt){a.isDragging=!1,a.dragType=null,a.dragTargetId=null,a.startX=0,a.startY=0,a.currentX=0,a.currentY=0;return}const ge=d.value;if(ge.includes(a.dragTargetId)){const ee=ge.map(re=>{const ce=h.value.find(Te=>Te.id===re);if(!ce||ce.locked)return null;let be=ce.x+se,xe=ce.y+ae;return i&&(be=Ne(be),xe=Ne(xe)),{id:re,x:be,y:xe}}).filter(Boolean);ee.length>0&&(g?g(ee):k&&ee.forEach(({id:re,x:ce,y:be})=>{k(re,ce,be)}))}else{const ee=h.value.find(re=>re.id===a.dragTargetId);if(ee&&!ee.locked&&k){let re=ee.x+se,ce=ee.y+ae;i&&(re=Ne(re),ce=Ne(ce)),(re!==ee.x||ce!==ee.y)&&k(a.dragTargetId,re,ce)}}}if(a.dragType==="stage"&&a.dragTargetId&&r){const se=G.x-a.startX,ae=G.y-a.startY;if(Math.sqrt(se*se+ae*ae)>=jt){const ge=u.value.find(ee=>ee.id===a.dragTargetId);if(ge){let ee=ge.x+se,re=ge.y+ae;i&&(ee=Ne(ee),re=Ne(re)),r(a.dragTargetId,ee,re)}}}a.isDragging=!1,a.dragType=null,a.dragTargetId=null,a.startX=0,a.startY=0,a.currentX=0,a.currentY=0},Z=L=>{if(!l.value||!o||(L.preventDefault(),!L.ctrlKey&&!L.metaKey))return;const H=l.value.getBoundingClientRect(),J=L.clientX-H.left,ue=L.clientY-H.top,pe=p.value,G=L.deltaY>0?.9:1.1,se=Math.max(.1,Math.min(5,pe.scale*G)),ae=We(J,ue,pe),he=J-ae.x*se,ge=ue-ae.y*se;o({offsetX:he,offsetY:ge,scale:se})},ne=L=>{$.value=new Set($.value).add(L.key);const H=L.target;H.tagName==="INPUT"||H.tagName==="TEXTAREA"||H.isContentEditable||((L.key==="Delete"||L.key==="Backspace")&&d.value.length>0&&(L.preventDefault(),y&&y(d.value)),(L.ctrlKey||L.metaKey)&&L.key==="a"&&(L.preventDefault(),c&&c(h.value.map(ue=>ue.id))),(L.ctrlKey||L.metaKey)&&L.key==="c"&&d.value.length>0&&(L.preventDefault(),_&&_(d.value)),(L.ctrlKey||L.metaKey)&&L.key==="v"&&(L.preventDefault(),b&&b()),L.key==="Escape"&&c&&c([]))},T=L=>{const H=new Set($.value);H.delete(L.key),$.value=H};return Re(()=>{const L=l.value;L&&(L.addEventListener("mousedown",D),window.addEventListener("mousemove",P),window.addEventListener("mouseup",A),L.addEventListener("wheel",Z,{passive:!1}),window.addEventListener("keydown",ne),window.addEventListener("keyup",T))}),{dragState:a,selectionBox:n,hoveredSeatId:S,hoveredStageId:z,pressedKeys:$}}const so={style:{width:"100%",height:"100%",display:"flex","justify-content":"center","align-items":"center",background:"#fafafa",position:"relative"}},io=["width","height"],ro=de({__name:"TheaterCanvasSimplified",props:{seats:{default:()=>[]},stage:{},selectedSeatIds:{default:()=>[]},selectedElement:{default:null},width:{default:1200},height:{default:700},showGrid:{type:Boolean,default:!0},enableSnap:{type:Boolean,default:!0},showSeatLabels:{type:Boolean,default:!0},viewport:{default:()=>({offsetX:0,offsetY:0,scale:1})}},emits:["seat-select","seat-move","seats-move","stage-select","stage-move","viewport-change","seats-delete","seats-copy","seats-paste","context-menu"],setup(l,{expose:h,emit:u}){const p=l,s=u,d=E(null),i=W(()=>p.seats),c=W(()=>p.stage?[p.stage]:[]),k=W(()=>p.viewport),g=W(()=>p.selectedSeatIds),{dragState:m,selectionBox:r,hoveredSeatId:o,hoveredStageId:y}=oo({canvasRef:d,seats:i,stages:c,viewport:k,canvasWidth:p.width,selectedSeatIds:g,enableSnap:p.enableSnap,onSeatSelect:f=>s("seat-select",f),onSeatMove:(f,a,n)=>s("seat-move",f,a,n),onSeatsMove:f=>s("seats-move",f),onStageSelect:f=>s("stage-select",f),onStageMove:(f,a,n)=>s("stage-move",f,a,n),onViewportChange:f=>s("viewport-change",f),onSeatsDelete:f=>s("seats-delete",f),onSeatsCopy:f=>s("seats-copy",f),onSeatsPaste:()=>s("seats-paste"),onContextMenu:(f,a)=>s("context-menu",f,a)}),_=()=>{const f=d.value;if(!f)return;const a=f.getContext("2d");if(!a)return;const n=p.width,S=p.height;f.width!==n&&(f.width=n),f.height!==S&&(f.height=S),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,n,S);const z=p.viewport;if(a.save(),a.translate(z.offsetX,z.offsetY),a.scale(z.scale,z.scale),p.showGrid&&Hl(a,z,n,S),p.stage){const F=p.stage,D=p.selectedElement?.type==="stage"&&p.selectedElement.id===F.id,P=y.value===F.id;let A=F;if(m.isDragging&&m.dragType==="stage"&&m.dragTargetId===F.id){const Z=m.currentX-m.startX,ne=m.currentY-m.startY;let T=F.x+Z,L=F.y+ne;p.enableSnap&&(T=Ne(T),L=Ne(L)),A={...F,x:T,y:L}}to(a,A,n,S,D||P)}if(i.value.forEach(F=>{const D=p.selectedSeatIds.includes(F.id),P=o.value===F.id;let A=F;if(m.isDragging&&m.dragType==="seat"){const Z=m.dragTargetId===F.id,ne=p.selectedSeatIds.includes(F.id)&&p.selectedSeatIds.includes(m.dragTargetId||"");if((Z||ne)&&!F.locked){const T=m.currentX-m.startX,L=m.currentY-m.startY;let H=F.x+T,J=F.y+L;p.enableSnap&&(H=Ne(H),J=Ne(J)),A={...F,x:H,y:J}}}eo(a,A,D||P,p.showSeatLabels)}),r.value){const F=r.value,D=Math.min(F.startX,F.endX),P=Math.min(F.startY,F.endY),A=Math.abs(F.endX-F.startX),Z=Math.abs(F.endY-F.startY);a.fillStyle="rgba(24, 144, 255, 0.1)",a.fillRect(D,P,A,Z),a.strokeStyle="rgba(24, 144, 255, 0.8)",a.lineWidth=2/z.scale,a.strokeRect(D,P,A,Z)}m.isDragging&&m.dragType==="seat"||lo(a,i.value,z.scale),a.restore()};let b=null;return Re(()=>{const f=()=>{_(),b=window.requestAnimationFrame(f)};_(),b=window.requestAnimationFrame(f)}),Qt(()=>{b!==null&&(window.cancelAnimationFrame(b),b=null)}),h({getCanvas:()=>d.value}),(f,a)=>(I(),O("div",so,[x("canvas",{ref_key:"canvasRef",ref:d,width:l.width,height:l.height,style:{background:"#fafafa"}},null,8,io)]))}}),uo={style:{height:"40px",background:"#fafafa","border-top":"1px solid #f0f0f0",display:"flex","align-items":"center",padding:"0 16px","font-size":"12px",gap:"16px"}},co=de({__name:"BottomStatusBar.full",props:{statistics:{},currentFloorName:{},zoomLevel:{}},emits:["showShortcuts"],setup(l,{emit:h}){const u=h,p=W(()=>typeof navigator<"u"&&navigator.platform.toUpperCase().includes("MAC")),s=W(()=>p.value?"âŒ˜":"Ctrl"),d=()=>{u("showShortcuts")};return(i,c)=>{const k=w("a-typography-text"),g=w("a-tooltip"),m=w("a-divider"),r=w("a-space"),o=w("a-button");return I(),O("div",uo,[e(r,null,{default:t(()=>[e(g,{title:"åº§ä½æ€»æ•°"},{default:t(()=>[e(k,{style:{"font-size":"12px",color:"#262626"}},{default:t(()=>[c[0]||(c[0]=v(" æ€»åº§ä½ï¼š ",-1)),e(k,{strong:"",style:{color:"#1890ff"}},{default:t(()=>[v(B(l.statistics.totalSeats),1)]),_:1})]),_:1})]),_:1}),e(m,{type:"vertical",style:{margin:"0 8px",height:"16px"}}),e(g,{title:"å¯ç”¨åº§ä½æ•°"},{default:t(()=>[e(k,{style:{"font-size":"12px",color:"#262626"}},{default:t(()=>[c[1]||(c[1]=v(" å¯ç”¨ï¼š ",-1)),e(k,{strong:"",style:{color:"#52c41a"}},{default:t(()=>[v(B(l.statistics.availableSeats),1)]),_:1})]),_:1})]),_:1}),e(m,{type:"vertical",style:{margin:"0 8px",height:"16px"}}),e(g,{title:"ç¦ç”¨åº§ä½æ•°"},{default:t(()=>[e(k,{style:{"font-size":"12px",color:"#262626"}},{default:t(()=>[c[2]||(c[2]=v(" ç¦ç”¨ï¼š ",-1)),e(k,{strong:"",style:{color:"#ff4d4f"}},{default:t(()=>[v(B(l.statistics.unavailableSeats),1)]),_:1})]),_:1})]),_:1}),l.statistics.selectedCount>0?(I(),O(oe,{key:0},[e(m,{type:"vertical",style:{margin:"0 8px",height:"16px"}}),e(g,{title:"å½“å‰é€‰ä¸­åº§ä½æ•°"},{default:t(()=>[e(k,{style:{"font-size":"12px",color:"#262626"}},{default:t(()=>[c[3]||(c[3]=v(" é€‰ä¸­ï¼š ",-1)),e(k,{strong:"",style:{color:"#fa8c16"}},{default:t(()=>[v(B(l.statistics.selectedCount),1)]),_:1})]),_:1})]),_:1})],64)):q("",!0)]),_:1}),c[9]||(c[9]=x("div",{style:{flex:"1"}},null,-1)),e(g,{title:"å½“å‰ç¼©æ”¾çº§åˆ«"},{default:t(()=>[e(k,{style:{"font-size":"12px",color:"#8c8c8c"}},{default:t(()=>[c[4]||(c[4]=v(" ç¼©æ”¾ï¼š ",-1)),e(k,{strong:""},{default:t(()=>[v(B(l.zoomLevel??100)+"% ",1)]),_:1})]),_:1})]),_:1}),e(r,{style:{"margin-left":"16px"}},{default:t(()=>[e(g,{title:`æŒ‰ä½ ${s.value} é”®å¹¶æ»šåŠ¨é¼ æ ‡æ»šè½®ç¼©æ”¾ç”»å¸ƒ`},{default:t(()=>[e(k,{style:{"font-size":"12px",color:"#8c8c8c"}},{default:t(()=>[v(B(s.value)+"+æ»šè½®ç¼©æ”¾ ",1)]),_:1})]),_:1},8,["title"]),c[7]||(c[7]=x("span",{style:{color:"#d9d9d9"}},"|",-1)),e(g,{title:"æŒ‰ä½ç©ºæ ¼é”®å¹¶æ‹–åŠ¨ç”»å¸ƒè¿›è¡Œå¹³ç§»"},{default:t(()=>[e(k,{style:{"font-size":"12px",color:"#8c8c8c"}},{default:t(()=>[...c[5]||(c[5]=[v(" ç©ºæ ¼+æ‹–æ‹½ ",-1)])]),_:1})]),_:1}),c[8]||(c[8]=x("span",{style:{color:"#d9d9d9"}},"|",-1)),e(g,{title:"å³é”®ç‚¹å‡»ç”»å¸ƒæ‰“å¼€å¿«æ·èœå•"},{default:t(()=>[e(k,{style:{"font-size":"12px",color:"#8c8c8c"}},{default:t(()=>[...c[6]||(c[6]=[v(" å³é”®èœå• ",-1)])]),_:1})]),_:1})]),_:1}),e(g,{title:"æŸ¥çœ‹å®Œæ•´å¿«æ·é”®åˆ—è¡¨"},{default:t(()=>[e(o,{type:"text",size:"small",onClick:d,style:{"font-size":"16px",color:"#8c8c8c",padding:"4px 8px",height:"auto"}},{default:t(()=>[e(Y(Wt))]),_:1})]),_:1})])}}}),po={style:{"margin-bottom":"16px",padding:"12px",background:"#f0f5ff","border-radius":"8px"}},fo={key:0,style:{"margin-left":"8px"}},mo={style:{"max-height":"60vh","overflow-y":"auto","padding-right":"8px"}},vo={style:{"padding-left":"8px"}},yo={style:{"min-width":"200px"}},go={style:{display:"inline-block",padding:"2px 8px","font-size":"12px","font-family":"SF Mono, Monaco, Consolas, monospace","font-weight":"600",color:"#24292f",background:"#f6f8fa",border:"1px solid #d0d7de","border-radius":"4px","box-shadow":"0 1px 0 rgba(0, 0, 0, 0.04)"}},_o={key:0,style:{margin:"0 4px",color:"#8c8c8c"}},bo={style:{flex:"1","text-align":"right"}},ho={style:{"margin-top":"16px",padding:"12px",background:"#fffbe6","border-radius":"8px",border:"1px solid #ffe58f"}},xo=de({__name:"KeyboardShortcutsModal",props:{visible:{type:Boolean}},emits:["close"],setup(l,{emit:h}){const u=l,p=h,s=()=>{p("close")},d=W(()=>typeof window<"u"&&/Mac|iPhone|iPad|iPod/.test(window.navigator.userAgent)),i=[{category:"ğŸ“‹ åŸºç¡€ç¼–è¾‘",shortcuts:[{keys:["Ctrl","C"],description:"å¤åˆ¶é€‰ä¸­åº§ä½"},{keys:["Ctrl","X"],description:"å‰ªåˆ‡é€‰ä¸­åº§ä½"},{keys:["Ctrl","V"],description:"ç²˜è´´åº§ä½"},{keys:["Ctrl","D"],description:"å¿«é€Ÿå¤åˆ¶ï¼ˆå¤åˆ¶å¹¶åç§»ï¼‰"},{keys:["Delete"],description:"åˆ é™¤é€‰ä¸­åº§ä½ï¼ˆBackspace ä¹Ÿå¯ï¼‰"},{keys:["Ctrl","Z"],description:"æ’¤é”€"},{keys:["Ctrl","Shift","Z"],description:"é‡åš"},{keys:["Ctrl","Y"],description:"é‡åšï¼ˆWindows ä¹ æƒ¯ï¼‰"}]},{category:"ğŸ¯ é€‰ä¸­æ“ä½œ",shortcuts:[{keys:["Ctrl","A"],description:"å…¨é€‰å½“å‰æ¥¼å±‚åº§ä½"},{keys:["Esc"],description:"å–æ¶ˆé€‰ä¸­"},{keys:["Enter"],description:"ç¼–è¾‘é€‰ä¸­åº§ä½ï¼ˆä»…å•é€‰ï¼‰"}]},{category:"ğŸ”§ å¯¹é½å·¥å…·",shortcuts:[{keys:["Alt","A"],description:"å·¦å¯¹é½"},{keys:["Alt","D"],description:"å³å¯¹é½"},{keys:["Alt","H"],description:"æ°´å¹³å±…ä¸­"},{keys:["Alt","W"],description:"é¡¶å¯¹é½"},{keys:["Alt","S"],description:"åº•å¯¹é½"},{keys:["Alt","V"],description:"å‚ç›´å±…ä¸­"}]},{category:"ğŸ” è§†å›¾æ§åˆ¶",shortcuts:[{keys:["Space","+","æ‹–æ‹½"],description:"å¹³ç§»ç”»å¸ƒï¼ˆæ‰‹å‹å·¥å…·ï¼‰"},{keys:["Ctrl","+","æ»šè½®"],description:"ç¼©æ”¾ç”»å¸ƒï¼ˆä»¥é¼ æ ‡ä¸ºä¸­å¿ƒï¼‰"},{keys:["Ctrl","="],description:"æ”¾å¤§è§†å›¾ï¼ˆCtrl + + ä¹Ÿå¯ï¼‰"},{keys:["Ctrl","-"],description:"ç¼©å°è§†å›¾"},{keys:["Ctrl","0"],description:"é‡ç½®ç¼©æ”¾ï¼ˆé€‚é…ç”»å¸ƒï¼‰"}]},{category:"ğŸ”’ é«˜çº§ç¼–è¾‘",shortcuts:[{keys:["Ctrl","G"],description:"æˆç»„ï¼ˆå°†é€‰ä¸­åº§ä½æˆç»„ï¼‰"},{keys:["Ctrl","Shift","G"],description:"å–æ¶ˆæˆç»„"},{keys:["Ctrl","L"],description:"é”å®šé€‰ä¸­åº§ä½"},{keys:["Ctrl","Shift","L"],description:"è§£é”é€‰ä¸­åº§ä½"}]},{category:"âš¡ å¿«é€Ÿæ“ä½œ",shortcuts:[{keys:["Ctrl","R"],description:"æ‰¹é‡é‡æ–°ç¼–å·"},{keys:["Ctrl","E"],description:"å¯¼å‡ºå½“å‰æ¥¼å±‚"},{keys:["Ctrl","Shift","N"],description:"æ–°å»ºæ¥¼å±‚"},{keys:["?"],description:"æ˜¾ç¤ºå¿«æ·é”®è¯´æ˜ï¼ˆæœ¬çª—å£ï¼‰"}]}],c=k=>{if(d.value){if(k==="Ctrl")return"âŒ˜";if(k==="Shift")return"â‡§";if(k==="Alt")return"âŒ¥"}return k};return(k,g)=>{const m=w("QuestionCircleOutlined"),r=w("a-space"),o=w("AppleOutlined"),y=w("WindowsOutlined"),_=w("a-typography-text"),b=w("a-typography-title"),f=w("a-divider"),a=w("a-modal");return I(),V(a,{open:u.visible,footer:null,width:700,centered:"",onCancel:s},{title:t(()=>[e(r,null,{default:t(()=>[e(m,{style:{color:"#1890ff"}}),g[0]||(g[0]=x("span",null,"é”®ç›˜å¿«æ·é”®è¯´æ˜",-1))]),_:1})]),default:t(()=>[x("div",po,[e(r,null,{default:t(()=>[d.value?(I(),V(o,{key:0})):(I(),V(y,{key:1})),e(_,{type:"secondary"},{default:t(()=>[v(" å½“å‰ç³»ç»Ÿ: "+B(d.value?"macOS":"Windows / Linux")+" ",1),d.value?(I(),O("span",fo," ï¼ˆâŒ˜ = Commandï¼Œâ‡§ = Shiftï¼ŒâŒ¥ = Optionï¼‰ ")):q("",!0)]),_:1})]),_:1})]),x("div",mo,[(I(),O(oe,null,Se(i,(n,S)=>x("div",{key:S,style:{"margin-bottom":"24px"}},[e(b,{level:5,style:{"margin-bottom":"12px"}},{default:t(()=>[v(B(n.category),1)]),_:2},1024),x("div",vo,[(I(!0),O(oe,null,Se(n.shortcuts,(z,$)=>(I(),O("div",{key:$,style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"8px 12px","margin-bottom":"4px",background:"#fafafa","border-radius":"4px"}},[x("div",yo,[e(r,{size:"small"},{default:t(()=>[(I(!0),O(oe,null,Se(z.keys,(F,D)=>(I(),O("span",{key:D},[x("kbd",go,B(c(F)),1),Number(D)<z.keys.length-1?(I(),O("span",_o," + ")):q("",!0)]))),128))]),_:2},1024)]),x("div",bo,[e(_,{type:"secondary"},{default:t(()=>[v(B(z.description),1)]),_:2},1024)])]))),128))]),Number(S)<i.length-1?(I(),V(f,{key:0,style:{margin:"16px 0"}})):q("",!0)])),64))]),x("div",ho,[e(r,{direction:"vertical",size:"small"},{default:t(()=>[e(_,{strong:"",style:{color:"#ad8b00"}},{default:t(()=>[...g[1]||(g[1]=[v(" ğŸ’¡ æ¸©é¦¨æç¤º ",-1)])]),_:1}),e(_,{type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[...g[2]||(g[2]=[v(" Â· åœ¨è¾“å…¥æ¡†ä¸­æ“ä½œæ—¶ï¼Œå¤§éƒ¨åˆ†å¿«æ·é”®ä¼šè¢«ç¦ç”¨ï¼ˆé¿å…å†²çªï¼‰ ",-1)])]),_:1}),e(_,{type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[...g[3]||(g[3]=[v(" Â· æˆç»„ã€é”å®šç­‰æ“ä½œéœ€è¦å…ˆé€‰ä¸­åº§ä½æ‰èƒ½ä½¿ç”¨ ",-1)])]),_:1}),e(_,{type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[...g[4]||(g[4]=[v(" Â· å¯¹é½å·¥å…·è‡³å°‘éœ€è¦é€‰ä¸­ 2 ä¸ªåº§ä½ ",-1)])]),_:1})]),_:1})])]),_:1},8,["open"])}}}),ko={class:"seat-map-editor-panel-content",style:{"padding-right":"16px","box-sizing":"border-box","overflow-x":"hidden","word-break":"break-word"}},wo={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"12px"}},So=["onClick"],Co={style:{"margin-bottom":"8px"}},Io={style:{display:"grid","grid-template-columns":"1fr 1fr",gap:"8px"}},To=de({__name:"LeftPanel",props:{floors:{},activeFloorId:{},seats:{},zones:{}},emits:["floorChange","newFloor","manageFloors"],setup(l,{emit:h}){const u=h,p=s=>{u("floorChange",s)};return(s,d)=>{const i=w("a-typography-title"),c=w("a-button"),k=w("a-tooltip"),g=w("a-space"),m=w("a-typography-text"),r=w("a-statistic"),o=w("a-card");return I(),O("div",ko,[x("div",null,[x("div",wo,[e(i,{level:5,style:{margin:"0"}},{default:t(()=>[...d[2]||(d[2]=[v(" æ¥¼å±‚ ",-1)])]),_:1}),e(g,{size:"small"},{default:t(()=>[e(k,{title:"æ–°å»ºæ¥¼å±‚ (Ctrl+Shift+N)"},{default:t(()=>[e(c,{type:"text",size:"small",onClick:d[0]||(d[0]=y=>u("newFloor"))},{default:t(()=>[e(Y(Ct))]),_:1})]),_:1}),e(k,{title:"ç®¡ç†æ¥¼å±‚"},{default:t(()=>[e(c,{type:"text",size:"small",onClick:d[1]||(d[1]=y=>u("manageFloors"))},{default:t(()=>[e(Y(ea))]),_:1})]),_:1})]),_:1})]),e(g,{direction:"vertical",style:{width:"100%"},size:4},{default:t(()=>[(I(!0),O(oe,null,Se(l.floors,y=>(I(),O("div",{key:y.id,onClick:_=>p(y.id),style:Ie({padding:"8px 12px",borderRadius:"6px",cursor:"pointer",background:y.id===l.activeFloorId?"#e6f7ff":"transparent",border:y.id===l.activeFloorId?"1px solid #91d5ff":"1px solid transparent",transition:"all 0.2s",display:"flex",justifyContent:"space-between",alignItems:"center"})},[e(m,{strong:y.id===l.activeFloorId,style:Ie({color:y.id===l.activeFloorId?"#1890ff":"#262626"})},{default:t(()=>[v(B(y.name),1)]),_:2},1032,["strong","style"]),e(m,{type:"secondary",style:Ie([{"font-size":"12px"},{color:y.id===l.activeFloorId?"#1890ff":"#8c8c8c"}])},{default:t(()=>[v(B(l.seats.filter(_=>_.floorId===y.id).length),1)]),_:2},1032,["style"])],12,So))),128))]),_:1}),l.floors.length===0?(I(),V(m,{key:0,type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[...d[3]||(d[3]=[v(" æš‚æ— æ¥¼å±‚ï¼Œè¯·æ–°å»º ",-1)])]),_:1})):q("",!0)]),l.floors.find(y=>y.id===l.activeFloorId)?(I(),V(o,{key:0,size:"small",style:{"margin-top":"16px",background:"#fafafa",border:"1px solid #f0f0f0"}},{default:t(()=>[x("div",Co,[e(m,{strong:"",style:{"font-size":"13px"}},{default:t(()=>[...d[4]||(d[4]=[v(" å½“å‰æ¥¼å±‚ ",-1)])]),_:1})]),e(g,{direction:"vertical",style:{width:"100%"},size:8},{default:t(()=>[x("div",null,[e(m,{type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[...d[5]||(d[5]=[v(" åç§°: ",-1)])]),_:1}),e(m,{strong:"",style:{"font-size":"12px"}},{default:t(()=>[v(B(l.floors.find(y=>y.id===l.activeFloorId)?.name),1)]),_:1})]),x("div",Io,[e(r,{title:"åº§ä½",value:l.seats.filter(y=>y.floorId===l.activeFloorId).length,"value-style":{fontSize:"20px",color:"#1890ff"}},null,8,["value"]),l.zones?(I(),V(r,{key:0,title:"åº§åŒº",value:l.zones.filter(y=>y.floorId===l.activeFloorId).length,"value-style":{fontSize:"20px",color:"#52c41a"}},null,8,["value"])):q("",!0)])]),_:1})]),_:1})):q("",!0)])}}}),$o={style:{"margin-bottom":"16px"}},Ro={style:{"max-height":"400px","overflow-y":"auto"}},zo={class:"floor-item-handle"},Do={key:1,style:{padding:"40px","text-align":"center",color:"#8c8c8c"}},Mo=de({__name:"FloorManagerModal",props:{visible:{type:Boolean},floors:{}},emits:["ok","cancel"],setup(l,{emit:h}){const u=l,p=h,s=E([]),d=E(null),i=E(""),c=()=>{s.value=(u.floors||[]).map(a=>({...a}))};_e(()=>u.floors,()=>{u.visible&&c()},{deep:!0}),_e(()=>u.visible,a=>{a&&c()},{immediate:!0});const k=a=>`${a}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,g=()=>{const a=s.value.length>0?Math.max(...s.value.map(S=>S.level||0)):0,n={id:k("floor"),name:`${a+1}F`,level:a+1};s.value=[...s.value,n],N.success(`å·²æ·»åŠ æ¥¼å±‚ ${n.name}`)},m=a=>{const n=s.value.find(S=>S.id===a);if(n){if(s.value.length<=1){N.warning("è‡³å°‘éœ€è¦ä¿ç•™ 1 ä¸ªæ¥¼å±‚");return}nt.confirm({title:"ç¡®è®¤åˆ é™¤æ¥¼å±‚",content:`åˆ é™¤æ¥¼å±‚ã€Œ${n.name}ã€å¯èƒ½ä¼šå½±å“è¯¥æ¥¼å±‚å…³è”çš„åº§ä½ã€åº§åŒºç­‰æ•°æ®ï¼Œå»ºè®®å…ˆæ¸…ç©ºè¯¥æ¥¼å±‚å†…çš„æ•°æ®ã€‚`,okText:"ç¡®è®¤åˆ é™¤",okType:"danger",cancelText:"å–æ¶ˆ",centered:!0,onOk:()=>{s.value=s.value.filter(S=>S.id!==a),N.success(`å·²åˆ é™¤æ¥¼å±‚ ${n.name}`)}})}},r=(a,n)=>{d.value=a,i.value=n},o=(a,n)=>{const S=n.trim();if(!S){N.warning("æ¥¼å±‚åç§°ä¸èƒ½ä¸ºç©º");return}if(s.value.some($=>$.id!==a&&$.name===S)){N.warning("æ¥¼å±‚åç§°ä¸èƒ½é‡å¤");return}s.value=s.value.map($=>$.id===a?{...$,name:S}:$),d.value=null,i.value="",N.success("æ¥¼å±‚åç§°å·²æ›´æ–°")},y=()=>{d.value=null,i.value=""},_=()=>{s.value=s.value.map((a,n)=>({...a,level:n+1}))},b=()=>{p("ok",s.value.map(a=>({...a})))},f=()=>{c(),d.value=null,i.value="",p("cancel")};return(a,n)=>{const S=w("a-button"),z=w("a-space"),$=w("a-input"),F=w("a-typography-text"),D=w("a-tooltip"),P=w("a-modal");return I(),V(P,{title:"æ¥¼å±‚ç®¡ç†",open:u.visible,width:"600",centered:"","ok-text":"ä¿å­˜","cancel-text":"å–æ¶ˆ","destroy-on-close":"",onOk:b,onCancel:f},{default:t(()=>[x("div",$o,[e(S,{type:"primary",block:"",onClick:g},{icon:t(()=>[e(Y(Ct))]),default:t(()=>[n[2]||(n[2]=v(" æ·»åŠ æ¥¼å±‚ ",-1))]),_:1})]),n[3]||(n[3]=x("div",{style:{"margin-bottom":"8px",padding:"8px 12px",background:"#f5f5f5","border-radius":"4px","font-size":"12px",color:"#595959"}}," ğŸ’¡ æç¤ºï¼šæ‹–åŠ¨æ¥¼å±‚æ¡ç›®å¯ä»¥è°ƒæ•´é¡ºåºï¼ŒåŒå‡»åç§°æˆ–ç‚¹å‡»ç¼–è¾‘å›¾æ ‡å¯ä»¥é‡å‘½åæ¥¼å±‚ã€‚ ",-1)),x("div",Ro,[s.value.length?(I(),V(Y(Ya),{key:0,modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=A=>s.value=A),"item-key":"id",handle:".floor-item-handle",onUpdate:_},{item:t(({element:A})=>[(I(),O("div",{key:A.id,style:{padding:"12px 16px",background:"#fff",border:"1px solid #d9d9d9","border-radius":"4px","margin-bottom":"8px",display:"flex","align-items":"center",gap:"12px",cursor:"move"}},[x("span",zo,[e(Y(Ba),{style:{"font-size":"16px",color:"#8c8c8c"}})]),d.value===A.id?(I(),V($,{key:0,value:i.value,"onUpdate:value":n[0]||(n[0]=Z=>i.value=Z),style:{flex:"1"},onPressEnter:Z=>o(A.id,i.value)},{suffix:t(()=>[e(z,{size:4},{default:t(()=>[e(S,{type:"text",size:"small",style:{color:"#52c41a"},onClick:Ke(Z=>o(A.id,i.value),["stop"])},{icon:t(()=>[e(Y(Xa))]),_:1},8,["onClick"]),e(S,{type:"text",size:"small",style:{color:"#ff4d4f"},onClick:Ke(y,["stop"])},{icon:t(()=>[e(Y(Za))]),_:1})]),_:2},1024)]),_:2},1032,["value","onPressEnter"])):(I(),O(oe,{key:1},[e(F,{style:{flex:"1","font-size":"14px"},onDblclick:Z=>r(A.id,A.name)},{default:t(()=>[v(B(A.name),1)]),_:2},1032,["onDblclick"]),e(z,{size:4},{default:t(()=>[e(D,{title:"é‡å‘½åæ¥¼å±‚"},{default:t(()=>[e(S,{type:"text",size:"small",onClick:Ke(Z=>r(A.id,A.name),["stop"])},{default:t(()=>[e(Y(ct))]),_:1},8,["onClick"])]),_:2},1024),e(D,{title:"åˆ é™¤æ¥¼å±‚"},{default:t(()=>[e(S,{type:"text",size:"small",danger:"",onClick:Ke(Z=>m(A.id),["stop"])},{default:t(()=>[e(Y(Je))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)],64))]))]),_:1},8,["modelValue"])):(I(),O("div",Do," æš‚æ— æ¥¼å±‚ï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ  "))])]),_:1},8,["open"])}}}),Fo=de({__name:"RenumberModal",props:{visible:{type:Boolean},seats:{}},emits:["ok","cancel"],setup(l,{emit:h}){const u=l,p=h,s=E(),d={direction:"horizontal",startRowNumber:1,startSeatNumber:1,rowIncrement:1,seatIncrement:1},i=async()=>{const k=s.value;if(k)try{const g=await k.validateFields();p("ok",g),k.resetFields()}catch(g){console.error("é‡æ–°ç¼–å·è¡¨å•æ ¡éªŒå¤±è´¥:",g)}},c=()=>{const k=s.value;k&&k.resetFields(),p("cancel")};return(k,g)=>{const m=w("a-alert"),r=w("a-radio"),o=w("a-space"),y=w("a-radio-group"),_=w("a-form-item"),b=w("a-input-number"),f=w("a-form"),a=w("a-modal");return I(),V(a,{title:"æ‰¹é‡é‡æ–°ç¼–å·",open:u.visible,width:"500",centered:"",onOk:i,onCancel:c},{default:t(()=>[e(m,{message:`å°†ä¸ºé€‰ä¸­çš„ ${u.seats.length} ä¸ªåº§ä½é‡æ–°ç¼–å·`,type:"info","show-icon":"",style:{"margin-bottom":"16px"}},null,8,["message"]),e(f,{ref_key:"formRef",ref:s,layout:"vertical","initial-values":d},{default:t(()=>[e(_,{name:"direction",label:"ç¼–å·æ–¹å‘",extra:"é€‰æ‹©åº§ä½ç¼–å·çš„ä¸»è¦æ–¹å‘"},{default:t(()=>[e(y,null,{default:t(()=>[e(o,{direction:"vertical"},{default:t(()=>[e(r,{value:"horizontal"},{default:t(()=>[...g[0]||(g[0]=[v(" æ°´å¹³ä¼˜å…ˆï¼ˆä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼‰ ",-1)])]),_:1}),e(r,{value:"vertical"},{default:t(()=>[...g[1]||(g[1]=[v(" å‚ç›´ä¼˜å…ˆï¼ˆä»ä¸Šåˆ°ä¸‹ï¼Œä»å·¦åˆ°å³ï¼‰ ",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{name:"startRowNumber",label:"èµ·å§‹æ’å·",rules:[{required:!0,message:"è¯·è¾“å…¥èµ·å§‹æ’å·"}]},{default:t(()=>[e(b,{min:1,max:999,style:{width:"100%"},placeholder:"è¯·è¾“å…¥èµ·å§‹æ’å·"})]),_:1}),e(_,{name:"startSeatNumber",label:"èµ·å§‹åº§å·",rules:[{required:!0,message:"è¯·è¾“å…¥èµ·å§‹åº§å·"}]},{default:t(()=>[e(b,{min:1,max:999,style:{width:"100%"},placeholder:"è¯·è¾“å…¥èµ·å§‹åº§å·"})]),_:1}),e(_,{name:"rowIncrement",label:"æ’å·é€’å¢",extra:"æ¯ä¸€æ’çš„æ’å·é€’å¢å€¼",rules:[{required:!0,message:"è¯·è¾“å…¥æ’å·é€’å¢å€¼"}]},{default:t(()=>[e(b,{min:1,max:10,style:{width:"100%"},placeholder:"è¯·è¾“å…¥æ’å·é€’å¢å€¼"})]),_:1}),e(_,{name:"seatIncrement",label:"åº§å·é€’å¢",extra:"æ¯ä¸€åˆ—çš„åº§å·é€’å¢å€¼",rules:[{required:!0,message:"è¯·è¾“å…¥åº§å·é€’å¢å€¼"}]},{default:t(()=>[e(b,{min:1,max:10,style:{width:"100%"},placeholder:"è¯·è¾“å…¥åº§å·é€’å¢å€¼"})]),_:1})]),_:1},512)]),_:1},8,["open"])}}}),Eo=de({__name:"SingleSeatModal",props:{visible:{type:Boolean},seat:{},zones:{},existingSeats:{},defaultZoneId:{},defaultPosition:{}},emits:["ok","cancel"],setup(l,{emit:h}){const u=l,p=h,s=E(),d=E(!1),i=()=>({zoneId:u.defaultZoneId||u.zones[0]?.id,rowNumber:1,seatNumber:1,x:u.defaultPosition?.x??0,y:u.defaultPosition?.y??0,status:"available",disabledReason:void 0}),c=E(i()),k=[{label:"è®¾å¤‡å ç”¨",value:"equipment"},{label:"ç»´æŠ¤ä¸­",value:"maintenance"},{label:"å…¶ä»–",value:"other"}],g=()=>{const y=s.value;if(u.seat){const _=u.seat;c.value={zoneId:_.zoneId,rowNumber:Number(_.rowLabel)||1,seatNumber:Number(_.seatLabel)||1,x:_.x,y:_.y,status:_.status,disabledReason:_.disabledReason}}else c.value=i();d.value=c.value.status==="disabled",y?.clearValidate&&y.clearValidate()};_e(()=>({visible:u.visible,seat:u.seat,defaultZoneId:u.defaultZoneId,defaultPosition:u.defaultPosition,zones:u.zones}),({visible:y})=>{const _=s.value;if(!y){_?.resetFields&&_.resetFields(),c.value=i(),d.value=!1;return}g()},{immediate:!0}),_e(()=>c.value.status,y=>{d.value=y==="disabled",y!=="disabled"&&(c.value.disabledReason=void 0)});const m=y=>{c.value.status=y,d.value=y==="disabled"},r=async()=>{const y=s.value;if(y)try{await y.validateFields();const _=c.value,b=String(_.rowNumber??""),f=String(_.seatNumber??"");if((u.existingSeats||[]).some(n=>_.zoneId?n.zoneId===_.zoneId&&n.rowLabel===b&&n.seatLabel===f&&n.id!==u.seat?.id:!1)){y.setFields([{name:"rowNumber",errors:["è¯¥åº§åŒºå†…å·²å­˜åœ¨ç›¸åŒæ’å·å’Œåº§ä½å·çš„åº§ä½"]},{name:"seatNumber",errors:[""]}]);return}p("ok",{zoneId:_.zoneId,rowLabel:b,seatLabel:f,x:Number(_.x??0),y:Number(_.y??0),status:_.status||"available",disabledReason:_.disabledReason}),y?.resetFields&&y.resetFields(),c.value=i(),d.value=!1}catch(_){console.error("å•ä¸ªåº§ä½è¡¨å•æ ¡éªŒå¤±è´¥:",_)}},o=()=>{const y=s.value;y?.resetFields&&y.resetFields(),c.value=i(),d.value=!1,p("cancel")};return(y,_)=>{const b=w("a-input-number"),f=w("a-form-item"),a=w("a-col"),n=w("a-row"),S=w("a-radio"),z=w("a-radio-group"),$=w("a-select"),F=w("a-form"),D=w("a-modal");return I(),V(D,{title:l.seat?"ç¼–è¾‘åº§ä½":"æ·»åŠ åº§ä½",open:l.visible,width:"500",centered:"","destroy-on-close":"",onOk:r,onCancel:o},{default:t(()=>[e(F,{ref_key:"formRef",ref:s,layout:"vertical",model:c.value,style:{"margin-top":"16px"}},{default:t(()=>[e(n,{gutter:16},{default:t(()=>[e(a,{span:12},{default:t(()=>[e(f,{label:"æ’å·",name:"rowNumber",rules:[{required:!0,message:"è¯·è¾“å…¥æ’å·"},{type:"number",min:1,message:"æ’å·å¿…é¡»å¤§äº 0"}]},{default:t(()=>[e(b,{value:c.value.rowNumber,"onUpdate:value":_[0]||(_[0]=P=>c.value.rowNumber=P),min:1,precision:0,placeholder:"1",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(a,{span:12},{default:t(()=>[e(f,{label:"åº§ä½å·",name:"seatNumber",rules:[{required:!0,message:"è¯·è¾“å…¥åº§ä½å·"},{type:"number",min:1,message:"åº§ä½å·å¿…é¡»å¤§äº 0"}]},{default:t(()=>[e(b,{value:c.value.seatNumber,"onUpdate:value":_[1]||(_[1]=P=>c.value.seatNumber=P),min:1,precision:0,placeholder:"1",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(n,{gutter:16},{default:t(()=>[e(a,{span:12},{default:t(()=>[e(f,{label:"X åæ ‡",name:"x",rules:[{required:!0,message:"è¯·è¾“å…¥ X åæ ‡"}]},{default:t(()=>[e(b,{value:c.value.x,"onUpdate:value":_[2]||(_[2]=P=>c.value.x=P),precision:0,placeholder:"0",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(a,{span:12},{default:t(()=>[e(f,{label:"Y åæ ‡",name:"y",rules:[{required:!0,message:"è¯·è¾“å…¥ Y åæ ‡"}]},{default:t(()=>[e(b,{value:c.value.y,"onUpdate:value":_[3]||(_[3]=P=>c.value.y=P),precision:0,placeholder:"0",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(f,{label:"åº§ä½çŠ¶æ€",name:"status",rules:[{required:!0,message:"è¯·é€‰æ‹©åº§ä½çŠ¶æ€"}]},{default:t(()=>[e(z,{value:c.value.status,"onUpdate:value":_[4]||(_[4]=P=>c.value.status=P),onChange:_[5]||(_[5]=P=>m(P.target.value))},{default:t(()=>[e(S,{value:"available"},{default:t(()=>[..._[8]||(_[8]=[v(" å¯ç”¨ ",-1)])]),_:1}),e(S,{value:"disabled"},{default:t(()=>[..._[9]||(_[9]=[v(" ç¦ç”¨ ",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),d.value?(I(),V(f,{key:0,label:"ç¦ç”¨åŸå› ",name:"disabledReason",rules:[{required:!0,message:"è¯·é€‰æ‹©ç¦ç”¨åŸå› "}]},{default:t(()=>[e(z,{value:c.value.disabledReason,"onUpdate:value":_[6]||(_[6]=P=>c.value.disabledReason=P)},{default:t(()=>[(I(),O(oe,null,Se(k,P=>e(S,{key:P.value,value:P.value},{default:t(()=>[v(B(P.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1})):q("",!0),e(f,{label:"æ‰€å±åº§åŒº",name:"zoneId"},{default:t(()=>[e($,{value:c.value.zoneId,"onUpdate:value":_[7]||(_[7]=P=>c.value.zoneId=P),options:l.zones.map(P=>({label:P.name,value:P.id})),placeholder:"é€‰æ‹©åº§åŒºï¼ˆå¯é€‰ï¼‰","allow-clear":""},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","open"])}}}),Lo={style:{display:"flex","flex-direction":"column",gap:"16px"}},No={style:{display:"grid","grid-template-columns":"1fr 1fr",gap:"16px"}},Oo={style:{display:"flex","align-items":"center",gap:"12px"}},Po={style:{display:"flex","align-items":"center",gap:"12px"}},Uo={class:"ant-upload-drag-icon"},Ao={class:"ant-upload-hint"},Vo={key:1,style:{border:"1px dashed var(--color-n4)","border-radius":"8px",padding:"40px","text-align":"center","background-color":"var(--color-n1)"}},Ht=40,Yo=de({__name:"ImportDataModal",props:{visible:{type:Boolean}},emits:["close","import"],setup(l,{emit:h}){const u=l,p=h,s=f=>Math.round(f/Ht)*Ht,d=[{æ¥¼å±‚:"1å±‚",åº§åŒº:"VIPåŒº",æ’å·:"1",åº§å·:"1",çŠ¶æ€:"å¯ç”¨",æ ‡ç­¾:"VIP",Xåæ ‡:"100",Yåæ ‡:"100"},{æ¥¼å±‚:"1å±‚",åº§åŒº:"VIPåŒº",æ’å·:"1",åº§å·:"2",çŠ¶æ€:"å¯ç”¨",æ ‡ç­¾:"VIP",Xåæ ‡:"140",Yåæ ‡:"100"},{æ¥¼å±‚:"1å±‚",åº§åŒº:"æ™®é€šåŒº",æ’å·:"2",åº§å·:"1",çŠ¶æ€:"å¯ç”¨",æ ‡ç­¾:"-",Xåæ ‡:"100",Yåæ ‡:"150"},{æ¥¼å±‚:"1å±‚",åº§åŒº:"æ™®é€šåŒº",æ’å·:"2",åº§å·:"2",çŠ¶æ€:"ç¦ç”¨",æ ‡ç­¾:"-",Xåæ ‡:"140",Yåæ ‡:"150"},{æ¥¼å±‚:"1å±‚",åº§åŒº:"æ™®é€šåŒº",æ’å·:"2",åº§å·:"3",çŠ¶æ€:"å¯ç”¨",æ ‡ç­¾:"æ— éšœç¢",Xåæ ‡:"180",Yåæ ‡:"150"}],i={id:"theater-template",name:"ç¤ºä¾‹å‰§åœº",floors:[{id:"floor-1",name:"1å±‚",level:1}],zones:[{id:"zone-1",venueId:"template-venue",floorId:"floor-1",name:"VIPåŒº",shortName:"VIP",color:"#ff4d4f",order:1},{id:"zone-2",venueId:"template-venue",floorId:"floor-1",name:"æ™®é€šåŒº",shortName:"æ™®",color:"#1890ff",order:2}],seats:[{id:"seat-1",floorId:"floor-1",zoneId:"zone-1",zoneName:"VIPåŒº",zoneColor:"#ff4d4f",rowLabel:"1",seatLabel:"1",status:"available",label:"vip",x:100,y:100},{id:"seat-2",floorId:"floor-1",zoneId:"zone-1",zoneName:"VIPåŒº",zoneColor:"#ff4d4f",rowLabel:"1",seatLabel:"2",status:"available",label:"vip",x:140,y:100},{id:"seat-3",floorId:"floor-1",zoneId:"zone-2",zoneName:"æ™®é€šåŒº",zoneColor:"#1890ff",rowLabel:"2",seatLabel:"1",status:"available",x:100,y:150},{id:"seat-4",floorId:"floor-1",zoneId:"zone-2",zoneName:"æ™®é€šåŒº",zoneColor:"#1890ff",rowLabel:"2",seatLabel:"2",status:"disabled",disabledReason:"equipment",x:140,y:150},{id:"seat-5",floorId:"floor-1",zoneId:"zone-2",zoneName:"æ™®é€šåŒº",zoneColor:"#1890ff",rowLabel:"2",seatLabel:"3",status:"available",label:"accessible",x:180,y:150}],stage:{id:"stage-1",x:0,y:0,name:"èˆå°",shape:"rect",width:320,height:60,position:"top-center",color:"#faad14"}},c=E("excel"),k=E([]),g=E(!1),m=()=>{try{const f=je.json_to_sheet(d);f["!cols"]=[{wch:10},{wch:15},{wch:8},{wch:8},{wch:12},{wch:12},{wch:10},{wch:10}];const a=je.book_new();je.book_append_sheet(a,f,"åº§ä½æ•°æ®");const n=[["åº§ä½å›¾å¯¼å…¥æ¨¡æ¿ä½¿ç”¨è¯´æ˜"],[""],["å­—æ®µè¯´æ˜ï¼š"],["1. æ¥¼å±‚ï¼šæ¥¼å±‚åç§°ï¼Œä¾‹å¦‚ã€Œ1å±‚ã€ã€Œ2å±‚ã€"],["2. åº§åŒºï¼šåº§ä½åŒºåŸŸåç§°ï¼Œä¾‹å¦‚ã€ŒVIPåŒºã€ã€Œæ™®é€šåŒºã€"],["3. æ’å·ï¼šåº§ä½æ‰€åœ¨æ’ï¼Œä¾‹å¦‚ã€Œ1ã€ã€Œ2ã€ã€ŒAã€"],["4. åº§å·ï¼šåº§ä½åºå·ï¼Œä¾‹å¦‚ã€Œ1ã€ã€Œ2ã€"],["5. çŠ¶æ€ï¼šå¯ç”¨ / ç¦ç”¨"],["6. æ ‡ç­¾ï¼šç”¨äºæ ‡è®°ç‰¹æ®Šåº§ä½ï¼Œä¾‹å¦‚ã€Œæ— éšœç¢ã€ã€ŒVIPã€ï¼Œæ— åˆ™å¡«ã€Œ-ã€"],["7. Xåæ ‡ï¼šåº§ä½åœ¨ç”»å¸ƒä¸Šçš„ X åæ ‡ï¼ˆåƒç´ ï¼Œå»ºè®®ä¸º 10 çš„å€æ•°ï¼‰"],["8. Yåæ ‡ï¼šåº§ä½åœ¨ç”»å¸ƒä¸Šçš„ Y åæ ‡ï¼ˆåƒç´ ï¼Œå»ºè®®ä¸º 10 çš„å€æ•°ï¼‰"],[""],["ä½¿ç”¨å»ºè®®ï¼š"],["- å»ºè®®å…ˆå¯¼å‡ºç¤ºä¾‹æ•°æ®ï¼Œå†åœ¨æ­¤åŸºç¡€ä¸Šä¿®æ”¹ï¼Œé¿å…æ ¼å¼é”™è¯¯"],["- å¯¼å…¥æ—¶ä¼šè¦†ç›–å½“å‰æ‰€æœ‰åº§ä½æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œ"]],S=je.aoa_to_sheet(n);je.book_append_sheet(a,S,"ä½¿ç”¨è¯´æ˜"),ja(a,"åº§ä½å›¾å¯¼å…¥æ¨¡æ¿.xlsx")}catch(f){console.error("ç”Ÿæˆ Excel æ¨¡æ¿å¤±è´¥:",f),N.error("ç”Ÿæˆ Excel æ¨¡æ¿å¤±è´¥")}},r=()=>{try{const f=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),a=URL.createObjectURL(f),n=document.createElement("a");n.href=a,n.download="åº§ä½å›¾å¯¼å…¥æ¨¡æ¿.json",n.click(),URL.revokeObjectURL(a)}catch(f){console.error("ç”Ÿæˆ JSON æ¨¡æ¿å¤±è´¥:",f),N.error("ç”Ÿæˆ JSON æ¨¡æ¿å¤±è´¥")}},o=async f=>{const a=await f.arrayBuffer(),n=Ha(a,{type:"array"}),S=n.SheetNames[0];if(!S)throw new Error("Excel æ–‡ä»¶ä¸­æ²¡æœ‰å¯ç”¨çš„å·¥ä½œè¡¨");const z=n.Sheets[S];if(!z)throw new Error("æ— æ³•è¯»å– Excel å·¥ä½œè¡¨");const $=je.sheet_to_json(z),F=new Map,D=new Map,P=[];let A=1,Z=1;$.forEach(H=>{const J=String(H.æ¥¼å±‚||"").trim()||"é»˜è®¤æ¥¼å±‚",ue=String(H.åº§åŒº||"").trim()||"é»˜è®¤åº§åŒº",pe=String(H.æ’å·||"").trim()||"1",G=String(H.åº§å·||"").trim()||"1",se=String(H.çŠ¶æ€||"").trim(),ae=String(H.æ ‡ç­¾||"").trim(),he=s(Number(H.Xåæ ‡||0)),ge=s(Number(H.Yåæ ‡||0));if(!F.has(J)){const Te=`floor-${A++}`;F.set(J,{id:Te,name:J,level:F.size+1})}const ee=F.get(J),re=`${ee.id}-${ue}`;if(!D.has(re)){const Te=`zone-${Z++}`,Ze=ue.includes("VIP")?"#ff4d4f":"#1890ff";D.set(re,{id:Te,name:ue,color:Ze,floorId:ee.id,order:D.size+1})}const ce=D.get(re),be=se==="ç¦ç”¨"?"disabled":"available";let xe;ae==="VIP"?xe="vip":ae==="æ— éšœç¢"?xe="accessible":xe=void 0,P.push({id:`seat-${P.length+1}`,floorId:ee.id,zoneId:ce.id,zoneName:ce.name,zoneColor:ce.color,rowLabel:pe,seatLabel:G,status:be,label:xe,x:he,y:ge})});const ne=Array.from(F.values()),T=Array.from(D.values()).map(H=>({id:H.id,venueId:"imported-venue",floorId:H.floorId,name:H.name,shortName:void 0,color:H.color,order:H.order})),L={id:"stage-1",x:0,y:0,name:"èˆå°",shape:"rect",width:320,height:60,position:"top-center",color:"#faad14"};return{id:`theater-${Date.now()}`,name:"å¯¼å…¥å‰§åœº",floors:ne,seats:P,zones:T,stage:L,metadata:{createdAt:new Date().toISOString()}}},y=f=>{const a=f.name.endsWith(".xlsx")||f.name.endsWith(".xls"),n=f.name.endsWith(".json");return c.value==="excel"&&!a?(N.error("è¯·é€‰æ‹© Excel æ–‡ä»¶ï¼ˆ.xlsx æˆ– .xlsï¼‰"),!1):c.value==="json"&&!n?(N.error("è¯·é€‰æ‹© JSON æ–‡ä»¶ï¼ˆ.jsonï¼‰"),!1):(k.value=[f],!1)},_=async()=>{if(k.value.length===0){N.warning("è¯·å…ˆé€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶");return}const f=k.value[0].originFileObj;if(!f){N.error("æ— æ³•è¯»å–è¦å¯¼å…¥çš„æ–‡ä»¶");return}try{g.value=!0;let a;if(c.value==="excel")a=await o(f);else{const n=await f.text();a=JSON.parse(n)}p("import",a),N.success("åº§ä½å›¾å¯¼å…¥æˆåŠŸ"),b()}catch(a){console.error("å¯¼å…¥åº§ä½å›¾å¤±è´¥:",a),N.error(a?.message||"å¯¼å…¥åº§ä½å›¾å¤±è´¥")}finally{g.value=!1}},b=()=>{k.value=[],g.value=!1,p("close")};return(f,a)=>{const n=w("a-alert"),S=w("a-typography-title"),z=w("a-typography-text"),$=w("a-button"),F=w("a-space"),D=w("a-divider"),P=w("a-upload-dragger"),A=w("a-modal");return I(),V(A,{open:u.visible,title:"å¯¼å…¥åº§ä½å›¾",width:720,footer:null,onCancel:b},{footer:t(()=>[e($,{onClick:b},{default:t(()=>[...a[12]||(a[12]=[v("å–æ¶ˆ",-1)])]),_:1}),e($,{type:"primary",loading:g.value,disabled:!c.value||k.value.length===0,onClick:_},{default:t(()=>[...a[13]||(a[13]=[v(" å¼€å§‹å¯¼å…¥ ",-1)])]),_:1},8,["loading","disabled"])]),default:t(()=>[x("div",Lo,[e(n,{message:"è¯·é€‰æ‹©å¯¼å…¥æ ¼å¼ï¼Œç„¶åä¸Šä¼ æ–‡ä»¶ã€‚Excel é€‚åˆæ‰¹é‡ç¼–è¾‘åº§ä½ä¿¡æ¯ï¼ŒJSON é€‚åˆå®Œæ•´é…ç½®å¤‡ä»½ã€‚",type:"info","show-icon":""}),x("div",No,[x("div",{style:Ie({border:c.value==="excel"?"2px solid var(--color-b5)":"1px solid var(--color-n4)",borderRadius:"8px",padding:"20px",cursor:"pointer",transition:"all 0.3s",backgroundColor:c.value==="excel"?"var(--color-b1)":"#fff"}),onClick:a[0]||(a[0]=Z=>c.value="excel")},[e(F,{direction:"vertical",size:12,style:{width:"100%"}},{default:t(()=>[x("div",Oo,[e(Y(kt),{style:{"font-size":"24px",color:"var(--color-g5)"}}),x("div",null,[e(S,{level:5,style:{margin:"0"}},{default:t(()=>[...a[3]||(a[3]=[v(" Excel è¡¨æ ¼å¯¼å…¥ ",-1)])]),_:1}),e(z,{type:"secondary",style:{"font-size":"13px"}},{default:t(()=>[...a[4]||(a[4]=[v(" ç®€å•æ˜“ç”¨ï¼Œä½¿ç”¨ Excel ç¼–è¾‘åº§ä½ä¿¡æ¯ ",-1)])]),_:1})])]),e($,{size:"small",onClick:Ke(m,["stop"])},{icon:t(()=>[e(Y(dt))]),default:t(()=>[a[5]||(a[5]=v(" ä¸‹è½½ Excel æ¨¡æ¿ ",-1))]),_:1})]),_:1})],4),x("div",{style:Ie({border:c.value==="json"?"2px solid var(--color-b5)":"1px solid var(--color-n4)",borderRadius:"8px",padding:"20px",cursor:"pointer",transition:"all 0.3s",backgroundColor:c.value==="json"?"var(--color-b1)":"#fff"}),onClick:a[1]||(a[1]=Z=>c.value="json")},[e(F,{direction:"vertical",size:12,style:{width:"100%"}},{default:t(()=>[x("div",Po,[e(Y(Ga),{style:{"font-size":"24px",color:"var(--color-p5)"}}),x("div",null,[e(S,{level:5,style:{margin:"0"}},{default:t(()=>[...a[6]||(a[6]=[v(" JSON æ•°æ®å¯¼å…¥ ",-1)])]),_:1}),e(z,{type:"secondary",style:{"font-size":"13px"}},{default:t(()=>[...a[7]||(a[7]=[v(" å®Œæ•´æ•°æ®å¤‡ä»½ï¼ŒåŒ…å«æ‰€æœ‰é…ç½® ",-1)])]),_:1})])]),e($,{size:"small",onClick:Ke(r,["stop"])},{icon:t(()=>[e(Y(dt))]),default:t(()=>[a[8]||(a[8]=v(" ä¸‹è½½ JSON æ¨¡æ¿ ",-1))]),_:1})]),_:1})],4)]),e(D,{style:{margin:"0"}},{default:t(()=>[...a[9]||(a[9]=[v("ä¸Šä¼ æ–‡ä»¶",-1)])]),_:1}),c.value?(I(),V(P,{key:0,fileList:k.value,"onUpdate:fileList":a[2]||(a[2]=Z=>k.value=Z),name:"file","before-upload":y,multiple:!1,"max-count":1},{default:t(()=>[x("p",Uo,[e(Y(qa))]),a[10]||(a[10]=x("p",{class:"ant-upload-text"},"ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤åŒºåŸŸä¸Šä¼ ",-1)),x("p",Ao," æ”¯æŒæ ¼å¼ï¼š"+B(c.value==="excel"?".xlsx, .xls":".json")+" | æœ€å¤§æ–‡ä»¶ï¼š10MB ",1)]),_:1},8,["fileList"])):(I(),O("div",Vo,[e(z,{type:"secondary"},{default:t(()=>[...a[11]||(a[11]=[v("è¯·å…ˆé€‰æ‹©å¯¼å…¥æ ¼å¼",-1)])]),_:1})])),k.value.length>0?(I(),V(n,{key:2,message:"å¯¼å…¥ä¼šè¦†ç›–å½“å‰çš„æ‰€æœ‰åº§ä½æ•°æ®ï¼Œè¯·ç¡®è®¤æ–‡ä»¶å†…å®¹æ­£ç¡®åå†å¯¼å…¥ã€‚",type:"warning","show-icon":""})):q("",!0)])]),_:1},8,["open"])}}}),Bo=(l,h,u="åº§ä½å›¾")=>{try{const p=l.floors.find(b=>b.id===h),s=l.seats.filter(b=>b.floorId===h),d=l.stage;if(!p)throw new Error("æœªæ‰¾åˆ°å½“å‰æ¥¼å±‚");const i=qo(s,d?[d]:[]),c=100,k=i.maxX-i.minX+c*2,g=i.maxY-i.minY+c*2,m=-i.minX+c,r=-i.minY+c,o=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${k}" height="${g}" viewBox="0 0 ${k} ${g}">
  <rect fill="#ffffff" width="${k}" height="${g}"/>
  <text x="${k/2}" y="40" text-anchor="middle" font-size="24" font-weight="bold" fill="#000000">
    ${l.name} - ${p.name}
  </text>
  ${d?`
  <rect 
    x="${d.x+m}" 
    y="${d.y+r}" 
    width="${d.width}" 
    height="${d.height}" 
    fill="${d.color||"#fa8c16"}" 
    stroke="#d46b08" 
    stroke-width="2"
    rx="4"
  />
  <text 
    x="${d.x+d.width/2+m}" 
    y="${d.y+d.height/2+r}" 
    text-anchor="middle" 
    dominant-baseline="middle" 
    font-size="16" 
    font-weight="bold" 
    fill="#ffffff"
  >
    ${d.name}
  </text>`:""}
  ${s.map(b=>{const f=b.status==="available",a=f?"#1890ff":"#d9d9d9";return`
  <g>
    <circle 
      cx="${b.x+m}" 
      cy="${b.y+r}" 
      r="10" 
      fill="${a}" 
      stroke="${f?"#096dd9":"#8c8c8c"}" 
      stroke-width="2"
    />
    <text 
      x="${b.x+m}" 
      y="${b.y+r}" 
      text-anchor="middle" 
      dominant-baseline="middle" 
      font-size="10" 
      fill="#ffffff"
    >
      ${b.rowLabel}-${b.seatLabel}
    </text>
  </g>`}).join("")}
  <g transform="translate(20, ${g-60})">
    <text x="0" y="0" font-size="14" font-weight="bold" fill="#000000">å›¾ä¾‹ï¼š</text>
    <circle cx="10" cy="20" r="8" fill="#1890ff" stroke="#096dd9" stroke-width="2"/>
    <text x="25" y="24" font-size="12" fill="#000000">å¯ç”¨åº§ä½</text>
    <circle cx="100" cy="20" r="8" fill="#d9d9d9" stroke="#8c8c8c" stroke-width="2"/>
    <text x="115" y="24" font-size="12" fill="#000000">ä¸å¯ç”¨åº§ä½</text>
    <rect x="200" y="12" width="30" height="16" fill="#fa8c16" stroke="#d46b08" stroke-width="2" rx="2"/>
    <text x="235" y="24" font-size="12" fill="#000000">èˆå°</text>
  </g>
  <text x="${k-20}" y="${g-30}" text-anchor="end" font-size="12" fill="#666666">
    æ€»åº§ä½æ•°: ${s.length} | å¯ç”¨: ${s.filter(b=>b.status==="available").length}
  </text>
  <text x="${k-20}" y="${g-15}" text-anchor="end" font-size="10" fill="#999999">
    å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString("zh-CN")}
  </text>
</svg>`,y=new Blob([o],{type:"image/svg+xml;charset=utf-8"}),_=URL.createObjectURL(y);ia(_,`${u}.svg`),URL.revokeObjectURL(_)}catch(p){throw console.error("å¯¼å‡º SVG å¤±è´¥:",p),new Error("å¯¼å‡º SVG çŸ¢é‡å›¾å¤±è´¥")}},Xo=async(l,h="åº§ä½æ•°æ®")=>{const u=[],p=new Map;l.floors.forEach(g=>{p.set(g.id,g)});const s=new Map;l.zones?.forEach(g=>{const m=`${g.floorId}-${g.id}`;s.set(m,g.name)}),l.seats.forEach(g=>{const m=p.get(g.floorId),r=s.get(`${g.floorId}-${g.zoneId}`)||"";u.push({æ¥¼å±‚:m?.name||"",åº§åŒº:r,æ’å·:g.rowLabel,åº§å·:g.seatLabel,çŠ¶æ€:g.status==="available"?"å¯ç”¨":"ç¦ç”¨",æ ‡ç­¾:g.label||"",Xåæ ‡:g.x,Yåæ ‡:g.y})});const{utils:d,writeFile:i}=await na(async()=>{const{utils:g,writeFile:m}=await import("./vendor-CQ4RscqV.js").then(r=>r.aX);return{utils:g,writeFile:m}},__vite__mapDeps([0,1,2,3])),c=d.json_to_sheet(u),k=d.book_new();d.book_append_sheet(k,c,"åº§ä½æ•°æ®"),i(k,`${h}.xlsx`)},Zo=(l,h="åº§ä½æ•°æ®å¤‡ä»½")=>{try{const u=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),p=URL.createObjectURL(u),s=document.createElement("a");s.href=p,s.download=`${h}.json`,s.click(),URL.revokeObjectURL(p)}catch(u){throw console.error("å¯¼å‡º JSON å¤±è´¥:",u),new Error("å¯¼å‡º JSON æ•°æ®å¤±è´¥")}},Go=async(l,h,u,p={})=>{const{paperSize:s="A4",orientation:d="landscape",colorMode:i="color",showLegend:c=!0,showFooter:k=!0}=p,{jsPDF:g}=await na(async()=>{const{jsPDF:m}=await import("./vendor-CQ4RscqV.js").then(r=>r.aY);return{jsPDF:m}},__vite__mapDeps([0,1,2,3]));try{const m=l.floors.find(L=>L.id===u),r=l.seats.filter(L=>L.floorId===u),o=r.filter(L=>L.status==="available");if(!m)throw new Error("æœªæ‰¾åˆ°å½“å‰æ¥¼å±‚");const _={A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297}}[s],b=d==="landscape"?Math.max(_.width,_.height):Math.min(_.width,_.height),f=d==="landscape"?Math.min(_.width,_.height):Math.max(_.width,_.height),a=new g({orientation:d,unit:"mm",format:s.toLowerCase()}),n=15;let S=n;a.setFont("helvetica","bold"),a.setFontSize(20),a.setTextColor(0,0,0),a.text(`${l.name} - åº§ä½å›¾`,b/2,S+5,{align:"center"}),S+=10,a.setFontSize(14),a.setFont("helvetica","normal"),a.text(`${m.name}`,b/2,S+5,{align:"center"}),S+=8,a.setDrawColor(200,200,200),a.setLineWidth(.5),a.line(n,S+2,b-n,S+2),S+=8,c&&(a.setFontSize(10),a.setTextColor(80,80,80),a.text("å›¾ä¾‹ï¼š",n,S),a.setFillColor(24,144,255),a.setDrawColor(9,109,217),a.circle(n+20,S-3,2.5,"FD"),a.text("å¯ç”¨åº§ä½",n+26,S),a.setFillColor(217,217,217),a.setDrawColor(140,140,140),a.circle(n+60,S-3,2.5,"FD"),a.text("ä¸å¯ç”¨åº§ä½",n+66,S),a.setFillColor(250,140,22),a.setDrawColor(212,107,8),a.rect(n+110,S-7,8,4,"FD"),a.text("èˆå°",n+120,S),S+=10);const z=b-n*2,$=f-n-S-(k?15:0),F=h.width/h.height;let D=z,P=D/F;P>$&&(P=$,D=P*F);const A=(b-D)/2,Z=S;let ne;if(i==="grayscale"){const L=document.createElement("canvas");L.width=h.width,L.height=h.height;const H=L.getContext("2d");if(H){H.drawImage(h,0,0);const J=H.getImageData(0,0,L.width,L.height),ue=J.data;for(let pe=0;pe<ue.length;pe+=4){const G=.299*ue[pe]+.587*ue[pe+1]+.114*ue[pe+2];ue[pe]=G,ue[pe+1]=G,ue[pe+2]=G}H.putImageData(J,0,0),ne=L.toDataURL("image/png",1)}else ne=h.toDataURL("image/png",1)}else ne=h.toDataURL("image/png",1);if(a.addImage(ne,"PNG",A,Z,D,P),k){const L=o.length;a.setFontSize(10),a.setFont("helvetica","normal"),a.setTextColor(100,100,100);const H=`æ€»åº§ä½æ•°: ${r.length} | å¯ç”¨åº§ä½: ${L} | ä¸å¯ç”¨åº§ä½: ${r.length-L}`;a.text(H,n,f-10);const J=`å¯¼å‡ºæ—¶é—´: ${new Date().toLocaleString("zh-CN")}`;a.text(J,b-n,f-10,{align:"right"}),a.text("ç¬¬ 1 é¡µ",b/2,f-10,{align:"center"})}const T=`${l.name}-${m.name||"åº§ä½å›¾"}`;a.save(`${T}.pdf`)}catch(m){throw console.error("å¯¼å‡º PDF å¤±è´¥:",m),new Error("å¯¼å‡º PDF æ–‡æ¡£å¤±è´¥ï¼Œè¯·ç¡®è®¤å·²å®‰è£… jsPDF åº“")}};function ia(l,h){const u=document.createElement("a");u.download=h,u.href=l,u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u)}function qo(l,h){if(l.length===0&&h.length===0)return{minX:0,minY:0,maxX:1e3,maxY:800};let u=1/0,p=1/0,s=-1/0,d=-1/0;return l.forEach(i=>{u=Math.min(u,i.x-10),p=Math.min(p,i.y-10),s=Math.max(s,i.x+10),d=Math.max(d,i.y+10)}),h.forEach(i=>{u=Math.min(u,i.x),p=Math.min(p,i.y),s=Math.max(s,i.x+i.width),d=Math.max(d,i.y+i.height)}),{minX:u,minY:p,maxX:s,maxY:d}}const jo=(l,h="åº§ä½å›¾-é«˜æ¸…")=>{try{const u=document.createElement("canvas"),p=2;u.width=l.width*p,u.height=l.height*p;const s=u.getContext("2d");if(!s)throw new Error("æ— æ³•è·å– Canvas ä¸Šä¸‹æ–‡");s.scale(p,p),s.drawImage(l,0,0);const d=u.toDataURL("image/png",1);ia(d,`${h}.png`)}catch(u){throw console.error("å¯¼å‡ºé«˜æ¸… PNG å¤±è´¥:",u),new Error("å¯¼å‡ºé«˜æ¸… PNG å›¾ç‰‡å¤±è´¥")}},ra=(l,h)=>{const u=document.createElement("a");u.href=l,u.download=h,document.body.appendChild(u),u.click(),document.body.removeChild(u)},Ho=async(l,h,u)=>{try{const p=h.floors.find(i=>i.id===u),s=`${h.name}-${p?.name||"åº§ä½å›¾"}`,d=l.toDataURL("image/png",1);ra(d,`${s}.png`)}catch(p){throw console.error("å¯¼å‡º PNG å¤±è´¥:",p),new Error("å¯¼å‡º PNG å›¾ç‰‡å¤±è´¥")}},Ko=async(l,h,u)=>{try{const p=new Ka,s=p.folder("åº§ä½å›¾");if(!s)throw new Error("åˆ›å»º ZIP æ–‡ä»¶å¤¹å¤±è´¥");for(const g of l.floors){await u(g.id),await new Promise(r=>setTimeout(r,100));const m=await new Promise((r,o)=>{h.toBlob(y=>{y?r(y):o(new Error("ç”Ÿæˆå›¾ç‰‡å¤±è´¥"))},"image/png",1)});s.file(`${g.name}åº§ä½å›¾.png`,m)}const d=`åº§ä½å›¾å¯¼å‡ºè¯´æ˜
===================

å‰§åœºåç§°ï¼š${l.name}
å¯¼å‡ºæ—¶é—´ï¼š${new Date().toLocaleString("zh-CN")}
æ¥¼å±‚æ•°é‡ï¼š${l.floors.length}
æ€»åº§ä½æ•°ï¼š${l.seats.length}

æ¥¼å±‚åˆ—è¡¨ï¼š
${l.floors.map((g,m)=>{const r=l.seats.filter(o=>o.floorId===g.id);return`${m+1}. ${g.name}ï¼š${r.length} ä¸ªåº§ä½`}).join(`
`)}

è¯´æ˜ï¼š
- æ¯ä¸ªæ¥¼å±‚å¯¹åº”ä¸€å¼  PNG å›¾ç‰‡
- èˆå°ä¼šåœ¨æ¯å¼ å›¾ç‰‡é¡¶éƒ¨æ˜¾ç¤ºï¼Œæ–¹ä¾¿é¢„è§ˆ
- å›¾ç‰‡ç¼©æ”¾æ¯”ä¾‹ä¸ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºä¸€è‡´`;s.file("å¯¼å‡ºè¯´æ˜.txt",d);const i=await p.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),c=URL.createObjectURL(i),k=new Date().toISOString().slice(0,10);ra(c,`${l.name}_åº§ä½å›¾_${k}.zip`),URL.revokeObjectURL(c)}catch(p){throw console.error("å¯¼å‡º ZIP å¤±è´¥:",p),new Error("å¯¼å‡ºå¤šæ¥¼å±‚ PNG å¤±è´¥")}},Wo=async(l,h,u,p="A4",s="landscape",d="color")=>{try{const c={A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297}}[p],k=s==="landscape"?Math.max(c.width,c.height):Math.min(c.width,c.height),g=s==="landscape"?Math.min(c.width,c.height):Math.max(c.width,c.height),m=new Wa({orientation:s,unit:"mm",format:p.toLowerCase()}),r=15;for(let _=0;_<l.floors.length;_++){const b=l.floors[_];if(!b)continue;const f=l.seats.filter(Z=>Z.floorId===b.id),a=f.filter(Z=>Z.status==="available");_>0&&m.addPage(),await u(b.id),await new Promise(Z=>setTimeout(Z,100));let n=h.toDataURL("image/png",1);d==="grayscale"&&(n=await Jo(h));const S=h.width/h.height,z=k-r*2,$=g-r*2-25-20;let F=z,D=F/S;D>$&&(D=$,F=D*S);const P=(k-F)/2,A=r+22;m.setFontSize(20),m.setTextColor(0,0,0),m.text(`${l.name} - åº§ä½å›¾`,k/2,r+5,{align:"center"}),m.setFontSize(14),m.text(`${b.name} (${_+1}/${l.floors.length})`,k/2,r+12,{align:"center"}),m.setDrawColor(200,200,200),m.setLineWidth(.5),m.line(r,r+17,k-r,r+17),m.addImage(n,"PNG",P,A,F,D),m.setFontSize(10),m.setTextColor(100,100,100),m.text(`åº§ä½ï¼š${f.length} | å¯ç”¨ï¼š${a.length} | å¯¼å‡ºæ—¶é—´ï¼š${new Date().toLocaleString("zh-CN")}`,k/2,g-r+5,{align:"center"}),m.text(`ç¬¬ ${_+1} é¡µï¼Œå…± ${l.floors.length} é¡µ`,k-r,g-r+5,{align:"right"})}const o=new Date().toISOString().slice(0,10),y=`${l.name}_åº§ä½å›¾_å…¨éƒ¨æ¥¼å±‚_${o}`;m.save(`${y}.pdf`)}catch(i){throw console.error("å¯¼å‡ºå¤šé¡µ PDF å¤±è´¥:",i),new Error("å¯¼å‡ºå¤šæ¥¼å±‚ PDF å¤±è´¥")}},Jo=async l=>new Promise((h,u)=>{const p=l.getContext("2d");if(!p){u(new Error("è·å– canvas ä¸Šä¸‹æ–‡å¤±è´¥"));return}const s=p.getImageData(0,0,l.width,l.height),d=s.data;for(let i=0;i<d.length;i+=4){const c=(d[i]+d[i+1]+d[i+2])/3;d[i]=c,d[i+1]=c,d[i+2]=c}p.putImageData(s,0,0),h(l.toDataURL("image/png",1))}),Qo={style:{"margin-bottom":"8px"}},es={style:{"margin-bottom":"8px"}},ts={style:{"margin-bottom":"8px"}},as={style:{"margin-bottom":"8px"}},ns={style:{"margin-bottom":"8px"}},ls={style:{"margin-bottom":"8px"}},os=de({__name:"ExportPanel",props:{theaterData:{},canvasRef:{},currentFloorId:{},renderFloor:{type:Function}},setup(l){const h=l,u=E(!1),p=E("current"),s=E("A4"),d=E("landscape"),i=E("color"),c=W(()=>h.theaterData.floors.find(f=>f.id===h.currentFloorId)),k=W(()=>h.theaterData.seats.filter(f=>f.floorId===h.currentFloorId).length),g=()=>h.canvasRef?h.canvasRef:document.querySelector("canvas"),m=async()=>{const f=g();if(!f){N.error("Canvas æœªå°±ç»ªï¼Œè¯·ç¨åé‡è¯•");return}try{if(u.value=!0,p.value==="current")await Ho(f,h.theaterData,h.currentFloorId),N.success("PNG å›¾ç‰‡å¯¼å‡ºæˆåŠŸ");else{if(!h.renderFloor){N.error("å¤šæ¥¼å±‚å¯¼å‡ºåŠŸèƒ½ä¸å¯ç”¨");return}await Ko(h.theaterData,f,h.renderFloor),N.success(`å·²å¯¼å‡º ${h.theaterData.floors.length} ä¸ªæ¥¼å±‚å¹¶æ‰“åŒ…ä¸º ZIP æ–‡ä»¶`)}}catch(a){console.error("å¯¼å‡ºå›¾ç‰‡å¤±è´¥:",a),N.error(a?.message||"å¯¼å‡ºå›¾ç‰‡å¤±è´¥")}finally{u.value=!1}},r=async()=>{const f=g();if(!f){N.error("Canvas æœªå°±ç»ªï¼Œè¯·ç¨åé‡è¯•");return}try{u.value=!0;const a=c.value,n=`${h.theaterData.name}-${a?.name||"åº§ä½å›¾"}-é«˜æ¸…`;jo(f,n),N.success("é«˜æ¸… PNG å›¾ç‰‡å¯¼å‡ºæˆåŠŸ")}catch(a){console.error("å¯¼å‡ºé«˜æ¸…å›¾ç‰‡å¤±è´¥:",a),N.error(a?.message||"å¯¼å‡ºé«˜æ¸…å›¾ç‰‡å¤±è´¥")}finally{u.value=!1}},o=()=>{try{u.value=!0;const f=c.value,a=`${h.theaterData.name}-${f?.name||"åº§ä½å›¾"}`;Bo(h.theaterData,h.currentFloorId,a),N.success("SVG çŸ¢é‡å›¾å¯¼å‡ºæˆåŠŸ")}catch(f){console.error("å¯¼å‡º SVG å¤±è´¥:",f),N.error(f?.message||"å¯¼å‡º SVG å¤±è´¥")}finally{u.value=!1}},y=async()=>{try{u.value=!0;const f=`${h.theaterData.name}-åº§ä½æ•°æ®`;await Xo(h.theaterData,f),N.success("Excel è¡¨æ ¼å¯¼å‡ºæˆåŠŸ")}catch(f){console.error("å¯¼å‡º Excel å¤±è´¥:",f),N.error(f?.message||"å¯¼å‡º Excel è¡¨æ ¼å¤±è´¥")}finally{u.value=!1}},_=()=>{try{u.value=!0;const f=`${h.theaterData.name}-æ•°æ®å¤‡ä»½`;Zo(h.theaterData,f),N.success("JSON æ•°æ®å¯¼å‡ºæˆåŠŸ")}catch(f){console.error("å¯¼å‡º JSON å¤±è´¥:",f),N.error(f?.message||"å¯¼å‡º JSON æ•°æ®å¤±è´¥")}finally{u.value=!1}},b=async()=>{const f=g();if(!f){N.error("Canvas æœªå°±ç»ªï¼Œè¯·ç¨åé‡è¯•");return}try{u.value=!0;const a=c.value,n={paperSize:s.value,orientation:d.value,colorMode:i.value,showLegend:!0,showFooter:!0};if(p.value==="current")await Go(h.theaterData,f,h.currentFloorId,n),N.success("PDF æ–‡æ¡£å¯¼å‡ºæˆåŠŸ");else{if(!h.renderFloor){N.error("å¤šæ¥¼å±‚å¯¼å‡ºåŠŸèƒ½ä¸å¯ç”¨");return}await Wo(h.theaterData,f,h.renderFloor,s.value,d.value,i.value),N.success(`å·²å¯¼å‡ºå…¨éƒ¨ ${h.theaterData.floors.length} ä¸ªæ¥¼å±‚çš„ PDF æ–‡æ¡£`)}}catch(a){console.error("å¯¼å‡º PDF å¤±è´¥:",a),N.error(a?.message||"å¯¼å‡º PDF æ–‡æ¡£å¤±è´¥")}finally{u.value=!1}};return(f,a)=>{const n=w("a-typography-text"),S=w("a-space"),z=w("a-card"),$=w("a-radio-button"),F=w("a-radio-group"),D=w("a-button"),P=w("a-divider"),A=w("a-collapse-panel"),Z=w("a-collapse"),ne=w("a-alert");return I(),O("div",null,[e(z,{size:"small",style:{"margin-bottom":"16px"}},{default:t(()=>[e(S,{direction:"vertical",size:4,style:{width:"100%"}},{default:t(()=>[x("div",null,[e(n,{type:"secondary"},{default:t(()=>[...a[5]||(a[5]=[v("å‰§åœºï¼š",-1)])]),_:1}),e(n,{strong:""},{default:t(()=>[v(B(h.theaterData.name),1)]),_:1})]),x("div",null,[e(n,{type:"secondary"},{default:t(()=>[...a[6]||(a[6]=[v("æ¥¼å±‚ï¼š",-1)])]),_:1}),e(n,{strong:""},{default:t(()=>[v(B(c.value?.name||"-"),1)]),_:1})]),x("div",null,[e(n,{type:"secondary"},{default:t(()=>[...a[7]||(a[7]=[v("åº§ä½ï¼š",-1)])]),_:1}),e(n,{strong:""},{default:t(()=>[v(B(k.value)+" ä¸ªï¼ˆæ€»è®¡ "+B(h.theaterData.seats.length)+" ä¸ªï¼‰ ",1)]),_:1})])]),_:1})]),_:1}),e(z,{title:"å¿«é€Ÿå¯¼å‡º",bordered:!1,style:{"margin-bottom":"16px"}},{default:t(()=>[e(S,{direction:"vertical",size:16,style:{width:"100%"}},{default:t(()=>[x("div",null,[x("div",Qo,[e(Y(rt),{style:{"margin-right":"8px",color:"#1890ff"}}),e(n,{strong:""},{default:t(()=>[...a[8]||(a[8]=[v(" å¯¼å‡ºå›¾ç‰‡ï¼ˆPNGï¼‰ ",-1)])]),_:1})]),e(n,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"8px"}},{default:t(()=>[...a[9]||(a[9]=[v(" é€‚åˆæ‰“å°ã€æ–¹æ¡ˆè¯„å®¡ç­‰åœºæ™¯ï¼Œæ”¯æŒå¯¼å‡ºå½“å‰æ¥¼å±‚æˆ–æ‰€æœ‰æ¥¼å±‚ï¼ˆZIP æ‰“åŒ…ï¼‰ã€‚ ",-1)])]),_:1}),e(S,{direction:"vertical",size:8,style:{width:"100%"}},{default:t(()=>[e(F,{value:p.value,"onUpdate:value":a[0]||(a[0]=T=>p.value=T),size:"small"},{default:t(()=>[e($,{value:"current"},{default:t(()=>[...a[10]||(a[10]=[v("å½“å‰æ¥¼å±‚",-1)])]),_:1}),e($,{value:"all"},{default:t(()=>[...a[11]||(a[11]=[v("æ‰€æœ‰æ¥¼å±‚",-1)])]),_:1})]),_:1},8,["value"]),e(D,{block:"",loading:u.value,onClick:m},{icon:t(()=>[e(Y(rt))]),default:t(()=>[a[12]||(a[12]=v(" å¯¼å‡º PNG å›¾ç‰‡ ",-1))]),_:1},8,["loading"])]),_:1})]),e(P,{style:{margin:"0"}}),x("div",null,[x("div",es,[e(Y(Yt),{style:{"margin-right":"8px",color:"#eb2f96"}}),e(n,{strong:""},{default:t(()=>[...a[13]||(a[13]=[v(" å¯¼å‡º PDF æ–‡æ¡£ ",-1)])]),_:1})]),e(n,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"8px"}},{default:t(()=>[...a[14]||(a[14]=[v(" æ”¯æŒè®¾ç½®çº¸å¼ å¤§å°ã€æ–¹å‘å’Œé¢œè‰²æ¨¡å¼ï¼Œé€‚åˆæ‰“å°å’Œå½’æ¡£ã€‚ ",-1)])]),_:1}),e(S,{direction:"vertical",size:8,style:{width:"100%"}},{default:t(()=>[e(S,{size:8},{default:t(()=>[e(F,{value:s.value,"onUpdate:value":a[1]||(a[1]=T=>s.value=T),size:"small"},{default:t(()=>[e($,{value:"A2"},{default:t(()=>[...a[15]||(a[15]=[v("A2",-1)])]),_:1}),e($,{value:"A3"},{default:t(()=>[...a[16]||(a[16]=[v("A3",-1)])]),_:1}),e($,{value:"A4"},{default:t(()=>[...a[17]||(a[17]=[v("A4",-1)])]),_:1})]),_:1},8,["value"]),e(F,{value:d.value,"onUpdate:value":a[2]||(a[2]=T=>d.value=T),size:"small"},{default:t(()=>[e($,{value:"landscape"},{default:t(()=>[...a[18]||(a[18]=[v("æ¨ªå‘",-1)])]),_:1}),e($,{value:"portrait"},{default:t(()=>[...a[19]||(a[19]=[v("çºµå‘",-1)])]),_:1})]),_:1},8,["value"]),e(F,{value:i.value,"onUpdate:value":a[3]||(a[3]=T=>i.value=T),size:"small"},{default:t(()=>[e($,{value:"color"},{default:t(()=>[...a[20]||(a[20]=[v("å½©è‰²",-1)])]),_:1}),e($,{value:"grayscale"},{default:t(()=>[...a[21]||(a[21]=[v("ç°åº¦",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(F,{value:p.value,"onUpdate:value":a[4]||(a[4]=T=>p.value=T),size:"small"},{default:t(()=>[e($,{value:"current"},{default:t(()=>[...a[22]||(a[22]=[v("å½“å‰æ¥¼å±‚",-1)])]),_:1}),e($,{value:"all"},{default:t(()=>[...a[23]||(a[23]=[v("æ‰€æœ‰æ¥¼å±‚",-1)])]),_:1})]),_:1},8,["value"]),e(D,{block:"",loading:u.value,onClick:b},{icon:t(()=>[e(Y(Yt))]),default:t(()=>[a[24]||(a[24]=v(" å¯¼å‡º PDF æ–‡æ¡£ ",-1))]),_:1},8,["loading"])]),_:1})]),e(P,{style:{margin:"0"}}),x("div",null,[x("div",ts,[e(Y(kt),{style:{"margin-right":"8px",color:"#52c41a"}}),e(n,{strong:""},{default:t(()=>[...a[25]||(a[25]=[v(" å¯¼å‡º Excel è¡¨æ ¼ ",-1)])]),_:1})]),e(n,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"8px"}},{default:t(()=>[...a[26]||(a[26]=[v(" é€‚åˆæ•°æ®åˆ†æã€ç»Ÿè®¡æŠ¥è¡¨ã€ç³»ç»Ÿå¯¹æ¥ç­‰åœºæ™¯ã€‚ ",-1)])]),_:1}),e(D,{block:"",loading:u.value,onClick:y},{icon:t(()=>[e(Y(kt))]),default:t(()=>[a[27]||(a[27]=v(" å¯¼å‡º Excel è¡¨æ ¼ ",-1))]),_:1},8,["loading"])]),x("div",null,[x("div",as,[e(Y(Bt),{style:{"margin-right":"8px",color:"#722ed1"}}),e(n,{strong:""},{default:t(()=>[...a[28]||(a[28]=[v(" æ•°æ®å¤‡ä»½ (JSON) ",-1)])]),_:1})]),e(n,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"8px"}},{default:t(()=>[...a[29]||(a[29]=[v(" é€‚åˆç³»ç»Ÿå¤‡ä»½ã€æ•°æ®è¿ç§»ã€ç‰ˆæœ¬ç®¡ç†ç­‰åœºæ™¯ã€‚ ",-1)])]),_:1}),e(D,{block:"",loading:u.value,onClick:_},{icon:t(()=>[e(Y(Bt))]),default:t(()=>[a[30]||(a[30]=v(" å¯¼å‡º JSON æ•°æ® ",-1))]),_:1},8,["loading"])])]),_:1})]),_:1}),e(Z,{ghost:""},{default:t(()=>[e(A,{key:"advanced"},{header:t(()=>[e(S,null,{default:t(()=>[e(Y(ea)),e(n,{strong:""},{default:t(()=>[...a[31]||(a[31]=[v(" é«˜çº§é€‰é¡¹ ",-1)])]),_:1}),e(n,{type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[...a[32]||(a[32]=[v(" ï¼ˆä¸“ä¸šç”¨æˆ·ä½¿ç”¨ï¼‰ ",-1)])]),_:1})]),_:1})]),default:t(()=>[e(S,{direction:"vertical",size:12,style:{width:"100%"}},{default:t(()=>[x("div",null,[x("div",ns,[e(Y(rt),{style:{"margin-right":"8px"}}),e(n,{strong:""},{default:t(()=>[...a[33]||(a[33]=[v(" é«˜æ¸…å›¾ç‰‡ï¼ˆ2x åˆ†è¾¨ç‡ï¼‰ ",-1)])]),_:1})]),e(n,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"8px"}},{default:t(()=>[...a[34]||(a[34]=[v(" é€‚åˆå¤§å±å±•ç¤ºã€é«˜è´¨é‡æ‰“å°ã€‚ ",-1)])]),_:1}),e(D,{block:"",loading:u.value,onClick:r},{icon:t(()=>[e(Y(rt))]),default:t(()=>[a[35]||(a[35]=v(" å¯¼å‡ºé«˜æ¸… PNG ",-1))]),_:1},8,["loading"])]),x("div",null,[x("div",ls,[e(Y(dt),{style:{"margin-right":"8px"}}),e(n,{strong:""},{default:t(()=>[...a[36]||(a[36]=[v(" çŸ¢é‡å›¾ (SVG) ",-1)])]),_:1})]),e(n,{type:"secondary",style:{"font-size":"12px",display:"block","margin-bottom":"8px"}},{default:t(()=>[...a[37]||(a[37]=[v(" é€‚åˆè®¾è®¡å¸ˆäºŒæ¬¡ç¼–è¾‘ã€æ— æŸç¼©æ”¾ã€‚ ",-1)])]),_:1}),e(D,{block:"",loading:u.value,onClick:o},{icon:t(()=>[e(Y(dt))]),default:t(()=>[a[38]||(a[38]=v(" å¯¼å‡º SVG çŸ¢é‡å›¾ ",-1))]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),e(ne,{style:{"margin-top":"16px"},type:"info","show-icon":""},{message:t(()=>[e(S,null,{default:t(()=>[e(Y(It)),a[39]||(a[39]=x("span",null,"å¯¼å‡ºçš„æ–‡ä»¶ä¼šè‡ªåŠ¨ä¸‹è½½åˆ°æµè§ˆå™¨çš„é»˜è®¤ä¸‹è½½ä½ç½®ã€‚",-1))]),_:1})]),_:1})])}}}),ss={style:{display:"contents"}},is={class:"menu-label-with-shortcut"},rs={class:"shortcut-text"},us={class:"menu-label-with-shortcut"},ds={class:"shortcut-text"},cs={class:"menu-label-with-shortcut"},ps={class:"shortcut-text"},fs={class:"menu-label-with-shortcut"},ms={class:"shortcut-text"},vs={class:"menu-label-with-shortcut"},ys={class:"shortcut-text"},gs={class:"menu-label-with-shortcut"},_s={class:"shortcut-text"},bs={class:"menu-label-with-shortcut"},hs={class:"shortcut-text"},xs={class:"menu-label-with-shortcut"},ks={class:"shortcut-text"},ws={class:"menu-label-with-shortcut"},Ss={class:"shortcut-text"},Cs={class:"menu-label-with-shortcut"},Is={class:"shortcut-text"},Ts={class:"menu-label-with-shortcut"},$s={class:"shortcut-text"},Rs={class:"menu-label-with-shortcut"},zs={class:"shortcut-text"},Ds={class:"menu-label-with-shortcut"},Ms={class:"shortcut-text"},Fs={class:"menu-label-with-shortcut"},Es={class:"shortcut-text"},Ls={class:"menu-label-with-shortcut"},Ns={class:"shortcut-text"},Os={class:"menu-label-with-shortcut"},Ps={class:"shortcut-text"},Us={class:"menu-label-with-shortcut"},As={class:"shortcut-text"},Vs={class:"menu-label-with-shortcut"},Ys={class:"shortcut-text"},Bs=de({__name:"ContextMenu",props:{selectedElement:{},selectedSeats:{},hasClipboard:{type:Boolean},hasSeats:{type:Boolean},zones:{}},emits:["copy","cut","paste","paste-here","duplicate","delete","align","lock","unlock","group","ungroup","edit","renumber","create-zone","assign-zone","remove-zone","select-all"],setup(l,{emit:h}){const u=l,p=h,s=typeof window<"u"&&/Mac|iPhone|iPad|iPod|Macintosh/.test(window.navigator.userAgent),d=(a,n)=>{const S=s?"âŒ˜":"Ctrl",z=s?"â‡§":"Shift",$=s?"âŒ¥":"Alt";return n==="ctrl"?`${S}+${a.toUpperCase()}`:n==="shift"?`${z}+${a.toUpperCase()}`:n==="ctrl+shift"?`${S}+${z}+${a.toUpperCase()}`:n==="alt"?`${$}+${a.toUpperCase()}`:a.toUpperCase()},i=W(()=>u.selectedSeats?.length||0),c=W(()=>i.value===1),k=W(()=>i.value>1),g=W(()=>u.selectedSeats?u.selectedSeats.some(a=>a.locked):!1),m=W(()=>u.selectedSeats?u.selectedSeats.some(a=>!a.locked):!1),r=W(()=>u.selectedSeats?u.selectedSeats.some(a=>a.groupId):!1),o=W(()=>k.value&&!r.value),y=W(()=>u.selectedSeats?u.selectedSeats.some(a=>!!a.groupId):!1),_=W(()=>u.selectedSeats?u.selectedSeats.some(a=>a.zoneId):!1),b=W(()=>k.value),f=a=>{p("align",a)};return(a,n)=>{const S=w("a-menu-item"),z=w("a-menu-divider"),$=w("a-badge"),F=w("a-sub-menu"),D=w("a-menu"),P=w("a-dropdown");return I(),V(P,{trigger:["contextmenu"],overlayClassName:"seat-context-menu",overlayStyle:{minWidth:"220px"}},{overlay:t(()=>[e(D,null,{default:t(()=>[l.selectedElement?l.selectedElement.type==="stage"?(I(),V(S,{key:"delete-stage",danger:"",onClick:n[3]||(n[3]=A=>p("delete"))},{icon:t(()=>[e(Y(Je))]),default:t(()=>[n[26]||(n[26]=x("span",null,"åˆ é™¤èˆå°",-1))]),_:1})):(I(),O(oe,{key:2},[e(S,{key:"edit",disabled:!c.value,onClick:n[4]||(n[4]=A=>p("edit"))},{icon:t(()=>[e(Y(ct))]),default:t(()=>[x("div",us,[n[27]||(n[27]=x("span",null,"ç¼–è¾‘å±æ€§",-1)),x("span",ds,B(d("Enter")),1)])]),_:1},8,["disabled"]),e(S,{key:"renumber",disabled:!k.value,onClick:n[5]||(n[5]=A=>p("renumber"))},{icon:t(()=>[e(Y(Qa))]),default:t(()=>[x("div",cs,[n[28]||(n[28]=x("span",null,"é‡æ–°ç¼–å·",-1)),x("span",ps,B(d("R","ctrl")),1)])]),_:1},8,["disabled"]),e(z),e(S,{key:"create-zone",onClick:n[6]||(n[6]=A=>p("create-zone"))},{icon:t(()=>[e(Y(Jt))]),default:t(()=>[n[29]||(n[29]=x("span",null,"åˆ›å»ºåº§åŒº",-1))]),_:1}),l.zones&&l.zones.length?(I(),V(F,{key:"assign-zone"},{title:t(()=>[x("span",null,[e(Y(en)),n[30]||(n[30]=x("span",{style:{"margin-left":"8px"}},"åˆ†é…åº§åŒº",-1))])]),default:t(()=>[(I(!0),O(oe,null,Se(l.zones,A=>(I(),V(S,{key:A.id,onClick:Z=>p("assign-zone",A.id)},{default:t(()=>[e($,{color:A.color,text:A.name},null,8,["color","text"])]),_:2},1032,["onClick"]))),128))]),_:1})):q("",!0),e(S,{key:"remove-zone",disabled:!_.value,onClick:n[7]||(n[7]=A=>p("remove-zone"))},{icon:t(()=>[e(Y(tn))]),default:t(()=>[n[31]||(n[31]=x("span",null,"ä»åº§åŒºç§»é™¤",-1))]),_:1},8,["disabled"]),e(z),e(S,{key:"copy",onClick:n[8]||(n[8]=A=>p("copy"))},{icon:t(()=>[e(Y(ut))]),default:t(()=>[x("div",fs,[n[32]||(n[32]=x("span",null,"å¤åˆ¶",-1)),x("span",ms,B(d("C","ctrl")),1)])]),_:1}),e(S,{key:"cut",onClick:n[9]||(n[9]=A=>p("cut"))},{icon:t(()=>[e(Y(an))]),default:t(()=>[x("div",vs,[n[33]||(n[33]=x("span",null,"å‰ªåˆ‡",-1)),x("span",ys,B(d("X","ctrl")),1)])]),_:1}),e(S,{key:"paste",disabled:!l.hasClipboard,onClick:n[10]||(n[10]=A=>p("paste"))},{icon:t(()=>[e(Y(xt))]),default:t(()=>[x("div",gs,[n[34]||(n[34]=x("span",null,"ç²˜è´´",-1)),x("span",_s,B(d("V","ctrl")),1)])]),_:1},8,["disabled"]),e(S,{key:"duplicate",onClick:n[11]||(n[11]=A=>p("duplicate"))},{icon:t(()=>[e(Y(ut))]),default:t(()=>[x("div",bs,[n[35]||(n[35]=x("span",null,"å¿«é€Ÿå¤åˆ¶",-1)),x("span",hs,B(d("D","ctrl")),1)])]),_:1}),e(z),b.value?(I(),V(F,{key:"align"},{title:t(()=>[x("span",null,[e(Y(Xt)),n[36]||(n[36]=x("span",{style:{"margin-left":"8px"}},"å¯¹é½",-1))])]),default:t(()=>[e(S,{key:"align-left",onClick:n[12]||(n[12]=A=>f("left"))},{icon:t(()=>[e(Y(Xt))]),default:t(()=>[x("div",xs,[n[37]||(n[37]=x("span",null,"å·¦å¯¹é½",-1)),x("span",ks,B(d("A","alt")),1)])]),_:1}),e(S,{key:"align-center",onClick:n[13]||(n[13]=A=>f("center"))},{icon:t(()=>[e(Y(nn))]),default:t(()=>[x("div",ws,[n[38]||(n[38]=x("span",null,"æ°´å¹³å±…ä¸­",-1)),x("span",Ss,B(d("H","alt")),1)])]),_:1}),e(S,{key:"align-right",onClick:n[14]||(n[14]=A=>f("right"))},{icon:t(()=>[e(Y(ln))]),default:t(()=>[x("div",Cs,[n[39]||(n[39]=x("span",null,"å³å¯¹é½",-1)),x("span",Is,B(d("D","alt")),1)])]),_:1}),e(z),e(S,{key:"align-top",onClick:n[15]||(n[15]=A=>f("top"))},{icon:t(()=>[e(Y(on))]),default:t(()=>[x("div",Ts,[n[40]||(n[40]=x("span",null,"é¡¶å¯¹é½",-1)),x("span",$s,B(d("W","alt")),1)])]),_:1}),e(S,{key:"align-middle",onClick:n[16]||(n[16]=A=>f("middle"))},{icon:t(()=>[e(Y(sn))]),default:t(()=>[x("div",Rs,[n[41]||(n[41]=x("span",null,"å‚ç›´å±…ä¸­",-1)),x("span",zs,B(d("V","alt")),1)])]),_:1}),e(S,{key:"align-bottom",onClick:n[17]||(n[17]=A=>f("bottom"))},{icon:t(()=>[e(Y(rn))]),default:t(()=>[x("div",Ds,[n[42]||(n[42]=x("span",null,"åº•å¯¹é½",-1)),x("span",Ms,B(d("S","alt")),1)])]),_:1})]),_:1})):q("",!0),e(S,{key:"group",disabled:!o.value,onClick:n[18]||(n[18]=A=>p("group"))},{icon:t(()=>[e(Y(un))]),default:t(()=>[x("div",Fs,[n[43]||(n[43]=x("span",null,"æˆç»„",-1)),x("span",Es,B(d("G","ctrl")),1)])]),_:1},8,["disabled"]),e(S,{key:"ungroup",disabled:!y.value,onClick:n[19]||(n[19]=A=>p("ungroup"))},{icon:t(()=>[e(Y(dn))]),default:t(()=>[x("div",Ls,[n[44]||(n[44]=x("span",null,"å–æ¶ˆæˆç»„",-1)),x("span",Ns,B(d("G","ctrl+shift")),1)])]),_:1},8,["disabled"]),e(z),e(S,{key:"lock",disabled:!m.value,onClick:n[20]||(n[20]=A=>p("lock"))},{icon:t(()=>[e(Y(ta))]),default:t(()=>[x("div",Os,[n[45]||(n[45]=x("span",null,"é”å®š",-1)),x("span",Ps,B(d("L","ctrl")),1)])]),_:1},8,["disabled"]),e(S,{key:"unlock",disabled:!g.value,onClick:n[21]||(n[21]=A=>p("unlock"))},{icon:t(()=>[e(Y(cn))]),default:t(()=>[x("div",Us,[n[46]||(n[46]=x("span",null,"è§£é”",-1)),x("span",As,B(d("L","ctrl+shift")),1)])]),_:1},8,["disabled"]),e(z),e(S,{key:"delete",danger:"",onClick:n[22]||(n[22]=A=>p("delete"))},{icon:t(()=>[e(Y(Je))]),default:t(()=>[x("div",Vs,[n[47]||(n[47]=x("span",null,"åˆ é™¤åº§ä½",-1)),x("span",Ys,B(d("Delete")),1)])]),_:1})],64)):(I(),O(oe,{key:0},[e(S,{key:"paste-here",disabled:!l.hasClipboard,onClick:n[0]||(n[0]=A=>p("paste-here"))},{icon:t(()=>[e(Y(ut))]),default:t(()=>[n[23]||(n[23]=x("span",null,"ç²˜è´´åˆ°è¿™",-1))]),_:1},8,["disabled"]),e(S,{key:"paste",disabled:!l.hasClipboard,onClick:n[1]||(n[1]=A=>p("paste"))},{icon:t(()=>[e(Y(xt))]),default:t(()=>[n[24]||(n[24]=x("span",null,"ç²˜è´´",-1))]),_:1},8,["disabled"]),e(z),e(S,{key:"select-all",disabled:!l.hasSeats,onClick:n[2]||(n[2]=A=>p("select-all"))},{icon:t(()=>[e(Y(Ja))]),default:t(()=>[x("div",is,[n[25]||(n[25]=x("span",null,"å…¨é€‰åº§ä½",-1)),x("span",rs,B(d("A","ctrl")),1)])]),_:1},8,["disabled"])],64))]),_:1})]),default:t(()=>[x("div",ss,[Oe(a.$slots,"default",{},void 0,!0)])]),_:3})}}}),Xs=Ve(Bs,[["__scopeId","data-v-2503c2eb"]]),Kt=30;function Zs(l,h,u,p){const s=[],d=Kt+l.seatSpacing,i=Kt+l.rowSpacing,c=l.seatsPerRow*d,k=l.rowCount*i,g=u-c/2,m=p-k/2;for(let r=0;r<l.rowCount;r++)for(let o=0;o<l.seatsPerRow;o++){const y=g+o*d,_=m+r*i,b={id:`seat_${Date.now()}_${r}_${o}`,x:y,y:_,floorId:h,rowLabel:String(l.startRow+r),seatLabel:String(l.startSeat+o),status:l.status||"available"};b.status==="disabled"&&l.disabledReason&&(b.disabledReason=l.disabledReason),s.push(b)}return s}function Gs(l,h=50){const u=E([{state:l,timestamp:Date.now(),description:"åˆå§‹çŠ¶æ€"}]),p=E(0),s=E(Date.now()),d=300,i=W(()=>u.value[p.value]?.state??l),c=(_,b)=>{const f=Date.now(),a=u.value[p.value]?.state??l,n=typeof _=="function"?_(a):_,S=f-s.value<d;s.value=f;const z=p.value;let $=u.value.slice(0,z+1);S&&$.length>1?$[$.length-1]={state:n,timestamp:f,description:b||$[$.length-1].description}:($.push({state:n,timestamp:f,description:b}),$.length>h?($=$.slice($.length-h),p.value=h-1):p.value=$.length-1),u.value=$},k=()=>{const _=Math.max(p.value-1,0);_!==p.value&&(p.value=_)},g=()=>{const _=Math.min(p.value+1,u.value.length-1);_!==p.value&&(p.value=_)},m=()=>{const _=u.value[p.value]?.state??l;u.value=[{state:_,timestamp:Date.now(),description:"åˆå§‹çŠ¶æ€"}],p.value=0},r=W(()=>p.value>0),o=W(()=>p.value<u.value.length-1),y=W(()=>u.value.length);return{state:i,setState:c,undo:k,redo:g,canUndo:r,canRedo:o,clearHistory:m,historySize:y}}function qs(l,h=0,u=150){const p=E({width:1200,height:700});let s=null,d=null;const i=(k,g,m=!1)=>{const r=Math.max(800,k-h*2),o=Math.max(600,g-h*2),y={width:r,height:o};if(m||u<=0){p.value=y;return}d!==null&&window.clearTimeout(d),d=window.setTimeout(()=>{p.value=y},u)},c=()=>{const k=l.value;if(!k||typeof ResizeObserver>"u")return;s=new ResizeObserver(m=>{const r=m[0];if(!r)return;const o=r.contentRect;i(o.width,o.height,!1)}),s.observe(k);const g=k.getBoundingClientRect();i(g.width,g.height,!0)};return Re(()=>{c()}),_e(()=>l.value,()=>{s&&(s.disconnect(),s=null),c()}),Qt(()=>{s&&(s.disconnect(),s=null),d!==null&&(window.clearTimeout(d),d=null)}),p}const ua=de({__name:"SeatMapEditor",props:{initialData:{}},emits:["change","ready"],setup(l,{emit:h}){const u=l,p=h,s=E([]),d=E([]),i=E([]),c=E(null),{state:k,setState:g,undo:m,redo:r,canUndo:o,canRedo:y}=Gs([],50),_=W(()=>k.value),b=E(void 0),f=E(""),a=E(!0),n=E([]),S=E(null),z=E(null),$=E(null),F=E({offsetX:0,offsetY:0,scale:1}),D=E(100),P=E(!1),A=E(!1),Z=E(!1),ne=E(!1),T=E(!1),L=E(null),H=E(!1),J=E(!1),ue=Qe({importVisible:!1}),pe=E(!1),G=qs($,0),se=W(()=>G.value.width),ae=W(()=>G.value.height),he=W(()=>{const C=_.value||[],R=C.length,j=C.filter(Q=>Q.status==="available").length,U=C.filter(Q=>Q.status==="disabled").length;return{total:R,available:j,disabled:U}}),ge=W(()=>(_.value||[]).filter(C=>C.floorId===f.value)),ee=W(()=>_.value.filter(C=>n.value.includes(C.id))),re=W(()=>s.value.find(C=>C.id===f.value)),ce=W(()=>({floorCount:s.value.length,totalSeats:he.value.total,availableSeats:he.value.available,unavailableSeats:he.value.disabled,selectedCount:n.value.length,zoneCount:d.value.length})),be=W(()=>{const C=u.initialData||{};return{id:C?.id||`theater-${Date.now()}`,name:C?.name||"æ–°å‰§åœº",floors:s.value,seats:_.value,stage:b.value,zones:d.value.length?d.value:C?.zones||[],metadata:C?.metadata}}),xe=W(()=>z.value?.getCanvas?.()??null),Te=E(!1);_e(()=>({width:se.value,height:ae.value}),({width:C,height:R})=>{C<=0||R<=0||(Te.value?F.value={...F.value,offsetX:C/2,offsetY:R/2}:(F.value={offsetX:C/2,offsetY:R/2,scale:1},Te.value=!0))},{immediate:!0});const Ze=()=>{const C=u.initialData||{},R={id:C?.id||`theater-${Date.now()}`,name:C?.name||"æ–°å‰§åœº",floors:s.value,seats:_.value,stage:b.value,zones:d.value.length?d.value:C?.zones||[],metadata:C?.metadata};p("change",R)};Re(()=>{const C=u.initialData||{},R=Array.isArray(C.floors)&&C.floors.length?C.floors:[{id:"F1",name:"1F",level:1}];s.value=R,g(C.seats||[],"åˆå§‹åŒ–åº§ä½"),b.value=C.stage,d.value=C.zones||[],f.value=R[0]?.id||"",Ze(),p("ready")}),_e([s,k,b,d],Ze,{deep:!0}),_e(()=>F.value.scale,C=>{D.value=Math.round(C*100)},{immediate:!0});const yt=C=>{F.value=C},gt=()=>{pe.value=!pe.value},X=()=>{P.value=!0},M=()=>{H.value=!0},K=(C,R)=>{const j=f.value,U=Zs({startRow:C.startRow,startSeat:C.startSeat,rowCount:C.rowCount,seatsPerRow:C.seatsPerRow,rowSpacing:C.rowSpacing,seatSpacing:C.seatSpacing,status:C.status,disabledReason:C.disabledReason},j,R.x,R.y);g(Q=>[...Q,...U],"æ‰¹é‡ç”Ÿæˆåº§ä½"),P.value=!1},le=()=>{P.value=!1},ie=C=>{n.value=C,C.length?C.length===1?S.value={type:"seat",id:C[0]}:S.value={type:"seats",ids:C}:S.value=null},ve=C=>{!b.value||b.value.id!==C||(n.value=[],S.value={type:"stage",id:C})},ye=(C,R,j)=>{g(U=>U.map(Q=>Q.id===C?{...Q,x:R,y:j}:Q),"ç§»åŠ¨åº§ä½")},me=C=>{const R=new Map(C.map(j=>[j.id,j]));g(j=>j.map(U=>{const Q=R.get(U.id);return Q?{...U,x:Q.x,y:Q.y}:U}),"æ‰¹é‡ç§»åŠ¨åº§ä½")},Ce=()=>{const C=Math.min(200,D.value+25);F.value={...F.value,scale:C/100}},ze=()=>{const C=Math.max(50,D.value-25);F.value={...F.value,scale:C/100}},Ge=C=>{const R=Math.min(200,Math.max(50,C));F.value={...F.value,scale:R/100}},Ye=C=>{a.value=C},qe=(C,R)=>{const j=n.value;j.length&&g(U=>U.map(Q=>j.includes(Q.id)?{...Q,status:C,disabledReason:C==="disabled"?R:void 0}:Q),"æ›´æ–°åº§ä½çŠ¶æ€")},De=()=>{const C=n.value;C.length&&(g(R=>R.filter(j=>!C.includes(j.id)),"åˆ é™¤åº§ä½"),n.value=[],S.value=null)},et=()=>{if(b.value){N.warning("å·²å­˜åœ¨èˆå°ï¼Œæ¯ä¸ªåœºé¦†åªèƒ½æœ‰ä¸€ä¸ªèˆå°");return}b.value={id:`stage_${Date.now()}`,name:"èˆå°æ–¹å‘",x:0,y:-250,width:480,height:40,shape:"trapezoid",color:"#dedede"}},tt=(C,R)=>{!b.value||b.value.id!==C||(b.value={...b.value,...R})},_t=(C,R,j)=>{tt(C,{x:R,y:j})},ot=C=>{!b.value||b.value.id!==C||(b.value=void 0,S.value?.type==="stage"&&(S.value=null))},Ee=C=>{const R=d.value.find(U=>U.id===C);if(!R)return;const j=n.value;j.length&&g(U=>U.map(Q=>j.includes(Q.id)?{...Q,zoneId:R.id,zoneName:R.name,zoneColor:R.color}:Q),"åˆ†é…åº§åŒº")},st=()=>{if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©åº§ä½");return}J.value=!0},it=C=>{const R=u.initialData||{},j={id:Pe("zone"),venueId:R?.id,floorId:f.value,...C};d.value=[...d.value,j],g(U=>U.map(Q=>n.value.includes(Q.id)?{...Q,zoneId:j.id,zoneName:j.name,zoneColor:j.color}:Q)),J.value=!1,N.success(`åº§åŒºã€Œ${j.name}ã€åˆ›å»ºæˆåŠŸï¼Œå·²åŒ…å« ${n.value.length} ä¸ªåº§ä½`)},te=(C,R)=>{d.value=d.value.map(j=>j.id===C?{...j,...R}:j)},fe=C=>{d.value=d.value.filter(R=>R.id!==C),g(R=>R.map(j=>j.zoneId===C?{...j,zoneId:void 0,zoneName:void 0,zoneColor:void 0}:j),"åˆ é™¤åº§åŒº")},Le=()=>{const C={id:Pe("floor"),name:`${s.value.length+1}F`,level:s.value.length+1};s.value=[...s.value,C],f.value=C.id,N.success(`å·²åˆ›å»ºæ–°æ¥¼å±‚ï¼š${C.name}`)},fa=C=>{if(s.value=[...C],Z.value=!1,N.success("æ¥¼å±‚ç®¡ç†å·²æ›´æ–°"),!C.find(R=>R.id===f.value)){const R=C[0];R&&(f.value=R.id)}},ma=C=>{if(!ee.value.length){ne.value=!1;return}const R=[...ee.value].sort((Fe,we)=>C.direction==="horizontal"?Math.abs(Fe.y-we.y)<10?Fe.x-we.x:Fe.y-we.y:Math.abs(Fe.x-we.x)<10?Fe.y-we.y:Fe.x-we.x);let j=C.startRowNumber,U=C.startSeatNumber;const Q=R[0];if(!Q){ne.value=!1;return}let Me=C.direction==="horizontal"?Q.y:Q.x;const $e=_.value.map(Fe=>{const we=R.find(Ra=>Ra.id===Fe.id);if(!we)return Fe;const ke=C.direction==="horizontal"?we.y:we.x;Math.abs(ke-Me)>=10&&(j+=C.rowIncrement,U=C.startSeatNumber,Me=ke);const $a={...Fe,rowLabel:String(j),seatLabel:String(U)};return U+=C.seatIncrement,$a});g($e,"é‡æ–°ç¼–å·åº§ä½"),ne.value=!1,N.success("åº§ä½ç¼–å·å·²æ›´æ–°")},Rt=C=>{if(n.value.length===1)L.value=ee.value[0];else{N.warning("è¯·é€‰æ‹©ä¸€ä¸ªåº§ä½è¿›è¡Œç¼–è¾‘");return}T.value=!0},va=C=>{if(!L.value)return;const R={...C};if(R.zoneId){const U=d.value.find(Q=>Q.id===R.zoneId);U&&(R.zoneName=U.name,R.zoneColor=U.color)}else R.zoneName=void 0,R.zoneColor=void 0;const j=_.value.map(U=>U.id===L.value?.id?{...U,...R}:U);g(j,"ç¼–è¾‘å•ä¸ªåº§ä½"),T.value=!1,L.value=null,N.success("åº§ä½å·²æ›´æ–°")},ya=C=>{const R=C;s.value=Array.isArray(R.floors)?R.floors:[],b.value=R.stage,d.value=Array.isArray(R.zones)?R.zones:[],f.value=R.floors[0]?.id||"",g(Array.isArray(R.seats)?R.seats:[],"å¯¼å…¥åº§ä½æ•°æ®"),ue.importVisible=!1,N.success("åº§ä½å›¾æ•°æ®å¯¼å…¥æˆåŠŸ")},Pe=C=>`${C}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,ga=C=>{C.length&&(g(R=>R.filter(j=>!C.includes(j.id)),"åˆ é™¤åº§ä½"),C.some(R=>n.value.includes(R))&&(n.value=[],S.value=null))},_a=C=>{if(!C.length)return;const R=_.value.filter(j=>C.includes(j.id)).map(j=>({...j}));i.value=R},zt=()=>{if(!i.value.length)return;const R=i.value.some(U=>!!U.groupId)?Pe("group"):void 0,j=i.value.map(U=>({...U,id:Pe("seat"),floorId:f.value,groupId:R,x:U.x+20,y:U.y+20}));g(U=>[...U,...j],"å¤åˆ¶åº§ä½"),n.value=j.map(U=>U.id),S.value=j.length===1?{type:"seat",id:j[0].id}:{type:"seats",ids:j.map(U=>U.id)}},ba=C=>{yt(C)},ha=async C=>{f.value=C,await new Promise(R=>setTimeout(R,0))},xa=(C,R)=>{c.value={x:C,y:R}},Dt=()=>{if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©è¦å¤åˆ¶çš„åº§ä½");return}const C=_.value.filter(R=>n.value.includes(R.id)).map(R=>({...R}));i.value=C,N.success(`å·²å¤åˆ¶ ${C.length} ä¸ªåº§ä½`)},Mt=()=>{if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©è¦å‰ªåˆ‡çš„åº§ä½");return}const C=_.value.filter(R=>n.value.includes(R.id)).map(R=>({...R}));i.value=C,g(R=>R.filter(j=>!n.value.includes(j.id)),"å‰ªåˆ‡åº§ä½"),n.value=[],S.value=null,N.success(`å·²å‰ªåˆ‡${C.length}ä¸ªåº§ä½`)},Ft=()=>{zt()},ka=()=>{if(!i.value.length){N.warning("å‰ªè´´æ¿ä¸ºç©º");return}if(!c.value){N.warning("æ— æ³•è·å–å¤åˆ¶ä½ç½®");return}const C=Math.min(...i.value.map(ke=>ke.x)),R=Math.min(...i.value.map(ke=>ke.y)),j=c.value.x,U=c.value.y,Q=j-C,Me=U-R,Fe=i.value.some(ke=>!!ke.groupId)?Pe("group"):void 0,we=i.value.map(ke=>({...ke,id:Pe("seat"),floorId:f.value,groupId:Fe,x:ke.x+Q,y:ke.y+Me}));g(ke=>[...ke,...we],"å¤åˆ¶åº§ä½åˆ°æŒ‡å®šä½ç½®"),n.value=we.map(ke=>ke.id),S.value=we.length===1?{type:"seat",id:we[0].id}:{type:"seats",ids:we.map(ke=>ke.id)},N.success(`å·²ç²˜è´´ ${we.length} ä¸ªåº§ä½åˆ°æŒ‡å®šä½ç½®`)},Et=C=>{if(ee.value.length<2){N.warning("è¯·è‡³å°‘é€‰æ‹© 2 ä¸ªåº§ä½è¿›è¡Œå¯¹é½");return}let R=[];switch(C){case"left":{const U=Math.min(...ee.value.map(Q=>Q.x));R=ee.value.map(Q=>({id:Q.id,x:U}));break}case"center":{const U=Math.min(...ee.value.map($e=>$e.x)),Q=Math.max(...ee.value.map($e=>$e.x)),Me=(U+Q)/2;R=ee.value.map($e=>({id:$e.id,x:Me-15}));break}case"right":{const U=Math.max(...ee.value.map(Q=>Q.x));R=ee.value.map(Q=>({id:Q.id,x:U}));break}case"top":{const U=Math.min(...ee.value.map(Q=>Q.y));R=ee.value.map(Q=>({id:Q.id,y:U}));break}case"middle":{const U=Math.min(...ee.value.map($e=>$e.y)),Q=Math.max(...ee.value.map($e=>$e.y)),Me=(U+Q)/2;R=ee.value.map($e=>({id:$e.id,y:Me}));break}case"bottom":{const U=Math.max(...ee.value.map(Q=>Q.y));R=ee.value.map(Q=>({id:Q.id,y:U}));break}}const j=_.value.map(U=>{const Q=R.find(Me=>Me.id===U.id);return Q?{...U,x:Q.x??U.x,y:Q.y??U.y}:U});g(j,"ç²˜è´´åº§ä½"),N.success("å·²å¯¹é½åº§ä½")},Lt=()=>{if(n.value.length<2){N.warning("è¯·è‡³å°‘é€‰æ‹© 2 ä¸ªåº§ä½è¿›è¡Œæˆç»„");return}const C=Pe("group");g(R=>R.map(j=>n.value.includes(j.id)?{...j,groupId:C}:j)),N.success(`å·²æˆç»„ ${n.value.length} ä¸ªåº§ä½`)},Nt=()=>{if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©åº§ä½");return}g(C=>C.map(R=>n.value.includes(R.id)?{...R,groupId:void 0}:R)),N.success(`å·²å–æ¶ˆæˆç»„ ${n.value.length} ä¸ªåº§ä½`)},Ot=()=>{if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©åº§ä½");return}g(C=>C.map(R=>n.value.includes(R.id)?{...R,locked:!0}:R)),N.success(`å·²é”å®š ${n.value.length} ä¸ªåº§ä½`)},Pt=()=>{if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©åº§ä½");return}g(C=>C.map(R=>n.value.includes(R.id)?{...R,locked:!1}:R)),N.success(`å·²è§£é” ${n.value.length} ä¸ªåº§ä½`)},Ut=()=>{if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©è¦å¤åˆ¶çš„åº§ä½");return}const R=ee.value.some(U=>!!U.groupId)?Pe("group"):void 0,j=ee.value.map(U=>({...U,id:Pe("seat"),groupId:R,x:U.x+30,y:U.y+30}));g(U=>[...U,...j]),n.value=j.map(U=>U.id),N.success(`å·²å¿«é€Ÿå¤åˆ¶ ${j.length} ä¸ªåº§ä½`)},At=()=>{const C=ge.value.map(R=>R.id);n.value=C,S.value=C.length>0?{type:"seats",ids:C}:null,N.success(`å·²é€‰ä¸­ ${C.length} ä¸ªåº§ä½`)},wa=C=>{Ee(C)},Sa=()=>{if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©åº§ä½");return}g(C=>C.map(R=>n.value.includes(R.id)?{...R,zoneId:void 0,zoneName:void 0,zoneColor:void 0}:R)),N.success("å·²ä»åº§åŒºç§»é™¤é€‰ä¸­åº§ä½")},Ca=()=>{n.value=[]},Ia=()=>{F.value={offsetX:se.value/2,offsetY:ae.value/2,scale:1},N.success("å·²é‡ç½®è§†å›¾")},Ta=C=>{const R=C.target,j=R.tagName==="INPUT"||R.tagName==="TEXTAREA"||R.isContentEditable;if(j&&C.key!=="Escape")return;const U=C.ctrlKey||C.metaKey;if((C.key==="Delete"||C.key==="Backspace")&&!j){if(C.preventDefault(),!S.value){N.warning("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„å¯¹è±¡");return}if(S.value.type==="stage"){if(!b.value){N.warning("æ²¡æœ‰å¯åˆ é™¤çš„èˆå°");return}ot(S.value.id);return}if(S.value.type==="seat"||S.value.type==="seats"){if(!n.value.length){N.warning("è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„åº§ä½");return}De();return}N.warning("è¯¥å¯¹è±¡ä¸æ”¯æŒåˆ é™¤");return}if(C.key==="Escape"){C.preventDefault(),Ca();return}if(C.key==="a"&&U&&!C.shiftKey){C.preventDefault(),At();return}if(C.key==="c"&&U&&!C.shiftKey){C.preventDefault(),Dt();return}if(C.key==="x"&&U&&!C.shiftKey){C.preventDefault(),Mt();return}if(C.key==="v"&&U&&!C.shiftKey){C.preventDefault(),Ft();return}if(C.key==="d"&&U&&!C.shiftKey){C.preventDefault(),Ut();return}if(C.key==="z"&&U&&!C.shiftKey&&o.value){C.preventDefault(),m();return}if((C.key==="z"&&C.shiftKey||C.key==="y")&&U&&y.value){C.preventDefault(),r();return}if(C.key==="Enter"&&!j&&n.value.length===1){C.preventDefault(),Rt();return}if(C.altKey&&!U&&!C.shiftKey&&!j){const Me={a:"left",d:"right",h:"center",w:"top",s:"bottom",v:"middle"}[C.key];if(Me){C.preventDefault(),Et(Me);return}}if((C.key==="="||C.key==="+")&&U&&!C.shiftKey){C.preventDefault(),Ce();return}if(C.key==="-"&&U&&!C.shiftKey){C.preventDefault(),ze();return}if(C.key==="0"&&U&&!C.shiftKey){C.preventDefault(),Ia();return}if(C.key==="g"&&U&&!C.shiftKey){C.preventDefault(),Lt();return}if(C.key==="g"&&U&&C.shiftKey){C.preventDefault(),Nt();return}if(C.key==="l"&&U&&!C.shiftKey){C.preventDefault(),Ot();return}if(C.key==="l"&&U&&C.shiftKey){C.preventDefault(),Pt();return}if(C.key==="e"&&U&&!C.shiftKey){C.preventDefault(),M();return}if(C.key==="r"&&U&&!C.shiftKey){C.preventDefault(),ne.value=!0;return}if(C.key==="n"&&U&&C.shiftKey){C.preventDefault(),Le();return}C.key==="?"&&(C.preventDefault(),A.value=!0)};return Re(()=>{window.addEventListener("keydown",Ta)}),(C,R)=>{const j=w("a-modal");return I(),O(oe,null,[e(Un,{"is-in-modal":!0,"is-fullscreen":pe.value},{header:t(()=>[e(Xn,{"theater-name":u.initialData?.name||"åº§ä½å›¾ç¼–è¾‘å™¨","can-undo":Y(o),"can-redo":Y(y),"is-fullscreen":pe.value,"show-seat-labels":a.value,"zoom-level":D.value,onBatchGenerate:X,onAddStage:et,onToggleSeatLabels:Ye,onZoomIn:Ce,onZoomOut:ze,onZoomChange:Ge,onImport:R[0]||(R[0]=()=>ue.importVisible=!0),onExport:M,onUndo:Y(m),onRedo:Y(r),onShowShortcuts:R[1]||(R[1]=U=>A.value=!0),onToggleFullscreen:gt},null,8,["theater-name","can-undo","can-redo","is-fullscreen","show-seat-labels","zoom-level","onUndo","onRedo"])]),left:t(()=>[e(To,{floors:s.value,"active-floor-id":f.value,seats:_.value,zones:d.value,onFloorChange:R[2]||(R[2]=U=>f.value=U),onNewFloor:Le,onManageFloors:R[3]||(R[3]=U=>Z.value=!0)},null,8,["floors","active-floor-id","seats","zones"])]),canvas:t(()=>[e(Xs,{"selected-element":S.value,"selected-seats":ee.value,"has-clipboard":i.value.length>0,"has-seats":ge.value.length>0,zones:d.value.filter(U=>U.floorId===f.value),onCopy:Dt,onCut:Mt,onPaste:Ft,onPasteHere:ka,onDuplicate:Ut,onDelete:De,onAlign:Et,onLock:Ot,onUnlock:Pt,onGroup:Lt,onUngroup:Nt,onEdit:R[4]||(R[4]=()=>Rt()),onRenumber:R[5]||(R[5]=()=>ne.value=!0),onCreateZone:st,onAssignZone:wa,onRemoveZone:Sa,onSelectAll:At},{default:t(()=>[x("div",{ref_key:"canvasContainerRef",ref:$,style:{flex:"1",display:"flex"}},[e(ro,{ref_key:"canvasCompRef",ref:z,seats:ge.value,stage:b.value,"selected-seat-ids":n.value,"selected-element":S.value,width:se.value,height:ae.value,"show-grid":!0,"enable-snap":!0,"show-seat-labels":a.value,viewport:F.value,onSeatSelect:ie,onSeatMove:ye,onSeatsMove:me,onStageSelect:ve,onStageMove:_t,onViewportChange:ba,onSeatsDelete:ga,onSeatsCopy:_a,onSeatsPaste:zt,onContextMenu:xa},null,8,["seats","stage","selected-seat-ids","selected-element","width","height","show-seat-labels","viewport"])],512)]),_:1},8,["selected-element","selected-seats","has-clipboard","has-seats","zones"])]),right:t(()=>[e(Vl,{"selected-element":S.value,floor:re.value,"selected-seats":ee.value,"selected-stage":S.value?.type==="stage"?b.value:void 0,zones:d.value,stage:b.value,seats:_.value,"venue-id":u.initialData?.id||"","current-floor-id":f.value,onUpdateSeatStatus:qe,onDeleteSeats:De,onCreateZone:st,onAssignToZone:Ee,onUpdateStage:tt,onDeleteStage:ot,onAddStage:et,onUpdateZone:te,onDeleteZone:fe},null,8,["selected-element","floor","selected-seats","selected-stage","zones","stage","seats","venue-id","current-floor-id"])]),footer:t(()=>[e(co,{statistics:ce.value,"current-floor-name":re.value?.name,"zoom-level":D.value,onShowShortcuts:R[6]||(R[6]=U=>A.value=!0)},null,8,["statistics","current-floor-name","zoom-level"])]),_:1},8,["is-fullscreen"]),e(Gn,{visible:P.value,"start-position":{x:0,y:50},onOk:K,onCancel:le},null,8,["visible"]),e(xo,{visible:A.value,onClose:R[7]||(R[7]=U=>A.value=!1)},null,8,["visible"]),e(Mo,{visible:Z.value,floors:s.value,onOk:fa,onCancel:R[8]||(R[8]=U=>Z.value=!1)},null,8,["visible","floors"]),e(Fo,{visible:ne.value,seats:ee.value,onOk:ma,onCancel:R[9]||(R[9]=U=>ne.value=!1)},null,8,["visible","seats"]),L.value?(I(),V(Eo,{key:0,visible:T.value,seat:L.value,zones:d.value,"existing-seats":_.value,onOk:va,onCancel:R[10]||(R[10]=()=>{T.value=!1,L.value=null})},null,8,["visible","seat","zones","existing-seats"])):q("",!0),e(Yo,{visible:ue.importVisible,onImport:ya,onClose:R[11]||(R[11]=()=>ue.importVisible=!1)},null,8,["visible"]),e(oa,{visible:J.value,"venue-id":u.initialData?.id||"","floor-id":f.value,"existing-zones":d.value.filter(U=>U.floorId===f.value),onOk:it,onCancel:R[12]||(R[12]=()=>J.value=!1)},null,8,["visible","venue-id","floor-id","existing-zones"]),e(j,{open:H.value,"onUpdate:open":R[13]||(R[13]=U=>H.value=U),title:"å¯¼å‡ºåº§ä½å›¾",footer:null,width:600,centered:"","destroy-on-close":""},{default:t(()=>[e(os,{"theater-data":be.value,"canvas-ref":xe.value,"current-floor-id":f.value,"render-floor":ha},null,8,["theater-data","canvas-ref","current-floor-id"])]),_:1},8,["open"])],64)}}}),js={key:0,class:"seat-map-editor-stats"},Hs=de({__name:"SeatMapEditorModal",props:{initialData:{},buttonText:{default:"ç¼–è¾‘åº§ä½å›¾"},buttonType:{default:"dashed"},showStats:{type:Boolean,default:!0}},emits:["change"],setup(l,{emit:h}){const u=l,p=h,s=E(!1),d=E(!1),i=E(),c=E(!1),k=()=>{d.value=!0,s.value=!0,i.value=u.initialData||void 0,c.value=!1},g=()=>{s.value=!1,i.value=void 0,c.value=!1},m=()=>{c.value?nt.confirm({title:"æœ‰æœªä¿å­˜çš„ä¿®æ”¹",icon:e(pn),content:"åº§ä½å›¾ç¼–è¾‘å™¨æœ‰æœªä¿å­˜çš„ä¿®æ”¹ï¼Œå…³é—­åå°†ä¸¢å¤±æ‰€æœ‰æ›´æ”¹ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ",okText:"ç¡®å®šå…³é—­",okButtonProps:{danger:!0},cancelText:"å–æ¶ˆ",centered:!0,onOk:()=>{g()}}):g()},r=()=>{if(!i.value){N.warning("æ²¡æœ‰æ•°æ®éœ€è¦ä¿å­˜");return}const _=En(i.value);if(!_.success){const b=_.errors||[];if(b.length===1){const f=b[0];f&&N.error(f.message)}else if(b.length>1){const f=b.map((a,n)=>`${n+1}. ${a.message}`).join(`
`);nt.error({title:"åº§ä½å›¾æ•°æ®æ ¡éªŒå¤±è´¥",content:f,okText:"æˆ‘çŸ¥é“äº†",centered:!0})}return}p("change",i.value),c.value=!1,s.value=!1,N.success("åº§ä½å›¾ä¿å­˜æˆåŠŸ")},o=_=>{i.value=_,c.value=!0},y=W(()=>{const _=i.value||u.initialData;if(!_||!Array.isArray(_?.seats))return null;const b=_.seats.length,f=_.seats.filter(a=>a.status==="available").length;return{totalSeats:b,availableSeats:f}});return(_,b)=>{const f=w("a-button"),a=w("a-spin"),n=w("a-modal");return I(),O(oe,null,[e(f,{type:l.buttonType,block:"",size:"large",class:"seat-map-editor-trigger-button",onClick:k},{icon:t(()=>[e(Y(ct))]),default:t(()=>[x("div",null,[x("div",null,B(l.buttonText),1),l.showStats&&y.value&&y.value.totalSeats>0?(I(),O("div",js," å·²è®¾ç½® "+B(y.value.totalSeats)+" ä¸ªåº§ä½ï½œå¯å– "+B(y.value.availableSeats)+" ä¸ª ",1)):q("",!0)])]),_:1},8,["type"]),e(n,{title:"åº§ä½å›¾ç¼–è¾‘å™¨",open:s.value,keyboard:!1,"mask-closable":!1,width:"100%","wrap-class-name":"seat-map-editor-modal-fullscreen","ok-text":"å®Œæˆ","cancel-text":"å–æ¶ˆ","destroy-on-close":"",onOk:r,onCancel:m},{default:t(()=>[e(a,{spinning:d.value},{default:t(()=>[e(ua,{"initial-data":l.initialData,onChange:o,onReady:b[0]||(b[0]=S=>d.value=!1)},null,8,["initial-data"])]),_:1},8,["spinning"])]),_:1},8,["open"])],64)}}}),Ks={style:{"margin-bottom":"24px"}},Ws={class:"venue-form__two-columns"},Js={style:{"margin-bottom":"24px"}},Qs={key:1},ei={class:"venue-form__zone-header"},ti={key:2},ai=de({__name:"VenueForm",props:{initialValues:{},isEdit:{type:Boolean}},emits:["submit"],setup(l,{expose:h,emit:u}){const p=l,s=u,d=E(),i=E({name:"",type:void 0,scenicId:void 0,address:"",description:"",capacityType:"free_seating",totalCapacity:void 0,zones:[],preciseSeats:void 0}),c=E([]),k=E("free_seating"),g=E();_e(()=>p.initialValues,b=>{b&&(i.value={...i.value,...b,capacityType:b.capacityType||"free_seating"},c.value=(b.zones||[]).map((f,a)=>({...f,sort:f.sort??a+1})),k.value=i.value.capacityType,g.value=b.preciseSeats)},{immediate:!0}),Re(()=>{p.initialValues&&(c.value=(p.initialValues.zones||[]).map((b,f)=>({...b,sort:b.sort??f+1})),k.value=i.value.capacityType,g.value=p.initialValues.preciseSeats)}),_e(k,b=>{i.value.capacityType=b});const m=b=>{g.value=b,i.value.preciseSeats=b},r=()=>{const b=c.value||[],f=[...b,{name:"",capacity:0,sort:b.length+1}];c.value=f,i.value.zones=f},o=b=>{const a=(c.value||[]).filter((n,S)=>S!==b);c.value=a,i.value.zones=a},y=(b,f,a)=>{const S=[...c.value||[]];S[b]={...S[b],[f]:a},c.value=S,i.value.zones=S};return h({submit:async()=>{if(d.value){if(await d.value.validate(),i.value.capacityType==="zone_capacity"){const b=c.value||[];if(!b.length){N.error("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªåº§åŒº");return}if(b.some(n=>!n.name||!n.name.trim())){N.error("è¯·å¡«å†™æ‰€æœ‰åº§åŒºçš„åç§°");return}if(b.some(n=>!n.capacity||n.capacity<=0)){N.error("è¯·å¡«å†™æ‰€æœ‰åº§åŒºçš„å®¹é‡ï¼Œä¸”å®¹é‡å¿…é¡»å¤§äº 0");return}}if(i.value.capacityType==="precise_seat"){const b=g.value;if(!b||!Array.isArray(b.floors)||b.floors.length===0){N.error("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæ¥¼å±‚");return}if(!Array.isArray(b.seats)||b.seats.length===0){N.error("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªåº§ä½");return}}s("submit",{...i.value,zones:c.value,preciseSeats:g.value})}}}),(b,f)=>{const a=w("a-typography-title"),n=w("a-input"),S=w("a-form-item"),z=w("a-select-option"),$=w("a-select"),F=w("a-textarea"),D=w("a-radio"),P=w("a-radio-group"),A=w("a-input-number"),Z=w("a-typography-text"),ne=w("a-space"),T=w("a-button"),L=w("a-table-column"),H=w("a-popconfirm"),J=w("a-table"),ue=w("a-empty"),pe=w("a-form");return I(),V(pe,{ref_key:"formRef",ref:d,model:i.value,layout:"vertical"},{default:t(()=>[x("div",Ks,[e(a,{level:5,style:{"margin-bottom":"16px"}},{default:t(()=>[...f[6]||(f[6]=[v(" åŸºç¡€ä¿¡æ¯ ",-1)])]),_:1}),x("div",Ws,[e(S,{label:"åœºé¦†åç§°",name:"name",rules:[{required:!0,message:"è¯·è¾“å…¥åœºé¦†åç§°"}]},{default:t(()=>[e(n,{value:i.value.name,"onUpdate:value":f[0]||(f[0]=G=>i.value.name=G),placeholder:"è¯·è¾“å…¥åœºé¦†åç§°",maxlength:50},null,8,["value"])]),_:1}),e(S,{label:"åœºé¦†ç±»å‹",name:"type"},{default:t(()=>[e($,{value:i.value.type,"onUpdate:value":f[1]||(f[1]=G=>i.value.type=G),placeholder:"è¯·é€‰æ‹©","allow-clear":""},{default:t(()=>[e(z,{value:"indoor_theater"},{default:t(()=>[...f[7]||(f[7]=[v("å®¤å†…å‰§åœº",-1)])]),_:1}),e(z,{value:"outdoor_scene"},{default:t(()=>[...f[8]||(f[8]=[v("å®¤å¤–å®æ™¯",-1)])]),_:1}),e(z,{value:"multifunctional"},{default:t(()=>[...f[9]||(f[9]=[v("å¤šåŠŸèƒ½å…",-1)])]),_:1}),e(z,{value:"other"},{default:t(()=>[...f[10]||(f[10]=[v("å…¶ä»–",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),e(S,{label:"åœºé¦†åœ°å€",name:"address"},{default:t(()=>[e(n,{value:i.value.address,"onUpdate:value":f[2]||(f[2]=G=>i.value.address=G),placeholder:"è¯·è¾“å…¥åœºé¦†åœ°å€",maxlength:200},null,8,["value"])]),_:1}),e(S,{label:"åœºé¦†ç®€ä»‹",name:"description"},{default:t(()=>[e(F,{value:i.value.description,"onUpdate:value":f[3]||(f[3]=G=>i.value.description=G),placeholder:"ç®€è¦æè¿°åœºé¦†çš„ç‰¹ç‚¹ã€è®¾æ–½ã€é€‚ç”¨åœºæ™¯ç­‰",rows:4,maxlength:500,"show-count":""},null,8,["value"])]),_:1})]),x("div",Js,[e(a,{level:5,style:{"margin-bottom":"16px"}},{default:t(()=>[...f[11]||(f[11]=[v(" å®¹é‡é…ç½® ",-1)])]),_:1}),e(S,{label:"å®¹é‡ç±»å‹",name:"capacityType",rules:[{required:!0,message:"è¯·é€‰æ‹©å®¹é‡ç±»å‹"}]},{default:t(()=>[e(P,{value:k.value,"onUpdate:value":f[4]||(f[4]=G=>k.value=G),disabled:p.isEdit},{default:t(()=>[e(D,{value:"free_seating"},{default:t(()=>[...f[12]||(f[12]=[v("è‡ªç”±ç«™å¸­",-1)])]),_:1}),e(D,{value:"zone_capacity"},{default:t(()=>[...f[13]||(f[13]=[v("æŒ‰åº§åŒºæ•°é‡",-1)])]),_:1}),e(D,{value:"precise_seat"},{default:t(()=>[...f[14]||(f[14]=[v("ç²¾ç¡®åº§ä½",-1)])]),_:1})]),_:1},8,["value","disabled"])]),_:1}),k.value==="free_seating"?(I(),V(S,{key:0,label:"æ€»å®¹é‡",name:"totalCapacity",rules:[{required:!0,message:"è¯·è¾“å…¥æ€»å®¹é‡"},{type:"number",min:1,message:"æ€»å®¹é‡å¿…é¡»å¤§äº 0"}]},{default:t(()=>[e(A,{value:i.value.totalCapacity,"onUpdate:value":f[5]||(f[5]=G=>i.value.totalCapacity=G),placeholder:"è¯·è¾“å…¥æ€»å®¹é‡",min:1,max:999999,style:{width:"100%"}},{addonAfter:t(()=>[...f[15]||(f[15]=[v("äºº",-1)])]),_:1},8,["value"])]),_:1})):k.value==="zone_capacity"?(I(),O("div",Qs,[x("div",ei,[e(ne,null,{default:t(()=>[e(Z,{type:"secondary"},{default:t(()=>[v(" å·²æ·»åŠ  "+B(c.value?.length||0)+" ä¸ªåº§åŒº ",1)]),_:1}),c.value&&c.value.length?(I(),O(oe,{key:0},[e(Z,{type:"secondary"},{default:t(()=>[...f[16]||(f[16]=[v(" ï¼Œæ€»å®¹é‡ï¼š ",-1)])]),_:1}),e(Z,{strong:""},{default:t(()=>[v(B((c.value||[]).reduce((G,se)=>G+(se.capacity||0),0))+" äºº ",1)]),_:1})],64)):q("",!0)]),_:1}),e(T,{type:"dashed",onClick:r},{default:t(()=>[...f[17]||(f[17]=[v(" æ·»åŠ åº§åŒº ",-1)])]),_:1})]),c.value&&c.value.length?(I(),V(J,{key:0,"data-source":c.value,pagination:!1,"row-key":(G,se)=>String(se),scroll:{y:400}},{default:t(()=>[e(L,{key:"name","data-index":"name",width:"40%"},{title:t(()=>[...f[18]||(f[18]=[x("span",{style:{color:"#ff4d4f"}},"*",-1),x("span",{style:{"margin-left":"4px"}},"åº§åŒºåç§°",-1)])]),default:t(({text:G,index:se})=>[e(n,{value:G,placeholder:"è¯·è¾“å…¥åº§åŒºåç§°",maxlength:20,onChange:ae=>y(se,"name",ae.target.value)},null,8,["value","onChange"])]),_:1}),e(L,{key:"capacity","data-index":"capacity",width:"40%"},{title:t(()=>[...f[19]||(f[19]=[x("span",{style:{color:"#ff4d4f"}},"*",-1),x("span",{style:{"margin-left":"4px"}},"å®¹é‡ï¼ˆäººï¼‰",-1)])]),default:t(({text:G,index:se})=>[e(A,{value:G,placeholder:"è¯·è¾“å…¥å®¹é‡",min:1,max:99999,style:{width:"100%"},onChange:ae=>y(se,"capacity",ae||0)},null,8,["value","onChange"])]),_:1}),e(L,{key:"actions",title:"æ“ä½œ",width:80,align:"right"},{default:t(({index:G})=>[e(H,{title:"ç¡®è®¤åˆ é™¤è¯¥åº§åŒºå—ï¼Ÿ","ok-text":"ç¡®è®¤","cancel-text":"å–æ¶ˆ",onConfirm:()=>o(G)},{default:t(()=>[e(T,{type:"link",size:"small"},{default:t(()=>[...f[20]||(f[20]=[v(" åˆ é™¤ ",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data-source","row-key"])):(I(),V(ue,{key:1,description:"æš‚æ— åº§åŒºï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹â€œæ·»åŠ åº§åŒºâ€æŒ‰é’®æ·»åŠ "}))])):k.value==="precise_seat"?(I(),O("div",ti,[e(Hs,{"initial-data":g.value,onChange:m},null,8,["initial-data"])])):q("",!0)])]),_:1},8,["model"])}}}),da=Ve(ai,[["__scopeId","data-v-1be64559"]]),ni={style:{"max-width":"896px"}},vr=de({__name:"VenueCreate",setup(l){const h=Xe(),u=E(!1),p=E(null),s=async d=>{try{u.value=!0;let i;if(d.capacityType==="free_seating")i={name:d.name,type:d.type,scenicId:d.scenicId,address:d.address,description:d.description,capacityType:"free_seating",totalCapacity:d.totalCapacity||0};else if(d.capacityType==="zone_capacity")i={name:d.name,type:d.type,scenicId:d.scenicId,address:d.address,description:d.description,capacityType:"zone_capacity",zones:(d.zones||[]).map((c,k)=>({name:c.name,capacity:c.capacity,sort:k+1}))};else{const c=d.preciseSeats;if(!c||!c.zones||!c.seats)throw new Error("è¯·å…ˆé…ç½®åº§ä½å›¾");i={name:d.name,type:d.type,scenicId:d.scenicId,address:d.address,description:d.description,capacityType:"precise_seat",zones:c.zones.map((k,g)=>({name:k.name,shortName:k.shortName,color:k.color,floor:c.floors.find(m=>m.id===k.floorId)?.name,rows:k,seatsPerRow:void 0})),seats:c.seats.map(k=>({zoneId:k.zoneId||"",rowLabel:k.rowLabel,seatLabel:k.seatLabel,status:k.status,label:k.label,x:k.x,y:k.y}))}}await fn(i),N.success("åˆ›å»ºåœºé¦†æˆåŠŸ"),h.push("/dashboard/theater/venues")}catch(i){i&&i.message&&N.error(i.message),console.error(i)}finally{u.value=!1}};return(d,i)=>{const c=w("a-button");return I(),V(vt,null,{footer:t(()=>[e(c,{onClick:i[0]||(i[0]=k=>Y(h).push("/dashboard/theater/venues"))},{default:t(()=>[...i[2]||(i[2]=[v("å–æ¶ˆ",-1)])]),_:1}),e(c,{type:"primary",loading:u.value,onClick:i[1]||(i[1]=k=>p.value?.submit())},{default:t(()=>[...i[3]||(i[3]=[v(" åˆ›å»º ",-1)])]),_:1},8,["loading"])]),default:t(()=>[x("div",ni,[e(da,{ref_key:"formRef",ref:p,onSubmit:s},null,512)])]),_:1})}}});async function li(l){return lt(`/theater/venues/${l}/lock-status`)}async function oi(l){return $t("/theater/venues/copy",l)}const si={key:0,style:{"margin-bottom":"16px"}},ii={key:0},ri={key:1},ui={key:2},di={style:{color:"#8c8c8c","font-size":"12px"}},ci={key:3},pi=de({__name:"VenueLockAlert",props:{lockStatus:{},showCopyButton:{type:Boolean,default:!0}},emits:["copy"],setup(l,{emit:h}){const u=l,p=h,s=W(()=>u.lockStatus?.isLocked);return(d,i)=>{const c=w("a-button"),k=w("a-space"),g=w("a-alert");return s.value?(I(),O("div",si,[e(g,{type:"warning","show-icon":""},{icon:t(()=>[e(Y(ta))]),message:t(()=>[...i[1]||(i[1]=[v(" åº§ä½ç»“æ„å·²é”å®š ",-1)])]),description:t(()=>[e(k,{direction:"vertical",size:8,style:{width:"100%"}},{default:t(()=>[l.lockStatus.lockReason==="has_orders"?(I(),O("div",ii,[i[2]||(i[2]=v(" è¯¥åœºé¦†å·²äº§ç”Ÿ ",-1)),x("strong",null,B(l.lockStatus.totalOrders),1),i[3]||(i[3]=v(" ä¸ªè®¢å•ï¼Œåº§ä½ç»“æ„å·²è¢«é”å®šã€‚ä¸ºäº†ä¿éšœå·²è´­ç¥¨ç”¨æˆ·çš„æƒç›Šï¼Œç¦æ­¢è¿›è¡Œç»“æ„æ€§ä¿®æ”¹ï¼ˆå¦‚å¢åˆ åº§ä½ã€è°ƒæ•´åº§ä½åæ ‡ï¼‰ã€‚ ",-1))])):l.lockStatus.lockReason==="has_referenced_shows"?(I(),O("div",ri," è¯¥åœºé¦†å·²è¢«å¤šä¸ªæ¼”å‡ºå¼•ç”¨ï¼Œåº§ä½ç»“æ„å·²è¢«é”å®šã€‚ä¸ºäº†ä¿éšœæ¼”å‡ºæ’æœŸä¸åº§ä½æ•°æ®ä¸€è‡´ï¼Œç¦æ­¢è¿›è¡Œç»“æ„æ€§ä¿®æ”¹ã€‚ ")):(I(),O("div",ui," è¯¥åœºé¦†çš„åº§ä½ç»“æ„å·²è¢«é”å®šï¼Œç¦æ­¢è¿›è¡Œå¢åˆ åº§ä½ã€è°ƒæ•´åº§ä½åæ ‡ç­‰ç»“æ„æ€§ä¿®æ”¹ã€‚ ")),x("div",di,[e(Y(It),{style:{"margin-right":"4px"}}),i[4]||(i[4]=v(" ä»å…è®¸è¿›è¡Œå±•ç¤ºçº§è°ƒæ•´ï¼šå¦‚åº§ä½æ ‡ç­¾ã€åº§åŒºé¢œè‰²ç­‰ã€‚ ",-1))]),l.showCopyButton?(I(),O("div",ci,[e(c,{type:"primary",size:"small",onClick:i[0]||(i[0]=m=>p("copy"))},{icon:t(()=>[e(Y(ut))]),default:t(()=>[i[5]||(i[5]=v(" å¤åˆ¶åœºé¦†åˆ›å»ºæ–°ç‰ˆæœ¬ ",-1))]),_:1})])):q("",!0)]),_:1})]),_:1})])):q("",!0)}}}),fi=de({__name:"CopyVenueModal",props:{sourceVenueId:{},sourceVenueName:{},open:{type:Boolean}},emits:["close","success"],setup(l,{emit:h}){const u=l,p=h,s=E(),d=Qe({newVenueName:"",copySeatData:!0}),i=E(!1);_e(()=>u.open,g=>{g&&(d.newVenueName=u.sourceVenueName?`${u.sourceVenueName} - å‰¯æœ¬`:"",d.copySeatData=!0)});const c=()=>{const g=s.value;g?.resetFields&&g.resetFields(),p("close")},k=async()=>{const g=s.value;if(g)try{const m=await g.validate();i.value=!0;const r={sourceVenueId:u.sourceVenueId,newVenueName:m.newVenueName,copySeatData:m.copySeatData},o=await oi(r);N.success(`åœºé¦†å¤åˆ¶æˆåŠŸï¼æ–°åœºé¦† IDï¼š${o.newVenueId}`),p("success",o.newVenueId),c()}catch(m){if(m&&m.errorFields)return;console.error("å¤åˆ¶åœºé¦†å¤±è´¥:",m),N.error("å¤åˆ¶åœºé¦†å¤±è´¥")}finally{i.value=!1}};return(g,m)=>{const r=w("a-space"),o=w("a-alert"),y=w("a-input"),_=w("a-form-item"),b=w("a-checkbox"),f=w("a-form"),a=w("a-modal");return I(),V(a,{title:"å¤åˆ¶åœºé¦†",open:l.open,"confirm-loading":i.value,centered:"",width:500,onOk:k,onCancel:c},{default:t(()=>[e(r,{direction:"vertical",size:16,style:{width:"100%"}},{default:t(()=>[e(o,{type:"info","show-icon":""},{icon:t(()=>[e(Y(It))]),message:t(()=>[...m[2]||(m[2]=[v(" å¤åˆ¶åœºé¦†è¯´æ˜ ",-1)])]),description:t(()=>[e(r,{direction:"vertical",size:4},{default:t(()=>[...m[3]||(m[3]=[x("div",null,"Â· å¤åˆ¶å°†åˆ›å»ºä¸€ä¸ªæ–°çš„åœºé¦†ï¼ŒåŒ…å«ä¸åŸåœºé¦†ç›¸åŒçš„åŸºç¡€ä¿¡æ¯ã€‚",-1),x("div",null,"Â· å¯ä»¥é€‰æ‹©æ˜¯å¦å¤åˆ¶åº§ä½æ•°æ®ï¼ˆåº§ä½åæ ‡ã€åº§åŒºã€æ¥¼å±‚ç­‰ï¼‰ã€‚",-1),x("div",null,"Â· å¤åˆ¶åçš„åœºé¦†ä¸ä¼šç»§æ‰¿åŸåœºé¦†çš„è®¢å•å’Œæ¼”å‡ºå…³è”ã€‚",-1)])]),_:1})]),_:1}),e(f,{ref_key:"formRef",ref:s,model:d,layout:"vertical"},{default:t(()=>[e(_,{label:"æºåœºé¦†",tooltip:"è¦å¤åˆ¶çš„åœºé¦†"},{default:t(()=>[e(y,{value:l.sourceVenueName,disabled:""},null,8,["value"])]),_:1}),e(_,{label:"æ–°åœºé¦†åç§°",name:"newVenueName",rules:[{required:!0,message:"è¯·è¾“å…¥æ–°åœºé¦†åç§°"},{min:2,message:"åœºé¦†åç§°è‡³å°‘ 2 ä¸ªå­—ç¬¦"},{max:50,message:"åœºé¦†åç§°æœ€å¤š 50 ä¸ªå­—ç¬¦"}]},{default:t(()=>[e(y,{value:d.newVenueName,"onUpdate:value":m[0]||(m[0]=n=>d.newVenueName=n),placeholder:"è¯·è¾“å…¥æ–°åœºé¦†åç§°"},null,8,["value"])]),_:1}),e(_,{name:"copySeatData","value-prop-name":"checked"},{default:t(()=>[e(b,{checked:d.copySeatData,"onUpdate:checked":m[1]||(m[1]=n=>d.copySeatData=n)},{default:t(()=>[...m[4]||(m[4]=[v(" å¤åˆ¶åº§ä½æ•°æ®ï¼ˆåŒ…æ‹¬åº§ä½åæ ‡ã€åº§åŒºã€æ¥¼å±‚ç­‰ï¼‰ ",-1)])]),_:1},8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["open","confirm-loading"])}}}),mi={style:{"max-width":"896px"}},yr=de({__name:"VenueEdit",setup(l){const h=Tt(),u=Xe(),p=E(!0),s=E(!1),d=E(void 0),i=E("free_seating"),c=E(null),k=E(null),g=E(!1),m=W(()=>h.params.id),r=async()=>{const _=m.value;if(!_){u.replace("/dashboard/theater/venues");return}try{p.value=!0;const b=await mt(_);if(i.value=b.capacityType,b.capacityType==="precise_seat"){const f={id:b.id,name:b.name,floors:b.floors||[],zones:(b.zones||[]).map((a,n)=>({id:a.id,venueId:a.venueId,floorId:a.floorId||"",name:a.name,shortName:a.shortName,color:a.color||"#1890ff",order:a.order??a.sort??n+1})),seats:b.seats||[],stage:b.seatMapConfig?.stage,metadata:{createdAt:b.createdAt,updatedAt:b.updatedAt}};d.value={name:b.name,type:b.type,scenicId:b.scenicId,address:b.address,description:b.description,capacityType:b.capacityType,preciseSeats:f}}else d.value={name:b.name,type:b.type,scenicId:b.scenicId,address:b.address,description:b.description,capacityType:b.capacityType,totalCapacity:b.totalCapacity,zones:b.zones?b.zones.map(f=>({id:f.id,name:f.name,capacity:f.capacity||0,sort:f.sort})):[]};try{k.value=await li(_)}catch(f){console.error("è·å–åœºé¦†é”å®šçŠ¶æ€å¤±è´¥:",f),k.value=null}}catch(b){console.error(b)}finally{p.value=!1}};Re(()=>{r()});const o=async _=>{const b=m.value;if(b)try{s.value=!0;const f={id:b};if(_.capacityType==="free_seating")Object.assign(f,{name:_.name,type:_.type,scenicId:_.scenicId,address:_.address,description:_.description,capacityType:"free_seating",totalCapacity:_.totalCapacity||0});else if(_.capacityType==="zone_capacity")Object.assign(f,{name:_.name,type:_.type,scenicId:_.scenicId,address:_.address,description:_.description,capacityType:"zone_capacity",zones:(_.zones||[]).map((a,n)=>({name:a.name,capacity:a.capacity,sort:n+1}))});else if(_.capacityType==="precise_seat"){const a=_.preciseSeats;if(!a||!a.zones||!a.seats)throw new Error("è¯·å…ˆé…ç½®åº§ä½å›¾");Object.assign(f,{name:_.name,type:_.type,scenicId:_.scenicId,address:_.address,description:_.description,capacityType:"precise_seat",zones:a.zones.map(n=>({name:n.name,shortName:n.shortName,color:n.color,floor:a.floors.find(S=>S.id===n.floorId)?.name})),seats:a.seats.map(n=>({zoneId:n.zoneId||"",rowLabel:n.rowLabel,seatLabel:n.seatLabel,status:n.status,label:n.label,x:n.x,y:n.y}))})}await mn(f),N.success("ä¿å­˜æˆåŠŸ"),u.push("/dashboard/theater/venues")}catch(f){f&&f.message&&N.error(f.message),console.error(f)}finally{s.value=!1}},y=_=>{N.success("åœºé¦†å¤åˆ¶æˆåŠŸ"),g.value=!1,u.push(`/dashboard/theater/venues/${_}/edit`)};return(_,b)=>{const f=w("a-spin"),a=w("a-button");return I(),V(vt,null,{footer:t(()=>[e(a,{onClick:b[1]||(b[1]=n=>Y(u).push("/dashboard/theater/venues"))},{default:t(()=>[...b[4]||(b[4]=[v("è¿”å›",-1)])]),_:1}),e(a,{type:"primary",loading:s.value,onClick:b[2]||(b[2]=n=>c.value?.submit())},{default:t(()=>[...b[5]||(b[5]=[v(" ä¿å­˜ ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(f,{spinning:p.value},{default:t(()=>[x("div",mi,[k.value?(I(),V(pi,{key:0,"lock-status":k.value,"show-copy-button":!0,onCopy:b[0]||(b[0]=n=>g.value=!0)},null,8,["lock-status"])):q("",!0),d.value?(I(),V(da,{key:1,ref_key:"formRef",ref:c,"initial-values":d.value,"is-edit":!0,onSubmit:o},null,8,["initial-values"])):q("",!0)])]),_:1},8,["spinning"]),k.value?(I(),V(fi,{key:0,open:g.value,"source-venue-id":m.value,"source-venue-name":d.value?.name||"",onClose:b[3]||(b[3]=n=>g.value=!1),onSuccess:y},null,8,["open","source-venue-id","source-venue-name"])):q("",!0)]),_:1})}}});async function vi(l){return lt("/theater/shows",{params:l})}async function yi(l){return $t("/theater/shows",l)}async function ca(l){return lt(`/theater/shows/${l}`)}async function gi(l){const{id:h,...u}=l;return pt(`/theater/shows/${h}`,u)}async function _i(l,h){const u={id:l,status:h};return pt(`/theater/shows/${l}/status`,u)}async function bi(l){return aa(`/theater/shows/${l}`)}const hi={key:0},xi={key:0,type:"secondary",style:{"font-size":"12px",display:"block","margin-top":"4px"}},ki=["onClick"],wi=["onClick"],Si=["onClick"],Ci=["onClick"],gr=de({__name:"ShowList",setup(l){const h=Xe(),u=E(""),p=E(void 0),s=E(void 0),d=E(!1),i=E([]),c=E(0),k=E(1),g=E(10),m={live_show:"å®æ™¯æ¼”å‡º",musical:"éŸ³ä¹å‰§",drama:"è¯å‰§",concert:"æ¼”å”±ä¼š",other:"å…¶ä»–"},r={draft:{text:"è‰ç¨¿",status:"default"},on_sale:{text:"åœ¨å”®",status:"success"},off_sale:{text:"åœå”®",status:"warning"},finished:{text:"å·²ç»“æŸ",status:"error"}},o=[{title:"æ¼”å‡ºåç§°",dataIndex:"name",key:"name",width:220,fixed:"left"},{title:"æ‰€å±åœºé¦†",dataIndex:"venueName",key:"venueName",width:160},{title:"æ¼”å‡ºç±»å‹",dataIndex:"type",key:"type",width:120},{title:"åœºæ¬¡æ•°é‡",dataIndex:"sessionCount",key:"sessionCount",width:110,align:"right"},{title:"æœ€è¿‘å¼€æ¼”",dataIndex:"nextSessionTime",key:"nextSessionTime",width:180},{title:"çŠ¶æ€",dataIndex:"status",key:"status",width:100},{title:"åˆ›å»ºæ—¶é—´",dataIndex:"createdAt",key:"createdAt",width:180},{title:"æ“ä½œ",key:"actions",width:220,fixed:"right",align:"right"}],y=async()=>{try{d.value=!0;const a={page:k.value,pageSize:g.value,keyword:u.value||void 0,venueId:p.value,status:s.value},n=await vi(a);i.value=n.list,c.value=n.total}catch(a){console.error(a),N.error("è·å–æ¼”å‡ºåˆ—è¡¨å¤±è´¥")}finally{d.value=!1}};_e([u,p,s],()=>{k.value=1,y()}),Re(()=>{y()});const _=async(a,n)=>{const S=r[n].text;try{await _i(a,n),N.success(`çŠ¶æ€å·²æ›´æ–°ä¸ºã€Œ${S}ã€`),y()}catch(z){console.error(z),N.error("æ›´æ–°çŠ¶æ€å¤±è´¥")}},b=async a=>{try{await bi(a),N.success("åˆ é™¤æ¼”å‡ºæˆåŠŸ"),y()}catch(n){console.error(n),N.error("åˆ é™¤æ¼”å‡ºå¤±è´¥")}},f=()=>{if(!i.value.length){N.warning("æš‚æ— æ•°æ®å¯å¯¼å‡º");return}const a=i.value.map(D=>({name:D.name,venueName:D.venueName||"",type:m[D.type],status:r[D.status].text,sessionCount:D.sessionCount||0,nextSessionTime:D.nextSessionTime?new Date(D.nextSessionTime).toLocaleString("zh-CN"):"",createdAt:new Date(D.createdAt).toLocaleString("zh-CN")})),S=[["æ¼”å‡ºåç§°","æ‰€å±åœºé¦†","æ¼”å‡ºç±»å‹","çŠ¶æ€","åœºæ¬¡æ•°é‡","æœ€è¿‘å¼€æ¼”","åˆ›å»ºæ—¶é—´"].join(","),...a.map(D=>[D.name,D.venueName,D.type,D.status,D.sessionCount,D.nextSessionTime,D.createdAt].map(P=>`"${String(P).replace(/"/g,'""')}"`).join(","))].join(`
`),z=new Blob([S],{type:"text/csv;charset=utf-8;"}),$=URL.createObjectURL(z),F=document.createElement("a");F.href=$,F.download=`æ¼”å‡ºåˆ—è¡¨_${new Date().toLocaleDateString("zh-CN").replace(/\//g,"-")}.csv`,F.click(),URL.revokeObjectURL($)};return(a,n)=>{const S=w("a-input"),z=w("a-select-option"),$=w("a-select"),F=w("a-badge"),D=w("a-popconfirm"),P=w("a-space"),A=w("a-table");return I(),V(la,{actions:[{label:"æ–°å»ºæ¼”å‡º",type:"primary",onClick:()=>Y(h).push("/dashboard/theater/shows/new")},{label:"å¯¼å‡º",type:"default",onClick:f}]},{filters:t(()=>[e(S,{value:u.value,"onUpdate:value":n[0]||(n[0]=Z=>u.value=Z),placeholder:"æœç´¢æ¼”å‡ºåç§°",style:{width:"216px"},"allow-clear":""},null,8,["value"]),e(S,{value:p.value,"onUpdate:value":n[1]||(n[1]=Z=>p.value=Z),placeholder:"ï¼ˆæš‚ç”¨ï¼‰è¾“å…¥åœºé¦†IDç­›é€‰",style:{width:"216px"},"allow-clear":""},null,8,["value"]),e($,{value:s.value,"onUpdate:value":n[2]||(n[2]=Z=>s.value=Z),placeholder:"å…¨éƒ¨çŠ¶æ€","allow-clear":"",style:{width:"216px"}},{default:t(()=>[e(z,{value:"draft"},{default:t(()=>[...n[3]||(n[3]=[v("è‰ç¨¿",-1)])]),_:1}),e(z,{value:"on_sale"},{default:t(()=>[...n[4]||(n[4]=[v("åœ¨å”®",-1)])]),_:1}),e(z,{value:"off_sale"},{default:t(()=>[...n[5]||(n[5]=[v("åœå”®",-1)])]),_:1}),e(z,{value:"finished"},{default:t(()=>[...n[6]||(n[6]=[v("å·²ç»“æŸ",-1)])]),_:1})]),_:1},8,["value"])]),default:t(()=>[e(A,{columns:o,"data-source":i.value,loading:d.value,"row-key":"id",scroll:{x:1200},pagination:{current:k.value,pageSize:g.value,total:c.value,showSizeChanger:!1,showTotal:Z=>`å…± ${Z} æ¡`,onChange:Z=>{k.value.value=Z,y()}}},{bodyCell:t(({column:Z,text:ne,record:T})=>[Z.key==="name"?(I(),O("div",hi,[x("span",null,B(T.name),1),T.subtitle?(I(),O("span",xi,B(T.subtitle),1)):q("",!0)])):Z.key==="type"?(I(),O(oe,{key:1},[v(B(m[ne]),1)],64)):Z.key==="sessionCount"?(I(),O(oe,{key:2},[v(B((ne||0)+" åœº"),1)],64)):Z.key==="nextSessionTime"?(I(),O(oe,{key:3},[v(B(ne?new Date(ne).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"),1)],64)):Z.key==="status"?(I(),V(F,{key:4,status:r[ne].status,text:r[ne].text},null,8,["status","text"])):Z.key==="createdAt"?(I(),O(oe,{key:5},[v(B(new Date(ne).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),1)],64)):Z.key==="actions"?(I(),V(P,{key:6,size:"small"},{default:t(()=>[x("a",{onClick:L=>Y(h).push(`/dashboard/theater/shows/${T.id}`)},"ç¼–è¾‘",8,ki),T.status==="draft"?(I(),O("a",{key:0,onClick:L=>_(T.id,"on_sale")}," ä¸Šæ¶ ",8,wi)):T.status==="on_sale"?(I(),O("a",{key:1,onClick:L=>_(T.id,"off_sale")}," åœå”® ",8,Si)):T.status==="off_sale"?(I(),O("a",{key:2,onClick:L=>_(T.id,"on_sale")}," ä¸Šæ¶ ",8,Ci)):q("",!0),e(D,{title:"ç¡®è®¤åˆ é™¤è¯¥æ¼”å‡ºå—ï¼Ÿ","ok-text":"ç¡®è®¤","cancel-text":"å–æ¶ˆ",onConfirm:()=>b(T.id)},{default:t(()=>[...n[7]||(n[7]=[x("a",null,"åˆ é™¤",-1)])]),_:1},8,["onConfirm"])]),_:2},1024)):q("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1},8,["actions"])}}}),Be=[{key:"basicInfo",title:"åŸºç¡€ä¿¡æ¯"},{key:"sessions",title:"åœºæ¬¡é…ç½®"},{key:"salesRule",title:"é¢„è®¢è§„åˆ™"},{key:"details",title:"æ¼”å‡ºè¯¦æƒ…"}],Ii={style:{"max-width":"720px"}},Ti=de({__name:"BasicInfoStep",props:{modelValue:{},venueOptions:{}},emits:["update:modelValue"],setup(l,{emit:h}){const u=l,p=h,s=W({get:()=>u.modelValue,set:g=>p("update:modelValue",g)}),d=E([]);_e(()=>s.value.coverImage,g=>{d.value.length||(g&&g.length?d.value=g.map((m,r)=>({uid:`-${r}`,name:`cover-${r}.jpg`,status:"done",url:m})):d.value=[])},{immediate:!0});const i=g=>g.type.startsWith("image/")?["image/jpeg","image/png","image/gif"].includes(g.type)?g.size/1024/1024<3?!0:(window.message?.error?.("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 3MB"),!1):(window.message?.error?.("ä»…æ”¯æŒ JPG/PNG/GIF æ ¼å¼çš„å›¾ç‰‡"),!1):(window.message?.error?.("åªæ”¯æŒä¸Šä¼ å›¾ç‰‡æ–‡ä»¶"),!1),c=g=>{const{file:m,onSuccess:r,onError:o}=g,y=new FileReader;y.onload=()=>{const _=y.result;try{r({url:_})}catch(b){o?.(b)}},y.onerror=()=>{o?.(new Error("å›¾ç‰‡è¯»å–å¤±è´¥"))},y.readAsDataURL(m)},k=g=>{const m=(g.fileList||[]).map(o=>{const y=o.url||o.thumbUrl||o.response?.url;return y?{...o,url:y}:o});d.value=m;const r=m.filter(o=>o.status==="done").map(o=>o.url).filter(o=>!!o);s.value.coverImage=r.length?r:void 0};return(g,m)=>{const r=w("a-input"),o=w("a-form-item"),y=w("a-select-option"),_=w("a-select"),b=w("YUploadDraggable"),f=w("a-textarea"),a=w("a-radio"),n=w("a-radio-group");return I(),O("div",Ii,[e(o,{name:["basicInfo","name"],label:"æ¼”å‡ºåç§°",rules:[{required:!0,message:"è¯·è¾“å…¥æ¼”å‡ºåç§°"}]},{default:t(()=>[e(r,{value:s.value.name,"onUpdate:value":m[0]||(m[0]=S=>s.value.name=S),placeholder:"è¯·è¾“å…¥æ¼”å‡ºåç§°",maxlength:50},null,8,["value"])]),_:1}),e(o,{name:["basicInfo","type"],label:"æ¼”å‡ºç±»å‹",rules:[{required:!0,message:"è¯·é€‰æ‹©æ¼”å‡ºç±»å‹"}]},{default:t(()=>[e(_,{value:s.value.type,"onUpdate:value":m[1]||(m[1]=S=>s.value.type=S),placeholder:"è¯·é€‰æ‹©"},{default:t(()=>[e(y,{value:"live_show"},{default:t(()=>[...m[5]||(m[5]=[v("ç°åœºæ¼”å‡º",-1)])]),_:1}),e(y,{value:"musical"},{default:t(()=>[...m[6]||(m[6]=[v("éŸ³ä¹å‰§",-1)])]),_:1}),e(y,{value:"drama"},{default:t(()=>[...m[7]||(m[7]=[v("è¯å‰§",-1)])]),_:1}),e(y,{value:"concert"},{default:t(()=>[...m[8]||(m[8]=[v("æ¼”å”±ä¼š",-1)])]),_:1}),e(y,{value:"other"},{default:t(()=>[...m[9]||(m[9]=[v("å…¶ä»–",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(o,{name:["basicInfo","coverImage"],label:"æ¼”å‡ºå›¾ç‰‡",extra:"å»ºè®®å°ºå¯¸ï¼šå°é¢å›¾ 750Ã—750pxï¼Œè¯¦æƒ…å›¾ 750Ã—375pxï¼Œæ”¯æŒ JPG/PNG/GIFï¼Œå•å¼ ä¸è¶…è¿‡ 3MBï¼Œæœ€å¤š 6 å¼ ï¼Œå¯æ‹–æ‹½è°ƒæ•´é¡ºåº"},{default:t(()=>[e(b,{fileList:d.value,"onUpdate:fileList":m[2]||(m[2]=S=>d.value=S),"show-cover-badge":!0,"max-count":6,"before-upload":i,"custom-request":c,onChange:k},null,8,["fileList"])]),_:1}),e(o,{name:["basicInfo","description"],label:"æ¼”å‡ºç®€ä»‹"},{default:t(()=>[e(f,{value:s.value.description,"onUpdate:value":m[3]||(m[3]=S=>s.value.description=S),placeholder:"è¯·è¾“å…¥æ¼”å‡ºç®€ä»‹",rows:4,maxlength:500,"show-count":""},null,8,["value"])]),_:1}),e(o,{name:["basicInfo","status"],label:"å‘å¸ƒçŠ¶æ€",rules:[{required:!0,message:"è¯·é€‰æ‹©å‘å¸ƒçŠ¶æ€"}]},{default:t(()=>[e(n,{value:s.value.status,"onUpdate:value":m[4]||(m[4]=S=>s.value.status=S)},{default:t(()=>[e(a,{value:"on_sale"},{default:t(()=>[...m[10]||(m[10]=[v("ä¸Šæ¶",-1)])]),_:1}),e(a,{value:"draft"},{default:t(()=>[...m[11]||(m[11]=[v("æ”¾å…¥ä»“åº“",-1)])]),_:1}),e(a,{value:"off_sale"},{default:t(()=>[...m[12]||(m[12]=[v("ä¸‹æ¶",-1)])]),_:1}),e(a,{value:"finished"},{default:t(()=>[...m[13]||(m[13]=[v("å·²ç»“æŸ",-1)])]),_:1})]),_:1},8,["value"])]),_:1})])}}}),$i={class:"ticket-header-row"},Ri={key:0,class:"ticket-header-text"},zi={class:"ticket-header-actions"},Di={class:"session-time-actions"},Mi={class:"periodic-time-list"},Fi={class:"exclude-date-list"},Ei=de({__name:"AddSessionModal",props:{visible:{type:Boolean},initialValues:{},existingConfigs:{}},emits:["update:visible","ok","cancel"],setup(l,{emit:h}){const u=l,p=h,s=E(!1),d=E([]),i=E(void 0),c=E([]),k=E(null),g=E(!1),m=E(null),r=Qe({venueId:void 0,customSessions:[],periodicDateRange:[],periodicWeekdays:[5,6],periodicTimes:[],periodicDurationMinutes:90,periodicExcludeDates:[],priceTiers:[]}),o=W(()=>u.visible),y=()=>JSON.stringify({venueId:r.venueId,customSessions:r.customSessions,periodicDateRange:r.periodicDateRange,periodicWeekdays:r.periodicWeekdays,periodicTimes:r.periodicTimes,periodicDurationMinutes:r.periodicDurationMinutes,periodicExcludeDates:r.periodicExcludeDates,priceTiers:r.priceTiers}),_=(X,M)=>{if(!X||X.capacityType!=="precise_seat")return[];const K=X.floors||[],le=X.zones||[],ie=X.seats||[],ve=new Map;return(M||[]).forEach(me=>{const Ce=me.zoneId;Ce&&ve.set(Ce,me)}),le.map((me,Ce)=>{const ze=K.find(De=>De.id===me.floorId)||K.find(De=>De.name===me.floor)||null,Ge=ie.filter(De=>De.zoneId===me.id&&De.status==="available").length,Ye={name:me.name,price:0,id:void 0,floorId:me.floorId,floorName:ze?.name||me.floor||"",zoneId:me.id,capacity:Ge,order:me.order??me.sort??Ce},qe=ve.get(me.id);return qe?{...Ye,price:qe.price}:Ye})},b=X=>!X||X.capacityType!=="zone_capacity"?[]:(X.zones||[]).map((le,ie)=>({name:le.name,price:0,id:void 0,color:le.color||"#1890ff",remark:"",zoneId:le.id,zoneIds:[le.id],capacity:0,order:le.order??le.sort??ie})),f=async()=>{try{s.value=!0;const M=await ft({page:1,pageSize:100,status:"active"});d.value=(M.list||[]).map(K=>({label:K.name,value:K.id,capacityType:K.capacityType,raw:K}))}catch(X){console.error(X),N.error("è·å–åœºé¦†åˆ—è¡¨å¤±è´¥")}finally{s.value=!1}},a=X=>{const M=X.capacityType,K=!!u.initialValues&&u.initialValues.venueId===X.id;i.value=M,k.value=X,M==="zone_capacity"&&X.zones?c.value=(X.zones||[]).map(le=>({label:le.name,value:le.id})):c.value=[],K||(r.priceTiers=[]),M==="precise_seat"?r.priceTiers=_(X,r.priceTiers):M==="zone_capacity"&&(r.priceTiers.length||(r.priceTiers=b(X)))},n=async X=>{if(!X){i.value=void 0,c.value=[],k.value=null;return}try{const M=await mt(X);a(M)}catch(M){console.error(M),N.error("è·å–åœºé¦†è¯¦æƒ…å¤±è´¥")}},S=X=>{if(!X){r.venueId=void 0,r.customSessions=[{date:"",startTime:"",durationMinutes:90}],r.periodicDateRange=[],r.periodicWeekdays=[5,6],r.periodicTimes=[],r.periodicDurationMinutes=90,r.periodicExcludeDates=[],r.priceTiers=[],i.value=void 0,c.value=[],k.value=null;return}r.venueId=X.venueId,r.customSessions=(X.sessions||[]).map(M=>({date:M.date,startTime:M.startTime,durationMinutes:M.durationMinutes})),r.periodicDateRange=[],r.periodicWeekdays=[5,6],r.periodicTimes=[],r.periodicDurationMinutes=X.sessions&&X.sessions[0]?.durationMinutes||90,r.periodicExcludeDates=[],r.priceTiers=(X.priceTiers||[]).map(M=>{const K={...M};return!K.zoneId&&K.zoneIds&&K.zoneIds.length===1&&(K.zoneId=K.zoneIds[0]),K})};_e(()=>u.visible,async X=>{X?(await f(),S(u.initialValues),u.initialValues?.venueId?await n(u.initialValues.venueId):r.venueId&&await n(r.venueId),m.value=y()):m.value=null}),_e(()=>r.venueId,X=>{n(X)}),_e(()=>i.value,X=>{X&&!u.initialValues&&X==="free_seating"&&!r.priceTiers.length&&r.priceTiers.push({name:"æ ‡å‡†ç¥¨",price:0,color:"#1890ff",remark:"",capacity:0})}),Re(()=>{u.visible&&f()});const z=()=>{r.customSessions.push({date:"",startTime:"",durationMinutes:r.periodicDurationMinutes||90})},$=X=>{if(r.customSessions.length<=1){N.warning("è‡³å°‘éœ€è¦ä¿ç•™ 1 ä¸ªåœºæ¬¡æ—¶é—´");return}r.customSessions.splice(X,1)},F=()=>{if(!r.venueId){N.error("è¯·å…ˆé€‰æ‹©åœºé¦†");return}const X=i.value,M={name:X==="free_seating"&&!r.priceTiers.length?"æ ‡å‡†ç¥¨":"",price:0};X==="free_seating"&&(M.capacity=0),r.priceTiers.push(M)},D=X=>{r.priceTiers.splice(X,1)},P=()=>{r.periodicTimes.push("19:30")},A=X=>{r.periodicTimes.splice(X,1)},Z=()=>{r.periodicExcludeDates.push({date:"",reason:""})},ne=X=>{r.periodicExcludeDates.splice(X,1)},T=X=>{if(!X||X.length!==2){r.periodicDateRange=[];return}const[M,K]=X,le=He(M);if(He(K).diff(le,"day")>365){N.error("æ—¥æœŸèŒƒå›´ä¸èƒ½è¶…è¿‡ä¸€å¹´"),r.periodicDateRange=[];return}r.periodicDateRange=X},L=()=>{g.value=!0},H=()=>{if(!r.periodicDateRange||r.periodicDateRange.length!==2||!r.periodicTimes.length||!r.periodicDurationMinutes||r.periodicDurationMinutes<=0)return[];const[X,M]=r.periodicDateRange;let K=He(X);const le=He(M),ie=[],ve=(r.periodicExcludeDates||[]).map(ye=>ye.date?He(ye.date).format("YYYY-MM-DD"):"");for(;K.isBefore(le)||K.isSame(le,"day");){const ye=K.day(),me=K.format("YYYY-MM-DD"),Ce=ve.length>0&&ve.includes(me);(!r.periodicWeekdays.length||r.periodicWeekdays.includes(ye))&&!Ce&&r.periodicTimes.forEach(ze=>{ie.push({date:me,startTime:ze,durationMinutes:r.periodicDurationMinutes||90})}),K=K.add(1,"day")}return ie},J=X=>{const M=new Set;return(u.existingConfigs||[]).forEach(K=>{(K.sessions||[]).forEach(le=>{M.add(`${K.venueId}_${le.date}_${le.startTime}`)})}),r.customSessions.forEach(K=>{K.date&&K.startTime&&M.add(`${r.venueId||""}_${K.date}_${K.startTime}`)}),X.some(K=>M.has(`${r.venueId||""}_${K.date}_${K.startTime}`))},ue=X=>{if(!X.length)return!1;const M={};return X.forEach(K=>{if(!K.date||!K.startTime||!K.durationMinutes||K.durationMinutes<=0)return;const[le,ie]=K.startTime.split(":"),ve=Number(le),ye=Number(ie);if(Number.isNaN(ve)||Number.isNaN(ye))return;const me=ve*60+ye,Ce=me+K.durationMinutes,ze=K.date;M[ze]||(M[ze]=[]),M[ze].push({start:me,end:Ce})}),Object.values(M).some(K=>{if(K.length<=1)return!1;const le=K.sort((ie,ve)=>ie.start-ve.start);for(let ie=1;ie<le.length;ie+=1){const ve=le[ie-1],ye=le[ie];if(!(!ve||!ye)&&ye.start<ve.end)return!0}return!1})},pe=()=>{const X=H();if(!X.length){N.error("è¯·å…ˆå®Œæ•´å¡«å†™æ‰¹é‡åœºæ¬¡é…ç½®");return}if(J(X)){N.error("æ‰¹é‡ç”Ÿæˆçš„åœºæ¬¡ä¸å·²æœ‰åœºæ¬¡é…ç½®å­˜åœ¨æ—¶é—´å†²çªï¼Œè¯·è°ƒæ•´åå†ç”Ÿæˆ");return}r.customSessions.push(...X.map(M=>({date:M.date,startTime:M.startTime,durationMinutes:M.durationMinutes}))),g.value=!1},G=()=>{g.value=!1},se=W(()=>H().length),ae=W(()=>i.value!=="free_seating"?0:(r.priceTiers||[]).reduce((X,M)=>X+(M.capacity||0),0)),he=W(()=>i.value!=="free_seating"||!k.value?0:k.value.totalCapacity||0),ge=W(()=>i.value==="free_seating"&&he.value>0&&ae.value>he.value),ee=W(()=>{const X=new Map;return k.value&&(k.value.zones||[]).forEach(K=>{K&&K.id&&X.set(K.id,K)}),X}),re=W(()=>{if(i.value!=="zone_capacity")return{totalCurrent:0,totalZone:0};let X=0,M=0;const K=ee.value;return(r.priceTiers||[]).forEach(le=>{const ie=le.capacity||0,ve=le.zoneId||le.zoneIds&&le.zoneIds[0],me=(ve?K.get(ve):void 0)?.capacity||0;X+=ie,M+=me}),{totalCurrent:X,totalZone:M}}),ce=W(()=>i.value==="zone_capacity"&&re.value.totalZone>0&&re.value.totalCurrent>re.value.totalZone),be=X=>{if(!X)return null;const M=X.zoneId||X.zoneIds&&X.zoneIds[0];return M&&ee.value.get(M)||null},xe=X=>{const M=be(X);if(!M)return!1;const K=X.capacity||0,le=M.capacity||0;return le>0&&K>le},Te=()=>{if(!m.value)return!1;try{return m.value!==y()}catch{return!0}},Ze=()=>{const X=r.customSessions.filter(M=>M.date&&M.startTime&&M.durationMinutes);if(!X.length){N.error("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªåœºæ¬¡æ—¶é—´");return}if(ue(X)){N.error("åŒä¸€å¤©å†…çš„åœºæ¬¡æ—¶é—´å­˜åœ¨é‡å ï¼Œè¯·è°ƒæ•´åå†ä¿å­˜");return}yt()},yt=()=>{if(!r.venueId){N.error("è¯·å…ˆé€‰æ‹©åœºé¦†");return}const X=r.customSessions.filter(ie=>ie.date&&ie.startTime&&ie.durationMinutes);if(!X.length){N.error("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªåœºæ¬¡æ—¶é—´");return}if(J([])){N.error("åœºæ¬¡æ—¶é—´ä¸å·²æœ‰åœºæ¬¡é…ç½®å­˜åœ¨å†²çªï¼Œè¯·è°ƒæ•´åå†ä¿å­˜");return}if(!r.priceTiers.length){N.error("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªç¥¨æ¡£");return}if(r.priceTiers.some(ie=>!ie.name||ie.price===void 0||ie.price<=0)){N.error("è¯·å®Œæ•´å¡«å†™æ‰€æœ‰ç¥¨æ¡£ä¿¡æ¯ï¼Œå¹¶è®¾ç½®æœ‰æ•ˆä»·æ ¼");return}const K=d.value.find(ie=>ie.value===r.venueId),le={venueId:r.venueId,venueName:K?.label,venueCapacityType:K?.capacityType,priceTiers:r.priceTiers.map(ie=>({...ie,name:ie.name.trim(),remark:ie.remark?.trim()||void 0})),sessions:X.map(ie=>({date:ie.date,startTime:ie.startTime,durationMinutes:ie.durationMinutes}))};p("ok",le),p("update:visible",!1)},gt=()=>{Te()?nt.confirm({title:"ç¡®è®¤å…³é—­ï¼Ÿ",content:"æœ‰æœªä¿å­˜çš„åœºæ¬¡é…ç½®ä¿®æ”¹ï¼Œå…³é—­åå°†ä¸ä¿å­˜ã€‚",okText:"ç¡®è®¤å…³é—­",cancelText:"ç»§ç»­ç¼–è¾‘",onOk(){p("update:visible",!1),p("cancel")}}):(p("update:visible",!1),p("cancel"))};return(X,M)=>{const K=w("a-select"),le=w("a-form-item"),ie=w("a-alert"),ve=w("a-button"),ye=w("a-table-column"),me=w("a-input-number"),Ce=w("a-table"),ze=w("a-input"),Ge=w("a-typography-text"),Ye=w("a-popconfirm"),qe=w("a-space"),De=w("a-date-picker"),et=w("a-time-picker"),tt=w("a-form"),_t=w("a-spin"),ot=w("a-range-picker"),Ee=w("a-checkbox"),st=w("a-checkbox-group"),it=w("a-modal");return I(),V(it,{open:o.value,title:"æ·»åŠ åœºæ¬¡é…ç½®",width:"900px","destroy-on-close":!0,"wrap-class-name":"add-session-modal",onOk:Ze,onCancel:gt},{default:t(()=>[e(_t,{spinning:s.value},{default:t(()=>[e(tt,{layout:"vertical"},{default:t(()=>[e(le,{label:"åœºé¦†åç§°",required:""},{default:t(()=>[e(K,{value:r.venueId,"onUpdate:value":M[0]||(M[0]=te=>r.venueId=te),placeholder:"è¯·é€‰æ‹©",options:d.value,"show-search":"","filter-option":(te,fe)=>(fe?.label??"").toLowerCase().includes(te.toLowerCase())},null,8,["value","options","filter-option"])]),_:1}),e(le,{label:"ç¥¨æ¡£é…ç½®",required:""},{default:t(()=>[e(qe,{direction:"vertical",class:"ticket-space-vertical"},{default:t(()=>[r.venueId?q("",!0):(I(),V(ie,{key:0,type:"info","show-icon":"",class:"ticket-venue-alert",message:"è¯·å…ˆé€‰æ‹©åœºé¦†"})),x("div",$i,[i.value==="precise_seat"?(I(),O("span",Ri," å·²é…ç½® "+B(r.priceTiers.length)+" ä¸ªç¥¨æ¡£ ",1)):q("",!0),x("div",zi,[i.value==="free_seating"?(I(),V(ve,{key:0,type:"dashed",disabled:!r.venueId,onClick:F},{default:t(()=>[...M[3]||(M[3]=[v(" æ·»åŠ ç¥¨æ¡£ ",-1)])]),_:1},8,["disabled"])):q("",!0)])]),i.value==="precise_seat"&&r.priceTiers.length?(I(),V(Ce,{key:1,"data-source":r.priceTiers,pagination:!1,"row-key":(te,fe)=>String(fe)},{default:t(()=>[e(ye,{key:"name",width:"30%"},{title:t(()=>[...M[4]||(M[4]=[v("ç¥¨æ¡£åç§°",-1)])]),default:t(({index:te})=>[x("span",null,B(r.priceTiers[te].name),1)]),_:1}),e(ye,{key:"floorName",width:"20%"},{title:t(()=>[...M[5]||(M[5]=[v("æ¥¼å±‚",-1)])]),default:t(({index:te})=>[x("span",null,B(r.priceTiers[te].floorName||"-"),1)]),_:1}),e(ye,{key:"price",width:"25%"},{title:t(()=>[...M[6]||(M[6]=[x("span",{class:"required-asterisk"},"*",-1),x("span",{class:"required-label-margin"},"ç¥¨ä»·ï¼ˆå…ƒï¼‰",-1)])]),default:t(({index:te})=>[e(me,{value:r.priceTiers[te].price,"onUpdate:value":fe=>r.priceTiers[te].price=fe,min:0,max:999999,precision:2,placeholder:"ç¥¨ä»·",class:"full-width-input"},null,8,["value","onUpdate:value"])]),_:1}),e(ye,{key:"capacity",width:"25%"},{title:t(()=>[...M[7]||(M[7]=[v("åº“å­˜(å¯å”®åº§ä½)",-1)])]),default:t(({index:te})=>[x("span",null,B(r.priceTiers[te].capacity??"-"),1)]),_:1})]),_:1},8,["data-source","row-key"])):r.priceTiers.length?(I(),V(Ce,{key:2,"data-source":r.priceTiers,pagination:!1,"row-key":(te,fe)=>String(fe)},{default:t(()=>[e(ye,{key:"name",width:"25%"},{title:t(()=>[...M[8]||(M[8]=[x("span",{class:"required-asterisk"},"*",-1),x("span",{class:"required-label-margin"},"ç¥¨æ¡£åç§°",-1)])]),default:t(({index:te})=>[e(ze,{value:r.priceTiers[te].name,"onUpdate:value":fe=>r.priceTiers[te].name=fe,placeholder:"è¯·è¾“å…¥ç¥¨æ¡£åç§°",maxlength:20},null,8,["value","onUpdate:value"])]),_:1}),e(ye,{key:"price",width:"20%"},{title:t(()=>[...M[9]||(M[9]=[x("span",{class:"required-asterisk"},"*",-1),x("span",{class:"required-label-margin"},"ç¥¨é¢ä»·ï¼ˆå…ƒï¼‰",-1)])]),default:t(({index:te})=>[e(me,{value:r.priceTiers[te].price,"onUpdate:value":fe=>r.priceTiers[te].price=fe,min:0,max:999999,precision:2,placeholder:"ä»·æ ¼",class:"full-width-input"},null,8,["value","onUpdate:value"])]),_:1}),i.value==="free_seating"?(I(),V(ye,{key:"capacity",width:"20%"},{title:t(()=>[x("span",null,[M[10]||(M[10]=v(" åº“å­˜",-1)),M[11]||(M[11]=x("span",{class:"required-asterisk"},"*",-1)),k.value&&k.value.totalCapacity?(I(),V(Ge,{key:0,type:ge.value?"danger":"secondary",class:"capacity-hint-text"},{default:t(()=>[v(" ("+B(ae.value)+"/"+B(k.value.totalCapacity||0)+") ",1)]),_:1},8,["type"])):q("",!0)])]),default:t(({index:te})=>[e(me,{value:r.priceTiers[te].capacity,"onUpdate:value":fe=>r.priceTiers[te].capacity=fe,min:1,max:999999,class:"full-width-input",placeholder:"åº“å­˜"},null,8,["value","onUpdate:value"])]),_:1})):q("",!0),i.value==="zone_capacity"?(I(),V(ye,{key:"zoneCapacity",width:"20%"},{title:t(()=>[x("span",null,[M[12]||(M[12]=v(" åº“å­˜",-1)),M[13]||(M[13]=x("span",{class:"required-asterisk"},"*",-1)),re.value.totalZone?(I(),V(Ge,{key:0,type:ce.value?"danger":"secondary",class:"capacity-hint-text"},{default:t(()=>[v(" ("+B(re.value.totalCurrent)+"/"+B(re.value.totalZone)+") ",1)]),_:1},8,["type"])):q("",!0)])]),default:t(({index:te})=>[e(me,{value:r.priceTiers[te].capacity,"onUpdate:value":fe=>r.priceTiers[te].capacity=fe,min:1,max:999999,class:"full-width-input",placeholder:"åº“å­˜",status:xe(r.priceTiers[te])?"error":void 0},null,8,["value","onUpdate:value","status"])]),_:1})):q("",!0),i.value==="zone_capacity"?(I(),V(ye,{key:"zoneName",width:"20%"},{title:t(()=>[...M[14]||(M[14]=[v("å…³è”åº§åŒº",-1)])]),default:t(({index:te})=>[x("span",null,B(be(r.priceTiers[te])?.name||"-"),1)]),_:1})):q("",!0),i.value!=="zone_capacity"?(I(),V(ye,{key:"actions",width:80,align:"right"},{title:t(()=>[...M[15]||(M[15]=[v("æ“ä½œ",-1)])]),default:t(({index:te})=>[e(Ye,{title:"ç¡®è®¤åˆ é™¤è¯¥ç¥¨æ¡£å—ï¼Ÿ","ok-text":"ç¡®è®¤","cancel-text":"å–æ¶ˆ",onConfirm:()=>D(te)},{default:t(()=>[e(ve,{type:"link",size:"small"},{default:t(()=>[...M[16]||(M[16]=[v("åˆ é™¤",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})):q("",!0)]),_:1},8,["data-source","row-key"])):q("",!0)]),_:1})]),_:1}),e(le,{label:"åœºæ¬¡æ—¶é—´é…ç½®",required:"",class:"session-time-form-item"},{default:t(()=>[x("div",Di,[e(ve,{onClick:z},{default:t(()=>[...M[17]||(M[17]=[v("æ·»åŠ åœºæ¬¡",-1)])]),_:1}),e(ve,{onClick:L},{default:t(()=>[...M[18]||(M[18]=[v("æ‰¹é‡æ·»åŠ åœºæ¬¡",-1)])]),_:1})]),e(Ce,{"data-source":r.customSessions,pagination:!1,"row-key":(te,fe)=>String(fe)},{default:t(()=>[e(ye,{key:"date",width:"28%"},{title:t(()=>[...M[19]||(M[19]=[v("æ¼”å‡ºæ—¥æœŸ",-1)])]),default:t(({index:te})=>[e(De,{value:r.customSessions[te].date,"onUpdate:value":fe=>r.customSessions[te].date=fe,"value-format":"YYYY-MM-DD",class:"full-width-input",placeholder:"é€‰æ‹©æ—¥æœŸ"},null,8,["value","onUpdate:value"])]),_:1}),e(ye,{key:"startTime",width:"24%"},{title:t(()=>[...M[20]||(M[20]=[v("å¼€æ¼”æ—¶é—´",-1)])]),default:t(({index:te})=>[e(et,{value:r.customSessions[te].startTime,"onUpdate:value":fe=>r.customSessions[te].startTime=fe,"value-format":"HH:mm",format:"HH:mm",class:"full-width-input",placeholder:"é€‰æ‹©æ—¶é—´"},null,8,["value","onUpdate:value"])]),_:1}),e(ye,{key:"durationMinutes",width:"24%"},{title:t(()=>[...M[21]||(M[21]=[v("æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰",-1)])]),default:t(({index:te})=>[e(me,{value:r.customSessions[te].durationMinutes,"onUpdate:value":fe=>r.customSessions[te].durationMinutes=fe,min:1,max:1440,class:"full-width-input",placeholder:"æ—¶é•¿"},null,8,["value","onUpdate:value"])]),_:1}),e(ye,{key:"actions",width:"8%",align:"right"},{title:t(()=>[...M[22]||(M[22]=[v("æ“ä½œ",-1)])]),default:t(({index:te})=>[r.customSessions.length==1?(I(),V(ve,{key:0,type:"link",size:"small",disabled:""},{default:t(()=>[...M[23]||(M[23]=[v("åˆ é™¤",-1)])]),_:1})):(I(),V(Ye,{key:1,title:"ç¡®è®¤åˆ é™¤è¯¥åœºæ¬¡å—ï¼Ÿ","ok-text":"ç¡®è®¤","cancel-text":"å–æ¶ˆ",onConfirm:()=>$(te)},{default:t(()=>[e(ve,{type:"link",size:"small"},{default:t(()=>[...M[24]||(M[24]=[v("åˆ é™¤",-1)])]),_:1})]),_:1},8,["onConfirm"]))]),_:1})]),_:1},8,["data-source","row-key"])]),_:1})]),_:1})]),_:1},8,["spinning"]),e(it,{open:g.value,title:"æ‰¹é‡æ·»åŠ åœºæ¬¡",width:"600px","destroy-on-close":!0,onOk:pe,onCancel:G},{default:t(()=>[e(tt,{layout:"vertical"},{default:t(()=>[e(le,{label:"æ—¥æœŸèŒƒå›´",required:""},{default:t(()=>[e(ot,{value:r.periodicDateRange,"value-format":"YYYY-MM-DD",class:"full-width-input",placeholder:"é€‰æ‹©å¼€å§‹å’Œç»“æŸæ—¥æœŸ",onChange:T},null,8,["value"])]),_:1}),e(le,{label:"æ¯æ—¥å¼€æ¼”æ—¶é—´",required:""},{default:t(()=>[x("div",Mi,[(I(!0),O(oe,null,Se(r.periodicTimes,(te,fe)=>(I(),O("div",{key:fe,class:"periodic-time-item"},[e(et,{value:r.periodicTimes[fe],"onUpdate:value":Le=>r.periodicTimes[fe]=Le,"value-format":"HH:mm",format:"HH:mm",class:"periodic-time-picker"},null,8,["value","onUpdate:value"]),e(ve,{type:"link",size:"small",onClick:Le=>A(fe)},{default:t(()=>[...M[25]||(M[25]=[v(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])]))),128)),e(ve,{type:"dashed",class:"periodic-time-picker",onClick:P},{default:t(()=>[...M[26]||(M[26]=[v(" æ·»åŠ æ—¶é—´ ",-1)])]),_:1})])]),_:1}),e(le,{label:"æ¼”å‡ºæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰",required:""},{default:t(()=>[e(me,{value:r.periodicDurationMinutes,"onUpdate:value":M[1]||(M[1]=te=>r.periodicDurationMinutes=te),min:1,max:1440,class:"periodic-time-picker",placeholder:"æ¼”å‡ºæ—¶é•¿"},null,8,["value"])]),_:1}),e(le,{label:"æ˜ŸæœŸé™åˆ¶"},{default:t(()=>[e(st,{value:r.periodicWeekdays,"onUpdate:value":M[2]||(M[2]=te=>r.periodicWeekdays=te)},{default:t(()=>[e(Ee,{value:1},{default:t(()=>[...M[27]||(M[27]=[v("å‘¨ä¸€",-1)])]),_:1}),e(Ee,{value:2},{default:t(()=>[...M[28]||(M[28]=[v("å‘¨äºŒ",-1)])]),_:1}),e(Ee,{value:3},{default:t(()=>[...M[29]||(M[29]=[v("å‘¨ä¸‰",-1)])]),_:1}),e(Ee,{value:4},{default:t(()=>[...M[30]||(M[30]=[v("å‘¨å››",-1)])]),_:1}),e(Ee,{value:5},{default:t(()=>[...M[31]||(M[31]=[v("å‘¨äº”",-1)])]),_:1}),e(Ee,{value:6},{default:t(()=>[...M[32]||(M[32]=[v("å‘¨å…­",-1)])]),_:1}),e(Ee,{value:0},{default:t(()=>[...M[33]||(M[33]=[v("å‘¨æ—¥",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(le,{label:"æ’é™¤æ—¥æœŸ"},{default:t(()=>[x("div",Fi,[(I(!0),O(oe,null,Se(r.periodicExcludeDates||[],(te,fe)=>(I(),O("div",{key:fe,class:"exclude-date-item"},[e(De,{value:te.date,"onUpdate:value":Le=>te.date=Le,"value-format":"YYYY-MM-DD",format:"YYYY-MM-DD",placeholder:"ä¼‘æ¼”æ—¥æœŸ",class:"exclude-date-picker"},null,8,["value","onUpdate:value"]),e(ze,{value:te.reason,"onUpdate:value":Le=>te.reason=Le,placeholder:"åŸå› ï¼ˆå¯é€‰ï¼‰",class:"exclude-date-reason"},null,8,["value","onUpdate:value"]),e(ve,{type:"link",danger:"",size:"small",onClick:Le=>ne(fe)},{default:t(()=>[...M[34]||(M[34]=[v(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])]))),128)),e(ve,{type:"dashed",size:"small",onClick:Z},{default:t(()=>[...M[35]||(M[35]=[v(" æ·»åŠ ä¼‘æ¼”æ—¥ ",-1)])]),_:1})])]),_:1}),e(ie,{type:"info","show-icon":"",message:`é¢„è®¡ç”Ÿæˆï¼š${se.value} ä¸ªåœºæ¬¡`},null,8,["message"])]),_:1})]),_:1},8,["open"])]),_:1},8,["open"])}}}),Li=Ve(Ei,[["__scopeId","data-v-f6203e0b"]]),Ni={style:{"margin-bottom":"16px",display:"flex","justify-content":"space-between"}},Oi=de({__name:"SessionsStep",props:{modelValue:{}},emits:["update:modelValue"],setup(l,{emit:h}){const u=l,p=h,s=W({get:()=>u.modelValue||[],set:a=>p("update:modelValue",a)}),d=E(!1),i=E(null),c=E(void 0),k=W(()=>(s.value||[]).reduce((a,n)=>a+(n.sessions?.length||0),0)),g=()=>{i.value=null,c.value=void 0,d.value=!0},m=a=>{const n=s.value[a];n&&(i.value=a,c.value=n,d.value=!0)},r=a=>{const n=[...s.value];n.splice(a,1),s.value=n},o=a=>{if(!a||!a.length)return"-";const n=a.map($=>He($.date)).sort(($,F)=>$.valueOf()-F.valueOf()),S=n[0]?.format("YYYY-MM-DD"),z=n[n.length-1]?.format("YYYY-MM-DD");return!S||!z?"-":S===z?S:`${S} ~ ${z}`},y=a=>{if(!a||!a.length)return"-";const n=a.map(z=>z.startTime),S=Array.from(new Set(n.filter(z=>!!z))).sort();return S.length?S.length>3?`${S.slice(0,3).join(", ")} ç­‰${S.length}ä¸ªæ—¶é—´`:S.join(", "):"-"},_=a=>{if(!a||!a.length)return"-";const n=Array.from(new Set(a.map(S=>S.durationMinutes).filter(S=>typeof S=="number")));return n.length?n.length===1?`${n[0]}`:`${Math.min(...n)}-${Math.max(...n)}`:"-"},b=a=>{const n=[...s.value];i.value!==null&&i.value>=0?n[i.value]=a:n.push(a),s.value=n,d.value=!1},f=()=>{d.value=!1};return(a,n)=>{const S=w("a-alert"),z=w("a-typography-text"),$=w("a-button"),F=w("a-table-column"),D=w("a-tag"),P=w("a-space"),A=w("a-popconfirm"),Z=w("a-table"),ne=w("a-empty");return I(),O("div",null,[e(S,{type:"info","show-icon":"",style:{"margin-bottom":"16px"},message:"å¯ä»¥é…ç½®å¤šä¸ªåœºé¦†çš„åœºæ¬¡ï¼Œæ¯ä¸ªé…ç½®å¯åŒ…å«å¤šä¸ªåœºæ¬¡æ—¶é—´å’Œç¥¨æ¡£ã€‚"}),x("div",Ni,[e(z,{type:"secondary"},{default:t(()=>[v(" å·²æ·»åŠ  "+B(s.value.length)+" ä¸ªåœºæ¬¡é…ç½®ï¼Œå…± "+B(k.value)+" ä¸ªåœºæ¬¡ ",1)]),_:1}),e($,{type:"primary",onClick:g},{default:t(()=>[...n[1]||(n[1]=[v("æ·»åŠ åœºæ¬¡é…ç½®",-1)])]),_:1})]),s.value.length?(I(),V(Z,{key:0,"data-source":s.value.map((T,L)=>({...T,key:L,index:L})),pagination:!1,"row-key":T=>String(T.key),scroll:{x:"max-content"}},{default:t(()=>[e(F,{key:"venueName",width:180,fixed:"left"},{title:t(()=>[...n[2]||(n[2]=[v("åœºé¦†",-1)])]),default:t(({record:T})=>[x("div",null,[x("div",null,B(T.venueName||"æœªçŸ¥åœºé¦†"),1),T.venueCapacityType?(I(),V(z,{key:0,type:"secondary",style:{"font-size":"12px"}},{default:t(()=>[T.venueCapacityType==="precise_seat"?(I(),O(oe,{key:0},[v(" ç²¾ç¡®åº§ä½ ")],64)):T.venueCapacityType==="zone_capacity"?(I(),O(oe,{key:1},[v(" æŒ‰åº§åŒºæ•°é‡ ")],64)):T.venueCapacityType==="free_seating"?(I(),O(oe,{key:2},[v(" è‡ªç”±ç«™å¸­ ")],64)):q("",!0)]),_:2},1024)):q("",!0)])]),_:1}),e(F,{key:"dateRange",width:220},{title:t(()=>[...n[3]||(n[3]=[v("æ¼”å‡ºæ—¥æœŸ",-1)])]),default:t(({record:T})=>[v(B(o(T.sessions||[])),1)]),_:1}),e(F,{key:"startTimes",width:200},{title:t(()=>[...n[4]||(n[4]=[v("å¼€æ¼”æ—¶é—´",-1)])]),default:t(({record:T})=>[v(B(y(T.sessions||[])),1)]),_:1}),e(F,{key:"duration",width:120,align:"right"},{title:t(()=>[...n[5]||(n[5]=[v("æ—¶é•¿(åˆ†é’Ÿ)",-1)])]),default:t(({record:T})=>[v(B(_(T.sessions||[])),1)]),_:1}),e(F,{key:"configStats",width:220},{title:t(()=>[...n[6]||(n[6]=[v("é…ç½®ç»Ÿè®¡",-1)])]),default:t(({record:T})=>[e(P,{size:8},{default:t(()=>[e(D,{color:(T.priceTiers||[]).length>0?"success":"default"},{default:t(()=>[v(B((T.priceTiers||[]).length)+" ä¸ªç¥¨æ¡£ ",1)]),_:2},1032,["color"]),e(D,{color:"blue"},{default:t(()=>[v(B((T.sessions||[]).length)+" ä¸ªåœºæ¬¡ ",1)]),_:2},1024)]),_:2},1024)]),_:1}),e(F,{key:"actions",width:120,fixed:"right",align:"right"},{title:t(()=>[...n[7]||(n[7]=[v("æ“ä½œ",-1)])]),default:t(({record:T})=>[e(P,{size:8},{default:t(()=>[e($,{type:"link",size:"small",onClick:L=>m(T.index)},{default:t(()=>[...n[8]||(n[8]=[v(" ç¼–è¾‘ ",-1)])]),_:1},8,["onClick"]),e(A,{title:"ç¡®è®¤åˆ é™¤è¯¥åœºæ¬¡é…ç½®å—ï¼Ÿ",description:`å°†åˆ é™¤ ${T.sessions?.length||0} ä¸ªåœºæ¬¡`,"ok-text":"ç¡®è®¤","cancel-text":"å–æ¶ˆ","ok-type":"danger",onConfirm:()=>r(T.index)},{default:t(()=>[e($,{type:"link",size:"small"},{default:t(()=>[...n[9]||(n[9]=[v("åˆ é™¤",-1)])]),_:1})]),_:1},8,["description","onConfirm"])]),_:2},1024)]),_:1})]),_:1},8,["data-source","row-key"])):(I(),V(ne,{key:1,description:"æš‚æ— åœºæ¬¡é…ç½®ï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹â€œæ·»åŠ åœºæ¬¡é…ç½®â€æŒ‰é’®",style:{margin:"32px 0"}})),e(Li,{visible:d.value,"onUpdate:visible":n[0]||(n[0]=T=>d.value=T),"initial-values":c.value,"existing-configs":s.value,onOk:b,onCancel:f},null,8,["visible","initial-values","existing-configs"])])}}}),Pi={class:"sales-rule-step"},Ui={class:"sales-rule-section"},Ai={class:"risk-notice-row"},Vi={key:0,class:"risk-notice-upload"},Yi={key:0,class:"risk-notice-text-wrapper"},Bi={class:"sales-rule-control-column"},Xi={class:"sales-rule-control-column"},Zi={class:"sales-rule-inline-option"},Gi={class:"sales-rule-inline-option"},qi={class:"sales-rule-section"},ji={class:"print-price-row"},Hi={class:"sales-rule-control-column"},Ki={class:"sales-rule-section"},Wi={class:"refund-fee-rule-header"},Ji={key:0,class:"refund-fee-fixed-row"},Qi={key:0,class:"refund-fee-ladder-list"},er=de({__name:"SalesRuleStep",props:{modelValue:{}},emits:["update:modelValue"],setup(l,{emit:h}){const u=l,p=h,s=W({get:()=>u.modelValue,set:r=>p("update:modelValue",r)}),d=E([]),i=r=>(d.value=[r],s.value&&(s.value.riskNoticeFileName=r.name),!1),c=()=>({id:`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,offsetDirection:"before",offsetDays:0,offsetTime:void 0,feeRate:void 0,feeUnit:"yuan"}),k=()=>{if(!s.value)return;const r=s.value;Array.isArray(r.refundFeeLadderRules)||(r.refundFeeLadderRules=[])},g=()=>{k(),s.value.refundFeeLadderRules.push(c())},m=r=>{if(!s.value)return;const o=s.value;Array.isArray(o.refundFeeLadderRules)&&o.refundFeeLadderRules.splice(r,1)};return(r,o)=>{const y=w("a-typography-title"),_=w("a-typography-link"),b=w("a-form-item"),f=w("a-checkbox"),a=w("a-checkbox-group"),n=w("a-radio"),S=w("a-radio-group"),z=w("a-select-option"),$=w("a-select"),F=w("a-button"),D=w("a-upload"),P=w("a-textarea"),A=w("a-input-number"),Z=w("a-input"),ne=w("a-time-picker");return I(),O("div",Pi,[x("div",Ui,[e(y,{level:5,class:"sales-rule-section-title"},{default:t(()=>[...o[36]||(o[36]=[v(" ä¸‹å•è§„åˆ™ ",-1)])]),_:1}),e(b,{class:"sales-rule-line",label:"é”€å”®é—¨åº—"},{default:t(()=>[e(_,{disabled:""},{default:t(()=>[...o[37]||(o[37]=[v("é€‰æ‹©é—¨åº—",-1)])]),_:1})]),_:1}),e(b,{class:"sales-rule-line",label:"å¯å”®æ¸ é“"},{default:t(()=>[e(a,{value:s.value.orderChannels,"onUpdate:value":o[0]||(o[0]=T=>s.value.orderChannels=T)},{default:t(()=>[e(f,{value:"online_mini_program"},{default:t(()=>[...o[38]||(o[38]=[v("çº¿ä¸Šå°ç¨‹åº",-1)])]),_:1}),e(f,{value:"offline_window"},{default:t(()=>[...o[39]||(o[39]=[v("çº¿ä¸‹ç¥¨åŠ¡çª—å£",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),q("",!0),s.value.realNameType==="all_visitors"?(I(),V(b,{key:1,class:"sales-rule-line",label:"å¹´é¾„é™åˆ¶",name:["salesRule","ageLimitType"],rules:[{required:!0,message:"è¯·é€‰æ‹©å¹´é¾„é™åˆ¶"}]},{default:t(()=>[e(S,{value:s.value.ageLimitType,"onUpdate:value":o[2]||(o[2]=T=>s.value.ageLimitType=T)},{default:t(()=>[e(n,{value:"unlimited"},{default:t(()=>[...o[43]||(o[43]=[v("ä¸é™å¹´é¾„",-1)])]),_:1}),e(n,{value:"limited"},{default:t(()=>[...o[44]||(o[44]=[v("é™åˆ¶å¹´é¾„",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):q("",!0),e(b,{class:"sales-rule-line",label:"é£é™©æç¤º",name:["salesRule","needRiskNotice"],rules:[{required:!0,message:"è¯·é€‰æ‹©é£é™©æç¤º"}]},{default:t(()=>[x("div",Ai,[e(S,{value:s.value.needRiskNotice,"onUpdate:value":o[3]||(o[3]=T=>s.value.needRiskNotice=T)},{default:t(()=>[e(n,{value:!1},{default:t(()=>[...o[45]||(o[45]=[v("æ— éœ€",-1)])]),_:1}),e(n,{value:!0},{default:t(()=>[...o[46]||(o[46]=[v("éœ€è¦",-1)])]),_:1})]),_:1},8,["value"]),s.value.needRiskNotice?(I(),O(oe,{key:0},[e($,{value:s.value.riskNoticeMode,"onUpdate:value":o[4]||(o[4]=T=>s.value.riskNoticeMode=T),style:{width:"120px","margin-left":"8px"},placeholder:"è¯·é€‰æ‹©"},{default:t(()=>[e(z,{value:"text"},{default:t(()=>[...o[47]||(o[47]=[v("è¾“å…¥æ–‡æœ¬",-1)])]),_:1}),e(z,{value:"file"},{default:t(()=>[...o[48]||(o[48]=[v("ä¸Šä¼ æ–‡æ¡£",-1)])]),_:1})]),_:1},8,["value"]),s.value.riskNoticeMode==="file"?(I(),O("span",Vi,[e(D,{"file-list":d.value,"onUpdate:fileList":o[5]||(o[5]=T=>d.value=T),"before-upload":i,"max-count":1},{default:t(()=>[e(F,{type:"default",style:{height:"32px","margin-left":"8px"}},{default:t(()=>[...o[49]||(o[49]=[v("ä¸Šä¼ ",-1)])]),_:1})]),_:1},8,["file-list"])])):q("",!0)],64)):q("",!0)]),s.value.needRiskNotice&&(s.value.riskNoticeMode==="text"||!s.value.riskNoticeMode)?(I(),O("div",Yi,[e(P,{value:s.value.riskNoticeText,"onUpdate:value":o[6]||(o[6]=T=>s.value.riskNoticeText=T),placeholder:"è¯·è¾“å…¥é£é™©æç¤º",maxlength:500,"show-count":"","auto-size":{minRows:4,maxRows:4}},null,8,["value"])])):q("",!0)]),_:1}),e(b,{class:"sales-rule-line",label:"å›¢ä½“ç¥¨",name:["salesRule","enableGroupTicket"],rules:[{required:!0,message:"è¯·é€‰æ‹©æ˜¯å¦æ”¯æŒå›¢ä½“ç¥¨"}]},{default:t(()=>[e(S,{value:s.value.enableGroupTicket,"onUpdate:value":o[7]||(o[7]=T=>s.value.enableGroupTicket=T)},{default:t(()=>[e(n,{value:!0},{default:t(()=>[...o[50]||(o[50]=[v("æ˜¯",-1)])]),_:1}),e(n,{value:!1},{default:t(()=>[...o[51]||(o[51]=[v("å¦",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),s.value.enableGroupTicket?(I(),V(b,{key:2,class:"sales-rule-line",label:"æœ€å°èµ·è®¢é‡"},{default:t(()=>[x("div",Bi,[e(S,{value:s.value.groupMinOrderLimitType,"onUpdate:value":o[9]||(o[9]=T=>s.value.groupMinOrderLimitType=T)},{default:t(()=>[e(n,{value:"unlimited"},{default:t(()=>[...o[52]||(o[52]=[v("ä¸é™å¹´é¾„",-1)])]),_:1}),e(n,{value:"at_least"},{default:t(()=>[o[53]||(o[53]=x("span",{class:"sales-rule-inline-prefix"},"è‡³å°‘",-1)),e(A,{value:s.value.groupMinOrderQuantity,"onUpdate:value":o[8]||(o[8]=T=>s.value.groupMinOrderQuantity=T),min:1,max:9999,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[54]||(o[54]=v(" å¼  ",-1))]),_:1})]),_:1},8,["value"])])]),_:1})):q("",!0),e(b,{class:"sales-rule-line",label:"æ”¯ä»˜é™åˆ¶",name:["salesRule","paymentLimitType"],rules:[{required:!0,message:"è¯·é€‰æ‹©æ”¯ä»˜é™åˆ¶"}]},{default:t(()=>[e(S,{value:s.value.paymentLimitType,"onUpdate:value":o[11]||(o[11]=T=>s.value.paymentLimitType=T)},{default:t(()=>[e(n,{value:"minutes_after_order"},{default:t(()=>[o[55]||(o[55]=x("span",{class:"sales-rule-inline-prefix"},"ä¸‹å•å",-1)),e(A,{value:s.value.paymentLimitMinutesAfterOrder,"onUpdate:value":o[10]||(o[10]=T=>s.value.paymentLimitMinutesAfterOrder=T),min:1,max:600,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[56]||(o[56]=v(" åˆ†é’Ÿæœªä»˜æ¬¾è‡ªåŠ¨å–æ¶ˆè®¢å• ",-1))]),_:1}),e(n,{value:"unlimited"},{default:t(()=>[...o[57]||(o[57]=[v("ä¸é™åˆ¶",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(b,{class:"sales-rule-line",label:"è´­ç¥¨é™åˆ¶",name:["salesRule","purchaseLimitType"],rules:[{required:!0,message:"è¯·é€‰æ‹©è´­ç¥¨é™åˆ¶"}]},{default:t(()=>[e(S,{value:s.value.purchaseLimitType,"onUpdate:value":o[13]||(o[13]=T=>s.value.purchaseLimitType=T)},{default:t(()=>[e(n,{value:"per_identity"},{default:t(()=>[o[58]||(o[58]=x("span",{class:"sales-rule-inline-prefix"},"æ¯ä¸ªæ‰‹æœºå·/èº«ä»½è¯æœ€å¤šè´­ä¹°",-1)),e(A,{value:s.value.purchaseLimitPerIdentity,"onUpdate:value":o[12]||(o[12]=T=>s.value.purchaseLimitPerIdentity=T),min:1,max:99,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[59]||(o[59]=v(" å¼  ",-1))]),_:1}),e(n,{value:"unlimited"},{default:t(()=>[...o[60]||(o[60]=[v("ä¸é™åˆ¶",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(b,{class:"sales-rule-line",label:"åœå”®è§„åˆ™",name:["salesRule","saleEndRuleType"],rules:[{required:!0,message:"è¯·é€‰æ‹©åœå”®è§„åˆ™"}]},{default:t(()=>[x("div",Xi,[e(S,{value:s.value.saleEndRuleType,"onUpdate:value":o[16]||(o[16]=T=>s.value.saleEndRuleType=T)},{default:t(()=>[x("div",Zi,[e(n,{value:"before"},{default:t(()=>[o[61]||(o[61]=v(" å¯å”®è‡³ï¼šå¼€æ¼”å‰ ",-1)),e(A,{value:s.value.saleEndBeforeMinutes,"onUpdate:value":o[14]||(o[14]=T=>s.value.saleEndBeforeMinutes=T),min:0,max:1440,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[62]||(o[62]=v(" åˆ†é’Ÿï¼ˆå«ï¼‰ ",-1))]),_:1})]),x("div",Gi,[e(n,{value:"after"},{default:t(()=>[o[63]||(o[63]=v(" å¯å”®è‡³ï¼šå¼€æ¼”å ",-1)),e(A,{value:s.value.saleEndAfterMinutes,"onUpdate:value":o[15]||(o[15]=T=>s.value.saleEndAfterMinutes=T),min:0,max:1440,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[64]||(o[64]=v(" åˆ†é’Ÿï¼ˆå«ï¼‰ ",-1))]),_:1})])]),_:1},8,["value"])])]),_:1})]),x("div",qi,[e(y,{level:5,class:"sales-rule-section-title"},{default:t(()=>[...o[65]||(o[65]=[v(" å–ç¥¨ / éªŒç¥¨è§„åˆ™ ",-1)])]),_:1}),e(b,{class:"sales-rule-line",label:"å–ç¥¨æ—¶æœº",name:["salesRule","pickupTimeType"],rules:[{required:!0,message:"è¯·é€‰æ‹©å–ç¥¨æ—¶æœº"}]},{default:t(()=>[e(S,{value:s.value.pickupTimeType,"onUpdate:value":o[17]||(o[17]=T=>s.value.pickupTimeType=T)},{default:t(()=>[e(n,{value:"no_pickup"},{default:t(()=>[...o[66]||(o[66]=[v("æ— éœ€å–ç¥¨",-1)])]),_:1}),e(n,{value:"same_day"},{default:t(()=>[...o[67]||(o[67]=[v("å½“å¤©å¯å–",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(b,{class:"sales-rule-line",label:"æ‰“å°æ–¹å¼",name:["salesRule","printMode"],rules:[{required:!0,message:"è¯·é€‰æ‹©æ‰“å°æ–¹å¼"}]},{default:t(()=>[e(S,{value:s.value.printMode,"onUpdate:value":o[18]||(o[18]=T=>s.value.printMode=T)},{default:t(()=>[e(n,{value:"one_per_person"},{default:t(()=>[...o[68]||(o[68]=[v("ä¸€ç¥¨ä¸€äºº",-1)])]),_:1}),e(n,{value:"one_per_type"},{default:t(()=>[...o[69]||(o[69]=[v("ä¸€ç§ç¥¨ä¸€å¼ ",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(b,{class:"sales-rule-line",label:"è‡ªåŠ¨æ‰“å°",name:["salesRule","autoPrint"],rules:[{required:!0,message:"è¯·é€‰æ‹©æ˜¯å¦è‡ªåŠ¨æ‰“å°"}]},{default:t(()=>[e(S,{value:s.value.autoPrint,"onUpdate:value":o[19]||(o[19]=T=>s.value.autoPrint=T)},{default:t(()=>[e(n,{value:!0},{default:t(()=>[...o[70]||(o[70]=[v("æ˜¯",-1)])]),_:1}),e(n,{value:!1},{default:t(()=>[...o[71]||(o[71]=[v("å¦",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(b,{class:"sales-rule-line",label:"æ‰“å°æ¨¡æ¿",name:["salesRule","printTemplate"],rules:[{required:!0,message:"è¯·é€‰æ‹©æ‰“å°æ¨¡æ¿"}]},{default:t(()=>[e($,{value:s.value.printTemplate,"onUpdate:value":o[20]||(o[20]=T=>s.value.printTemplate=T),style:{width:"200px"},placeholder:"è¯·é€‰æ‹©"},{default:t(()=>[e(z,{value:"default"},{default:t(()=>[...o[72]||(o[72]=[v("é»˜è®¤",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(b,{class:"sales-rule-line",label:"æ‰“å°ç¥¨ä»·",name:["salesRule","printCopyType"],rules:[{required:!0,message:"è¯·é€‰æ‹©æ‰“å°ç¥¨ä»·"}]},{default:t(()=>[x("div",ji,[e(S,{value:s.value.printCopyType,"onUpdate:value":o[21]||(o[21]=T=>s.value.printCopyType=T),class:"print-price-group"},{default:t(()=>[e(n,{value:"real_price"},{default:t(()=>[...o[73]||(o[73]=[v("çœŸå®ç¥¨ä»·",-1)])]),_:1}),e(n,{value:"custom"},{default:t(()=>[...o[74]||(o[74]=[v("è‡ªå®šä¹‰",-1)])]),_:1})]),_:1},8,["value"]),s.value.printCopyType==="custom"?(I(),V(Z,{key:0,value:s.value.printCustomPrice,"onUpdate:value":o[22]||(o[22]=T=>s.value.printCustomPrice=T),"addon-before":"Â¥",class:"print-price-input",placeholder:"è¯·è¾“å…¥"},null,8,["value"])):q("",!0)])]),_:1}),e(b,{class:"sales-rule-line",label:"éªŒç¥¨æ–¹å¼"},{default:t(()=>[e(a,{value:s.value.verifyMethods,"onUpdate:value":o[23]||(o[23]=T=>s.value.verifyMethods=T)},{default:t(()=>[e(f,{value:"order_qr"},{default:t(()=>[...o[75]||(o[75]=[v("è®¢å•äºŒç»´ç ",-1)])]),_:1}),e(f,{value:"ticket_qr"},{default:t(()=>[...o[76]||(o[76]=[v("ç¥¨äºŒç»´ç ",-1)])]),_:1}),e(f,{value:"paper"},{default:t(()=>[...o[77]||(o[77]=[v("ç¥¨æ ¹",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(b,{class:"sales-rule-line",label:"éªŒç¥¨æ—¶é™",name:["salesRule","verifyTimeType"],rules:[{required:!0,message:"è¯·é€‰æ‹©éªŒç¥¨æ—¶é™"}]},{default:t(()=>[x("div",Hi,[e(S,{value:s.value.verifyTimeType,"onUpdate:value":o[28]||(o[28]=T=>s.value.verifyTimeType=T),class:"verify-time-radio-group"},{default:t(()=>[e(n,{value:"same_day"},{default:t(()=>[...o[78]||(o[78]=[v("ä¸é™",-1)])]),_:1}),e(n,{value:"custom"},{default:t(()=>[o[79]||(o[79]=v(" è‡ªå®šä¹‰ï¼šé¢„è®¢æ—¶é—´æå‰ä¸è¶…è¿‡ ",-1)),e(A,{value:s.value.verifyTimeBeforeHours,"onUpdate:value":o[24]||(o[24]=T=>s.value.verifyTimeBeforeHours=T),min:0,max:168,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[80]||(o[80]=v(" å°æ—¶ ",-1)),e(A,{value:s.value.verifyTimeBeforeMinutes,"onUpdate:value":o[25]||(o[25]=T=>s.value.verifyTimeBeforeMinutes=T),min:0,max:59,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[81]||(o[81]=v(" åˆ†é’Ÿï¼›é¢„è®¢æ—¶é—´æ¨åä¸è¶…è¿‡ ",-1)),e(A,{value:s.value.verifyTimeAfterHours,"onUpdate:value":o[26]||(o[26]=T=>s.value.verifyTimeAfterHours=T),min:0,max:168,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[82]||(o[82]=v(" å°æ—¶ ",-1)),e(A,{value:s.value.verifyTimeAfterMinutes,"onUpdate:value":o[27]||(o[27]=T=>s.value.verifyTimeAfterMinutes=T),min:0,max:59,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[83]||(o[83]=v(" åˆ†é’Ÿ ",-1))]),_:1})]),_:1},8,["value"])])]),_:1})]),x("div",Ki,[e(y,{level:5,class:"sales-rule-section-title"},{default:t(()=>[...o[84]||(o[84]=[v(" é€€æ”¹è§„åˆ™ ",-1)])]),_:1}),e(b,{class:"sales-rule-line",label:"é€€ç¥¨è§„åˆ™",name:["salesRule","refundRuleType"],rules:[{required:!0,message:"è¯·é€‰æ‹©é€€ç¥¨è§„åˆ™"}]},{default:t(()=>[e(S,{value:s.value.refundRuleType,"onUpdate:value":o[29]||(o[29]=T=>s.value.refundRuleType=T)},{default:t(()=>[e(n,{value:"not_refundable"},{default:t(()=>[...o[85]||(o[85]=[v("ä¸å¯é€€",-1)])]),_:1}),e(n,{value:"conditional"},{default:t(()=>[...o[86]||(o[86]=[v("æœ‰æ¡ä»¶é€€",-1)])]),_:1}),e(n,{value:"anytime"},{default:t(()=>[...o[87]||(o[87]=[v("éšæ—¶é€€",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),s.value.refundRuleType==="conditional"?(I(),V(b,{key:0,class:"sales-rule-line",label:"é€€ç¥¨æˆªæ­¢",name:["salesRule","refundDeadlineMinutesBeforeShow"],rules:[{required:!0,message:"è¯·è¾“å…¥é€€ç¥¨æˆªæ­¢æ—¶é—´"}]},{default:t(()=>[o[88]||(o[88]=x("span",{class:"sales-rule-inline-prefix"},"å¼€æ¼”å‰",-1)),e(A,{value:s.value.refundDeadlineMinutesBeforeShow,"onUpdate:value":o[30]||(o[30]=T=>s.value.refundDeadlineMinutesBeforeShow=T),min:0,max:1440,style:{width:"80px",margin:"0 4px"}},null,8,["value"]),o[89]||(o[89]=v(" åˆ†é’Ÿï¼ˆå«ï¼‰ ",-1))]),_:1})):q("",!0),s.value.refundRuleType==="conditional"?(I(),V(b,{key:1,class:"sales-rule-line",label:"é€€ç¥¨æ‰‹ç»­è´¹",name:["salesRule","refundFeeType"],rules:[{required:!0,message:"è¯·é€‰æ‹©é€€ç¥¨æ‰‹ç»­è´¹è§„åˆ™"}]},{default:t(()=>[e(S,{value:s.value.refundFeeType,"onUpdate:value":o[31]||(o[31]=T=>s.value.refundFeeType=T)},{default:t(()=>[e(n,{value:"no_fee"},{default:t(()=>[...o[90]||(o[90]=[v("ä¸éœ€æ‰‹ç»­è´¹",-1)])]),_:1}),e(n,{value:"need_fee"},{default:t(()=>[...o[91]||(o[91]=[v("éœ€æ‰‹ç»­è´¹",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):q("",!0),s.value.refundRuleType==="conditional"&&s.value.refundFeeType==="need_fee"?(I(),V(b,{key:2,class:"sales-rule-line",label:"æ‰‹ç»­è´¹è§„åˆ™",name:["salesRule","refundFeeRuleType"],rules:[{required:!0,message:"è¯·é€‰æ‹©æ‰‹ç»­è´¹è§„åˆ™"}]},{default:t(()=>[x("div",Wi,[e(S,{value:s.value.refundFeeRuleType,"onUpdate:value":o[34]||(o[34]=T=>s.value.refundFeeRuleType=T)},{default:t(()=>[e(n,{value:"fixed"},{default:t(()=>[o[95]||(o[95]=v(" å›ºå®šé‡‘é¢ ",-1)),s.value.refundFeeRuleType==="fixed"?(I(),O("span",Ji,[o[94]||(o[94]=v(" æ¯å¼ ç¥¨å®é™…å”®ä»·æ”¶å– ",-1)),e(A,{value:s.value.refundFeeFixedAmount,"onUpdate:value":o[32]||(o[32]=T=>s.value.refundFeeFixedAmount=T),min:0,precision:2,style:{width:"120px",margin:"0 8px"}},null,8,["value"]),e($,{value:s.value.refundFeeFixedUnit,"onUpdate:value":o[33]||(o[33]=T=>s.value.refundFeeFixedUnit=T),style:{width:"80px"}},{default:t(()=>[e(z,{value:"yuan"},{default:t(()=>[...o[92]||(o[92]=[v("å…ƒ",-1)])]),_:1}),e(z,{value:"percent"},{default:t(()=>[...o[93]||(o[93]=[v("%",-1)])]),_:1})]),_:1},8,["value"])])):q("",!0)]),_:1}),e(n,{value:"ladder"},{default:t(()=>[...o[96]||(o[96]=[v(" é˜¶æ¢¯é‡‘é¢ ",-1)])]),_:1})]),_:1},8,["value"])]),s.value.refundFeeRuleType==="ladder"?(I(),O("div",Qi,[(I(!0),O(oe,null,Se(s.value.refundFeeLadderRules||[],(T,L)=>(I(),O("div",{key:T.id||L,class:"refund-fee-ladder-row"},[o[102]||(o[102]=v(" æˆªæ­¢æ£€ç¥¨æ—¶é—´ ",-1)),e($,{value:T.offsetDirection,"onUpdate:value":H=>T.offsetDirection=H,style:{width:"80px",margin:"0 4px"}},{default:t(()=>[e(z,{value:"before"},{default:t(()=>[...o[97]||(o[97]=[v("å‰",-1)])]),_:1}),e(z,{value:"after"},{default:t(()=>[...o[98]||(o[98]=[v("å",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"]),e(A,{value:T.offsetDays,"onUpdate:value":H=>T.offsetDays=H,min:0,max:365,style:{width:"80px",margin:"0 4px"}},null,8,["value","onUpdate:value"]),o[103]||(o[103]=v(" å¤©çš„ ",-1)),e(ne,{value:T.offsetTime,"onUpdate:value":H=>T.offsetTime=H,"value-format":"HH:mm",format:"HH:mm",style:{width:"120px",margin:"0 8px"},placeholder:"é€‰æ‹©æ—¶é—´"},null,8,["value","onUpdate:value"]),o[104]||(o[104]=v(" æ¯å¼ ç¥¨å®é™…å”®ä»·æ”¶å– ",-1)),e(A,{value:T.feeRate,"onUpdate:value":H=>T.feeRate=H,min:0,precision:2,style:{width:"120px",margin:"0 8px"}},null,8,["value","onUpdate:value"]),e($,{value:T.feeUnit,"onUpdate:value":H=>T.feeUnit=H,style:{width:"80px","margin-right":"8px"}},{default:t(()=>[e(z,{value:"yuan"},{default:t(()=>[...o[99]||(o[99]=[v("å…ƒ",-1)])]),_:1}),e(z,{value:"percent"},{default:t(()=>[...o[100]||(o[100]=[v("%",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"]),(s.value.refundFeeLadderRules||[]).length>1?(I(),V(F,{key:0,type:"link",onClick:H=>m(L)},{default:t(()=>[...o[101]||(o[101]=[v(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])):q("",!0)]))),128)),e(_,{onClick:g},{default:t(()=>[...o[105]||(o[105]=[v(" æ·»åŠ è§„åˆ™ ",-1)])]),_:1})])):q("",!0)]),_:1})):q("",!0),s.value.refundRuleType==="conditional"?(I(),V(b,{key:3,class:"sales-rule-line",label:"é€€ç¥¨å®¡æ ¸",name:["salesRule","refundReviewType"],rules:[{required:!0,message:"è¯·é€‰æ‹©é€€ç¥¨å®¡æ ¸æ–¹å¼"}]},{default:t(()=>[e(S,{value:s.value.refundReviewType,"onUpdate:value":o[35]||(o[35]=T=>s.value.refundReviewType=T)},{default:t(()=>[e(n,{value:"auto"},{default:t(()=>[...o[106]||(o[106]=[v("è‡ªåŠ¨åŸè·¯é€€æ¬¾",-1)])]),_:1}),e(n,{value:"manual"},{default:t(()=>[...o[107]||(o[107]=[v("å®¡æ ¸åé€€æ¬¾",-1)])]),_:1})]),_:1},8,["value"])]),_:1})):q("",!0)])])}}}),tr=Ve(er,[["__scopeId","data-v-93ad5e4c"]]),ar=de({__name:"DetailsStep",props:{modelValue:{}},emits:["update:modelValue"],setup(l,{emit:h}){const u=l,p=h,s=W({get:()=>u.modelValue,set:m=>p("update:modelValue",m)}),d=E("intro"),i=E([]);_e(()=>s.value.detailImages,m=>{i.value.length||(m&&m.length?i.value=m.map((r,o)=>({uid:`detail-${o}`,name:`detail-${o}.jpg`,status:"done",url:r})):i.value=[])},{immediate:!0});const c=m=>m.type.startsWith("image/")?["image/jpeg","image/png","image/gif"].includes(m.type)?m.size/1024/1024<6?!0:(window.message?.error?.("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 6MB"),!1):(window.message?.error?.("ä»…æ”¯æŒ JPG/PNG/GIF æ ¼å¼çš„å›¾ç‰‡"),!1):(window.message?.error?.("åªæ”¯æŒä¸Šä¼ å›¾ç‰‡æ–‡ä»¶"),!1),k=m=>{const{file:r,onSuccess:o,onError:y}=m,_=new FileReader;_.onload=()=>{const b=_.result;try{o({url:b})}catch(f){y?.(f)}},_.onerror=()=>{y?.(new Error("å›¾ç‰‡è¯»å–å¤±è´¥"))},_.readAsDataURL(r)},g=m=>{const r=(m.fileList||[]).map(y=>{const _=y.url||y.thumbUrl||y.response?.url;return _?{...y,url:_}:y});i.value=r;const o=r.filter(y=>y.status==="done").map(y=>y.url).filter(y=>!!y);s.value.detailImages=o.length?o:void 0};return(m,r)=>{const o=w("a-textarea"),y=w("a-form-item"),_=w("a-tab-pane"),b=w("a-alert"),f=w("YUploadDraggable"),a=w("a-tabs");return I(),O("div",null,[e(a,{activeKey:d.value,"onUpdate:activeKey":r[5]||(r[5]=n=>d.value=n)},{default:t(()=>[e(_,{key:"intro",tab:"æ¼”å‡ºä»‹ç»"},{default:t(()=>[e(y,{name:["details","intro"],label:"æ¼”å‡ºä»‹ç»"},{default:t(()=>[e(o,{value:s.value.intro,"onUpdate:value":r[0]||(r[0]=n=>s.value.intro=n),rows:6,"show-count":"",maxlength:2e3,placeholder:"è¯·è¾“å…¥æ¼”å‡ºä»‹ç»"},null,8,["value"])]),_:1})]),_:1}),e(_,{key:"bookingRule",tab:"é¢„è®¢è§„åˆ™"},{default:t(()=>[e(y,{name:["details","bookingRule"],label:"é¢„è®¢è§„åˆ™"},{default:t(()=>[e(o,{value:s.value.bookingRule,"onUpdate:value":r[1]||(r[1]=n=>s.value.bookingRule=n),rows:6,"show-count":"",maxlength:2e3,placeholder:"è¯·è¾“å…¥é¢„è®¢è§„åˆ™è¯´æ˜"},null,8,["value"])]),_:1})]),_:1}),e(_,{key:"refundRule",tab:"é€€æ”¹è§„åˆ™"},{default:t(()=>[e(y,{name:["details","refundRule"],label:"é€€æ”¹è§„åˆ™"},{default:t(()=>[e(o,{value:s.value.refundRule,"onUpdate:value":r[2]||(r[2]=n=>s.value.refundRule=n),rows:6,"show-count":"",maxlength:2e3,placeholder:"è¯·è¾“å…¥é€€æ”¹è§„åˆ™è¯´æ˜"},null,8,["value"])]),_:1})]),_:1}),e(_,{key:"safetyNotice",tab:"å®‰å…¨é¡»çŸ¥"},{default:t(()=>[e(y,{name:["details","safetyNotice"],label:"å®‰å…¨é¡»çŸ¥"},{default:t(()=>[e(o,{value:s.value.safetyNotice,"onUpdate:value":r[3]||(r[3]=n=>s.value.safetyNotice=n),rows:6,"show-count":"",maxlength:2e3,placeholder:"è¯·è¾“å…¥å®‰å…¨é¡»çŸ¥è¯´æ˜"},null,8,["value"])]),_:1})]),_:1}),e(_,{key:"detailImages",tab:"è¯¦æƒ…å›¾ç‰‡"},{default:t(()=>[e(b,{type:"warning","show-icon":"",message:"å¦‚ä¸Šä¼ è‡ªå®šä¹‰è¯¦æƒ…å›¾ç‰‡ï¼Œåˆ™åœ¨å‰ç«¯å±•ç¤ºä¸­ä»…æ˜¾ç¤ºè‡ªå®šä¹‰å›¾ç‰‡åŒºåŸŸï¼Œå…¶å®ƒæ–‡å­—ä»‹ç»åŒºåŸŸå¯èƒ½ä¸ä¼šå±•ç¤ºï¼Œè¯·å°†éœ€è¦è¯´æ˜çš„å†…å®¹æ”¾å…¥è‡ªå®šä¹‰å›¾ç‰‡ä¸­ã€‚",style:{"margin-bottom":"16px"}}),e(y,{name:["details","detailImages"],label:"ä¸Šä¼ å›¾ç‰‡",extra:"æ”¯æŒ JPG/PNG/GIFï¼Œå•å¼ ä¸è¶…è¿‡ 6MBï¼Œå»ºè®®å°ºå¯¸ä¸å°äº 1500px å®½ï¼Œå¯æ‹–æ‹½è°ƒæ•´é¡ºåº"},{default:t(()=>[e(f,{fileList:i.value,"onUpdate:fileList":r[4]||(r[4]=n=>i.value=n),"before-upload":c,"custom-request":k,onChange:g},null,8,["fileList"])]),_:1})]),_:1})]),_:1},8,["activeKey"])])}}}),nr={class:"mb-6"},lr=de({__name:"ShowForm",props:{initialValues:{},isEdit:{type:Boolean,default:!1},currentStep:{},venueOptions:{},showId:{}},emits:["update:currentStep"],setup(l,{expose:h,emit:u}){const p=l,s=u,d=E(),i=Qe({basicInfo:{name:"",venueId:"",type:"live_show",suitableAudience:void 0,coverImage:void 0,subtitle:"",description:"",producer:"",status:"draft"},sessionConfigs:[],sessions:[],priceTiers:[],seatPriceTierMapping:void 0,salesRule:{saleStartType:"immediate",saleEndType:"before_show",saleEndMinutesBeforeShow:30,allowRefund:!1,refundDeadlineType:"before_show",refundDeadlineHoursBeforeShow:24,refundDeadlineTime:void 0,maxPurchasePerOrder:10,orderChannels:["online_mini_program"],realNameType:"none",ageLimitType:"unlimited",needRiskNotice:!1,riskNoticeMode:"text",riskNoticeText:"",riskNoticeFileName:"",enableGroupTicket:!1,groupMinOrderLimitType:"unlimited",groupMinOrderQuantity:null,paymentLimitType:"unlimited",paymentLimitMinutesAfterOrder:void 0,purchaseLimitType:"per_identity",purchaseLimitPerIdentity:void 0,saleEndRuleType:"before",saleEndBeforeMinutes:0,saleEndAfterMinutes:0,pickupTimeType:"no_pickup",printMode:"one_per_person",autoPrint:!0,printTemplate:"default",printCopyType:"real_price",printCustomPrice:void 0,verifyMethods:[],verifyTimeType:"same_day",verifyTimeBeforeHours:0,verifyTimeBeforeMinutes:0,verifyTimeAfterHours:0,verifyTimeAfterMinutes:0,refundRuleType:"not_refundable",refundDeadlineMinutesBeforeShow:void 0,refundFeeType:"no_fee",refundFeeRuleType:"fixed",refundFeeFixedAmount:void 0,refundFeeFixedUnit:"yuan",refundFeeLadderRules:[],refundReviewType:"auto"},details:{intro:"",bookingRule:"",refundRule:"",safetyNotice:"",detailImages:void 0}}),c=W(()=>Be[p.currentStep]?.key);_e(()=>p.initialValues,r=>{r&&(r.basicInfo&&Object.assign(i.basicInfo,r.basicInfo),r.sessionConfigs&&r.sessionConfigs.length?i.sessionConfigs=[...r.sessionConfigs]:(r.sessions&&(i.sessions=[...r.sessions]),r.priceTiers&&(i.priceTiers=[...r.priceTiers])),r.salesRule&&Object.assign(i.salesRule,r.salesRule),r.seatPriceTierMapping&&(i.seatPriceTierMapping={...r.seatPriceTierMapping}))},{immediate:!0}),Re(()=>{});const k=async r=>{const o=d.value;if(!o)return!1;const y=Be[r]?.key;try{if(y==="basicInfo")return await o.validateFields([["basicInfo","name"],["basicInfo","type"],["basicInfo","status"]]),!0;if(y==="sessions"){const _=i.sessionConfigs||[];return _.length?_.some(n=>!n.sessions||!n.sessions.length)?(N.error("è¯·ä¸ºæ‰€æœ‰åœºæ¬¡é…ç½®æ·»åŠ åœºæ¬¡æ—¶é—´"),!1):_.some(n=>!n.priceTiers||!n.priceTiers.length)?(N.error("è¯·ä¸ºæ‰€æœ‰åœºæ¬¡é…ç½®ç¥¨æ¡£ä¿¡æ¯"),!1):_.some(n=>(n.priceTiers||[]).some(S=>!S.price||S.price<=0))?(N.error("è¯·ä¸ºæ‰€æœ‰ç¥¨æ¡£è®¾ç½®æœ‰æ•ˆä»·æ ¼"),!1):!0:(N.error("è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªåœºæ¬¡é…ç½®"),!1)}return y==="salesRule"&&await o.validateFields([["salesRule","saleEndType"],["salesRule","allowRefund"],["salesRule","maxPurchasePerOrder"],["salesRule","realNameType"],["salesRule","needRiskNotice"],["salesRule","enableGroupTicket"],["salesRule","paymentLimitType"],["salesRule","purchaseLimitType"],["salesRule","saleEndRuleType"],["salesRule","pickupTimeType"],["salesRule","printMode"],["salesRule","autoPrint"],["salesRule","printTemplate"],["salesRule","printCopyType"],["salesRule","verifyTimeType"],["salesRule","refundRuleType"],["salesRule","refundDeadlineMinutesBeforeShow"],["salesRule","refundFeeType"],["salesRule","refundReviewType"]]),!0}catch(_){if(_?.errorFields&&_.errorFields.length>0){const b=_.errorFields[0];b.errors?.length&&N.error(b.errors[0]),o.scrollToField&&o.scrollToField(b.name)}return!1}},g=()=>{const r=JSON.parse(JSON.stringify(i));let o=r.sessionConfigs||[];if(!o.length&&r.basicInfo&&(r.sessions||[]).length){const y=r.basicInfo.venueId;y&&(o=[{venueId:y,venueName:void 0,venueCapacityType:void 0,priceTiers:r.priceTiers||[],seatPriceTierMapping:r.seatPriceTierMapping,sessions:r.sessions||[]}])}return r.sessionConfigs=o,r},m=r=>{s("update:currentStep",r)};return h({validateStep:k,getValues:g}),(r,o)=>{const y=w("a-steps"),_=w("a-form");return I(),V(_,{ref_key:"formRef",ref:d,model:i,"label-col":{flex:"110px"},"wrapper-col":{flex:1}},{default:t(()=>[x("div",nr,[e(y,{current:l.currentStep,onChange:m,items:Y(Be).map(b=>({title:b.title}))},null,8,["current","items"])]),x("div",null,[c.value==="basicInfo"?(I(),V(Ti,{key:0,modelValue:i.basicInfo,"onUpdate:modelValue":o[0]||(o[0]=b=>i.basicInfo=b),"venue-options":l.venueOptions},null,8,["modelValue","venue-options"])):c.value==="sessions"?(I(),V(Oi,{key:1,modelValue:i.sessionConfigs,"onUpdate:modelValue":o[1]||(o[1]=b=>i.sessionConfigs=b)},null,8,["modelValue"])):c.value==="salesRule"?(I(),V(tr,{key:2,modelValue:i.salesRule,"onUpdate:modelValue":o[2]||(o[2]=b=>i.salesRule=b)},null,8,["modelValue"])):c.value==="details"?(I(),V(ar,{key:3,modelValue:i.details,"onUpdate:modelValue":o[3]||(o[3]=b=>i.details=b)},null,8,["modelValue"])):q("",!0)])]),_:1},8,["model"])}}}),pa=Ve(lr,[["__scopeId","data-v-a639c624"]]),or={style:{display:"flex",gap:"12px"}},_r=de({__name:"ShowCreate",setup(l){const h=Xe(),u=E(null),p=E(0),s=E(!1),d=E([]),i=E({salesRule:{saleStartType:"immediate",saleEndType:"before_show",saleEndMinutesBeforeShow:30,allowRefund:!0,refundDeadlineType:"before_show",refundDeadlineHoursBeforeShow:24,maxPurchasePerOrder:10}}),c=async()=>{try{const y=await ft({page:1,pageSize:100,status:"active"});d.value=y.list.map(_=>({label:_.name,value:_.id}))}catch(o){console.error(o),N.error("è·å–åœºé¦†åˆ—è¡¨å¤±è´¥")}};Re(()=>{c()});const k=()=>{p.value>0&&(p.value-=1)},g=async()=>{!u.value||!await u.value.validateStep(p.value)||p.value<Be.length-1&&(p.value+=1)},m=async()=>{if(!(!u.value||!await u.value.validateStep(p.value)))try{s.value=!0;const y=u.value.getValues(),_=(y.sessionConfigs&&y.sessionConfigs.length?y.sessionConfigs:[{venueId:y.basicInfo.venueId,venueName:void 0,venueCapacityType:void 0,priceTiers:y.priceTiers||[],seatPriceTierMapping:y.seatPriceTierMapping,seatDisabledStates:void 0,sessions:y.sessions||[]}])||[],b=_.flatMap(S=>(S.sessions||[]).map(z=>({date:z.date||"",startTime:z.startTime||"",durationMinutes:z.durationMinutes,openTime:z.openTime||void 0}))),f=_[0]?.venueId||y.basicInfo.venueId,a=_[0]?.priceTiers||y.priceTiers||[],n={name:y.basicInfo.name.trim(),venueId:f,type:y.basicInfo.type,suitableAudience:y.basicInfo.suitableAudience,coverImage:y.basicInfo.coverImage,subtitle:y.basicInfo.subtitle?.trim()||void 0,description:y.basicInfo.description?.trim()||void 0,producer:y.basicInfo.producer?.trim()||void 0,status:y.basicInfo.status,detailsIntro:y.details?.intro?.trim()||void 0,detailsBookingRule:y.details?.bookingRule?.trim()||void 0,detailsRefundRule:y.details?.refundRule?.trim()||void 0,detailsSafetyNotice:y.details?.safetyNotice?.trim()||void 0,detailImages:y.details?.detailImages,sessions:b,priceTiers:a.map(S=>({name:S.name.trim(),price:S.price,zoneIds:S.zoneIds,color:S.color,remark:S.remark?.trim()||void 0})),salesRule:{saleStartType:y.salesRule.saleStartType,saleStartTime:y.salesRule.saleStartTime||void 0,saleEndType:y.salesRule.saleEndType,saleEndMinutesBeforeShow:y.salesRule.saleEndMinutesBeforeShow,saleEndTime:y.salesRule.saleEndTime||void 0,allowRefund:y.salesRule.allowRefund,refundDeadlineType:y.salesRule.refundDeadlineType,refundDeadlineHoursBeforeShow:y.salesRule.refundDeadlineHoursBeforeShow,refundDeadlineTime:y.salesRule.refundDeadlineTime||void 0,maxPurchasePerOrder:y.salesRule.maxPurchasePerOrder}};await yi(n),N.success("åˆ›å»ºæ¼”å‡ºæˆåŠŸ"),h.push("/dashboard/theater/shows")}catch(y){console.error(y),N.error("åˆ›å»ºæ¼”å‡ºå¤±è´¥")}finally{s.value=!1}},r=()=>{h.push("/dashboard/theater/shows")};return(o,y)=>{const _=w("a-button");return I(),V(vt,null,{default:t(()=>[x("div",null,[e(pa,{ref_key:"showFormRef",ref:u,"initial-values":i.value,"current-step":p.value,"venue-options":d.value,"onUpdate:currentStep":y[0]||(y[0]=b=>p.value=b)},null,8,["initial-values","current-step","venue-options"])])]),footer:t(()=>[e(_,{onClick:r},{default:t(()=>[...y[1]||(y[1]=[v("å–æ¶ˆ",-1)])]),_:1}),x("div",or,[p.value>0?(I(),V(_,{key:0,onClick:k},{default:t(()=>[...y[2]||(y[2]=[v("ä¸Šä¸€æ­¥",-1)])]),_:1})):q("",!0),p.value<Y(Be).length-1?(I(),V(_,{key:1,type:"primary",onClick:g},{default:t(()=>[...y[3]||(y[3]=[v(" ä¸‹ä¸€æ­¥ ",-1)])]),_:1})):(I(),V(_,{key:2,type:"primary",loading:s.value,onClick:m},{default:t(()=>[...y[4]||(y[4]=[v(" åˆ›å»º ",-1)])]),_:1},8,["loading"]))])]),_:1})}}}),sr={style:{display:"flex",gap:"12px"}},br=de({__name:"ShowEdit",setup(l){const h=Tt(),u=Xe(),p=h.params.id,s=E(null),d=E(0),i=E(!1),c=E(!1),k=E([]),g=E(),m=async()=>{try{const a=await ft({page:1,pageSize:100,status:"active"});k.value=a.list.map(n=>({label:n.name,value:n.id}))}catch(f){console.error(f),N.error("è·å–åœºé¦†åˆ—è¡¨å¤±è´¥")}},r=async()=>{try{i.value=!0;const f=await ca(p),a=f.show;let n;if(a.venueId)try{n=(await mt(a.venueId)).capacityType}catch($){console.warn("è·å–åœºé¦†è¯¦æƒ…å¤±è´¥ï¼Œä»…ç”¨äºæ˜¾ç¤ºå®¹é‡ç±»å‹ï¼Œä¸å½±å“ç¼–è¾‘",$)}const S=(f.sessions||[]).map($=>({date:$.date,startTime:$.startTime,durationMinutes:$.durationMinutes,openTime:$.openTime})),z=(f.priceTiers||[]).map($=>({name:$.name,price:$.price,zoneIds:$.zoneIds,color:$.color,remark:$.remark}));g.value={basicInfo:{name:a.name,venueId:a.venueId,type:a.type,suitableAudience:a.suitableAudience,coverImage:a.coverImage,subtitle:a.subtitle,description:a.description,producer:a.producer,status:a.status},sessions:S,priceTiers:z,seatPriceTierMapping:f.seatPriceTierMapping,salesRule:f.salesRule||{saleStartType:"immediate",saleEndType:"before_show",saleEndMinutesBeforeShow:30,allowRefund:!0,refundDeadlineType:"before_show",refundDeadlineHoursBeforeShow:24,maxPurchasePerOrder:10},details:{intro:a.detailsIntro,bookingRule:a.detailsBookingRule,refundRule:a.detailsRefundRule,safetyNotice:a.detailsSafetyNotice,detailImages:a.detailImages}}}catch(f){console.error(f),N.error("è·å–æ¼”å‡ºè¯¦æƒ…å¤±è´¥")}finally{i.value=!1}};Re(async()=>{await Promise.all([m(),r()])});const o=()=>{d.value>0&&(d.value-=1)},y=async()=>{!s.value||!await s.value.validateStep(d.value)||d.value<Be.length-1&&(d.value+=1)},_=async()=>{if(!(!s.value||!await s.value.validateStep(d.value)))try{c.value=!0;const a=s.value.getValues(),n=(a.sessionConfigs&&a.sessionConfigs.length?a.sessionConfigs:[{venueId:a.basicInfo.venueId,venueName:void 0,venueCapacityType:void 0,priceTiers:a.priceTiers||[],seatPriceTierMapping:a.seatPriceTierMapping,seatDisabledStates:void 0,sessions:a.sessions||[]}])||[],S=n.flatMap(D=>(D.sessions||[]).map(P=>({date:P.date||"",startTime:P.startTime||"",durationMinutes:P.durationMinutes,openTime:P.openTime||void 0}))),z=n[0]?.venueId||a.basicInfo.venueId,$=n[0]?.priceTiers||a.priceTiers||[],F={id:p,name:a.basicInfo.name.trim(),venueId:z,type:a.basicInfo.type,suitableAudience:a.basicInfo.suitableAudience,coverImage:a.basicInfo.coverImage,subtitle:a.basicInfo.subtitle?.trim()||void 0,description:a.basicInfo.description?.trim()||void 0,producer:a.basicInfo.producer?.trim()||void 0,status:a.basicInfo.status,detailsIntro:a.details?.intro?.trim()||void 0,detailsBookingRule:a.details?.bookingRule?.trim()||void 0,detailsRefundRule:a.details?.refundRule?.trim()||void 0,detailsSafetyNotice:a.details?.safetyNotice?.trim()||void 0,detailImages:a.details?.detailImages,sessions:S,priceTiers:$.map(D=>({name:D.name.trim(),price:D.price,zoneIds:D.zoneIds,color:D.color,remark:D.remark?.trim()||void 0})),salesRule:{saleStartType:a.salesRule.saleStartType,saleStartTime:a.salesRule.saleStartTime||void 0,saleEndType:a.salesRule.saleEndType,saleEndMinutesBeforeShow:a.salesRule.saleEndMinutesBeforeShow,saleEndTime:a.salesRule.saleEndTime||void 0,allowRefund:a.salesRule.allowRefund,refundDeadlineType:a.salesRule.refundDeadlineType,refundDeadlineHoursBeforeShow:a.salesRule.refundDeadlineHoursBeforeShow,refundDeadlineTime:a.salesRule.refundDeadlineTime||void 0,maxPurchasePerOrder:a.salesRule.maxPurchasePerOrder}};await gi(F),N.success("æ›´æ–°æ¼”å‡ºæˆåŠŸ"),u.push("/dashboard/theater/shows")}catch(a){console.error(a),N.error("æ›´æ–°æ¼”å‡ºå¤±è´¥")}finally{c.value=!1}},b=()=>{u.push("/dashboard/theater/shows")};return(f,a)=>{const n=w("a-spin"),S=w("a-button");return I(),V(vt,null,{default:t(()=>[e(n,{spinning:i.value},{default:t(()=>[x("div",null,[g.value?(I(),V(pa,{key:0,ref_key:"showFormRef",ref:s,"initial-values":g.value,"current-step":d.value,"venue-options":k.value,"show-id":Y(p),"is-edit":!0,"onUpdate:currentStep":a[0]||(a[0]=z=>d.value=z)},null,8,["initial-values","current-step","venue-options","show-id"])):q("",!0)])]),_:1},8,["spinning"])]),footer:t(()=>[e(S,{onClick:b},{default:t(()=>[...a[1]||(a[1]=[v("å–æ¶ˆ",-1)])]),_:1}),x("div",sr,[d.value>0?(I(),V(S,{key:0,onClick:o},{default:t(()=>[...a[2]||(a[2]=[v("ä¸Šä¸€æ­¥",-1)])]),_:1})):q("",!0),d.value<Y(Be).length-1?(I(),V(S,{key:1,type:"primary",onClick:y,loading:i.value},{default:t(()=>[...a[3]||(a[3]=[v(" ä¸‹ä¸€æ­¥ ",-1)])]),_:1},8,["loading"])):(I(),V(S,{key:2,type:"primary",loading:c.value,onClick:_},{default:t(()=>[...a[4]||(a[4]=[v(" ä¿å­˜ ",-1)])]),_:1},8,["loading"]))])]),_:1})}}}),ir={class:"show-seat-pricing-page"},rr={class:"show-seat-pricing-page__editor-wrapper"},ur={class:"show-seat-pricing-page__editor"},dr={class:"show-seat-pricing-page__footer"},cr=de({__name:"ShowSeatPricingPage",setup(l){const h=Tt(),u=Xe(),p=h.params.id||"show-1",s=E(!1),d=E(null),i=E(null),c=async()=>{s.value=!0;try{const r=await ca(p),o=r.show;let y=[],_=[],b=[],f;if(o.venueId){const $=await mt(o.venueId);y=$.floors||[],_=($.seats||[]).map(P=>({...P,zoneColor:void 0})),b=($.zones||[]).map((P,A)=>({id:P.id,venueId:P.venueId,floorId:P.floorId||y[0]?.id||"",name:P.name,shortName:P.shortName,color:P.color||"#1890ff",order:P.order??P.sort??A+1}))||[];const D=$.seatMapConfig?.stage;D&&(f={id:D.id||"stage-1",name:D.name||"èˆå°æ–¹å‘",x:D.x??0,y:D.y??-300,width:D.width??480,height:D.height??40,angle:D.angle,color:D.color||"#dedede",shape:D.shape||"trapezoid"})}(!y.length||!_.length)&&(y=[{id:"F1",name:"1F",level:1}],_=[],b=[],f=f||{id:"stage-1",name:"èˆå°æ–¹å‘",x:0,y:-300,width:480,height:40,shape:"trapezoid",color:"#dedede"});let a=r.priceTiers||[];if(p==="show-001"){const $=a.filter(F=>!F.zoneIds?.includes("zone-001"));$.length>=2?a=$:a=[{id:"tier-002",showId:"show-001",name:"A åŒº",price:480,zoneIds:["zone-002"],color:"#FF6B6B",remark:void 0,createdAt:"2025-11-01",updatedAt:"2025-11-01"},{id:"tier-003",showId:"show-001",name:"B åŒº",price:280,zoneIds:["zone-003"],color:"#4ECDC4",remark:void 0,createdAt:"2025-11-01",updatedAt:"2025-11-01"}]}const n=new Map;b.forEach($=>{$.floorId&&n.set($.id,$.floorId)});const S=a.map(($,F)=>{const D=$.zoneIds&&$.zoneIds.length?$.zoneIds[0]:void 0,P=D?n.get(D):void 0;return{id:$.id,showId:$.showId,floorId:P,zoneId:D,name:$.name,price:$.price,color:$.color||"#1890ff",remark:$.remark,order:F}}),z={id:`theater-${p}`,name:`${o.venueName||o.name} - ç¥¨æ¡£é…ç½®`,venueId:o.venueId,floors:y,seats:_,stage:f,zones:b,priceTiers:S,metadata:{createdAt:new Date().toISOString()}};d.value=z,i.value=z}catch(r){console.error("åŠ è½½ç¥¨æ¡£é…ç½®æ•°æ®å¤±è´¥:",r),N.error("åŠ è½½ç¥¨æ¡£é…ç½®æ•°æ®å¤±è´¥")}finally{s.value=!1}};Re(()=>{c()});const k=r=>{i.value=r},g=()=>{u.push(`/dashboard/theater/shows/${p}`)},m=()=>{u.push(`/dashboard/theater/shows/${p}`)};return(r,o)=>{const y=w("a-spin"),_=w("a-button");return I(),O("div",ir,[x("div",rr,[e(y,{spinning:s.value},{default:t(()=>[x("div",ur,[d.value?(I(),V(ua,{key:0,"is-in-modal":!0,"initial-data":i.value||d.value,mode:"show",onChange:k},null,8,["initial-data"])):q("",!0)])]),_:1},8,["spinning"])]),x("div",dr,[e(_,{onClick:g},{default:t(()=>[...o[0]||(o[0]=[v("å–æ¶ˆ",-1)])]),_:1}),e(_,{type:"primary",onClick:m},{default:t(()=>[...o[1]||(o[1]=[v("å®Œæˆ",-1)])]),_:1})])])}}}),hr=Ve(cr,[["__scopeId","data-v-a7ec45ce"]]);export{hr as S,mr as _,vr as a,yr as b,gr as c,_r as d,br as e};
